@namespace BlazorUI.Components.Pagination
@using BlazorUI.Primitives.Table

<CascadingValue Value="@_context" IsFixed="false">
    <nav role="navigation" aria-label="pagination" class="@CssClass">
        @ChildContent
    </nav>
</CascadingValue>

@code {
    private PaginationContext _context = new();

    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Optional pagination state for automatic state management.
    /// When provided, child components will automatically wire up to this state.
    /// </summary>
    [Parameter]
    public PaginationState? State { get; set; }

    /// <summary>
    /// Available page size options for the page size selector.
    /// </summary>
    [Parameter]
    public int[] PageSizes { get; set; } = [10, 20, 50, 100];

    /// <summary>
    /// Callback invoked when the current page changes.
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }

    /// <summary>
    /// Callback invoked when the page size changes.
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageSizeChanged { get; set; }

    protected override void OnParametersSet()
    {
        _context.State = State;
        _context.PageSizes = PageSizes;
        _context.OnPageChanged = async (page) =>
        {
            if (OnPageChanged.HasDelegate)
                await OnPageChanged.InvokeAsync(page);
        };
        _context.OnPageSizeChanged = async (size) =>
        {
            if (OnPageSizeChanged.HasDelegate)
                await OnPageSizeChanged.InvokeAsync(size);
        };
    }

    private string CssClass => BlazorUI.Components.Utilities.ClassNames.cn(
        "mx-auto flex w-full justify-center",
        Class
    );
}
