@namespace BlazorUI.Components.AlertDialog
@using BlazorUI.Components.Utilities
@using BlazorUI.Primitives.Dialog
@using BlazorUI.Primitives.Services

@*
    AlertDialog content with alert-specific styling.
    By default, prevents dismissal via click-outside for standard alert dialog behavior.
*@

<DialogPortal>
    <DialogOverlay CloseOnClick="@CloseOnClickOutside" class="@GetOverlayClass()" style="@($"z-index: {GetEffectiveOverlayZIndex()}")" />

    <BlazorUI.Primitives.Dialog.DialogContent
        class="@GetClassNames()"
        style="@($"z-index: {GetEffectiveContentZIndex()}")"
        CloseOnEscape="@CloseOnEscape"
        TrapFocus="true"
        LockScroll="true"
        role="alertdialog"
        @attributes="AdditionalAttributes">
        @ChildContent
    </BlazorUI.Primitives.Dialog.DialogContent>
</DialogPortal>

@code {
    /// <summary>
    /// The content to render inside the alert dialog.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Additional CSS classes to apply to the alert dialog content.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    /// <summary>
    /// Whether the alert dialog can be closed with the Escape key.
    /// Default is true for accessibility.
    /// </summary>
    [Parameter]
    public bool CloseOnEscape { get; set; } = true;

    /// <summary>
    /// Whether the alert dialog can be closed by clicking outside.
    /// Default is false to comply with standard alert dialog behavior.
    /// </summary>
    [Parameter]
    public bool CloseOnClickOutside { get; set; } = false;

    /// <summary>
    /// Additional attributes to apply to the alert dialog content element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public IDictionary<string, object>? AdditionalAttributes { get; set; }

    /// <summary>
    /// Gets the z-index for the alert dialog overlay.
    /// AlertDialogs use the topmost z-index to ensure they appear above regular dialogs.
    /// </summary>
    private int GetEffectiveOverlayZIndex() => ZIndexLevels.TopmostDialogContent;

    /// <summary>
    /// Gets the z-index for the alert dialog content.
    /// Content is always 1 level above its overlay.
    /// </summary>
    private int GetEffectiveContentZIndex() => ZIndexLevels.TopmostDialogContent + 1;

    private string GetOverlayClass() => ClassNames.cn(
        "fixed inset-0 bg-black/40 backdrop-blur-sm",
        "data-[state=open]:animate-in data-[state=closed]:animate-out",
        "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
        "animate-duration-200 animate-ease-out"
    );

    private string GetClassNames() => ClassNames.cn(
        // Base positioning and sizing
        "fixed gap-4 p-6 left-[50%] top-[50%] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%]",
        "bg-background border border-border/60 dark:border-border/40 dark:ring-1 dark:ring-white/10",
        "shadow-xl dark:shadow-2xl",

        // Animation states with smooth easing
        "data-[state=open]:animate-in data-[state=closed]:animate-out",
        "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
        "data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-[0.9]",
        "animate-duration-300 animate-ease-cubic-out",

        // Responsive
        "sm:rounded-lg",
        // Custom classes
        Class
    );
}
