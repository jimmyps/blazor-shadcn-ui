@namespace BlazorUI.Primitives.MultiSelect

@* MultiSelectTag primitive - headless dismissible tag for selected items *@
<span role="listitem"
      data-value="@Value"
      @attributes="AdditionalAttributes">
    @if (ChildContent != null)
    {
        @ChildContent
    }
    else
    {
        @DisplayText
    }
    @if (!Disabled && OnRemove.HasDelegate)
    {
        <button type="button"
                aria-label="@($"Remove {DisplayText}")"
                disabled="@Disabled"
                @onclick="HandleRemove"
                @onclick:stopPropagation="true"
                @attributes="RemoveButtonAttributes">
            @if (RemoveButtonContent != null)
            {
                @RemoveButtonContent
            }
            else
            {
                <span aria-hidden="true">&times;</span>
            }
        </button>
    }
</span>

@code {
    /// <summary>
    /// The value associated with this tag.
    /// </summary>
    [Parameter]
    public string? Value { get; set; }

    /// <summary>
    /// The display text for this tag.
    /// If not provided, uses the Value.
    /// </summary>
    [Parameter]
    public string? DisplayText { get; set; }

    /// <summary>
    /// Custom content for the tag.
    /// If provided, overrides DisplayText.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Custom content for the remove button.
    /// If not provided, uses a default X character.
    /// </summary>
    [Parameter]
    public RenderFragment? RemoveButtonContent { get; set; }

    /// <summary>
    /// Whether the tag is disabled (cannot be removed).
    /// </summary>
    [Parameter]
    public bool Disabled { get; set; }

    /// <summary>
    /// Callback invoked when the remove button is clicked.
    /// </summary>
    [Parameter]
    public EventCallback OnRemove { get; set; }

    /// <summary>
    /// Additional attributes to apply to the tag element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    /// <summary>
    /// Additional attributes to apply to the remove button.
    /// </summary>
    [Parameter]
    public Dictionary<string, object>? RemoveButtonAttributes { get; set; }

    private string EffectiveDisplayText => DisplayText ?? Value ?? string.Empty;

    private async Task HandleRemove()
    {
        if (Disabled) return;

        await OnRemove.InvokeAsync();
    }
}
