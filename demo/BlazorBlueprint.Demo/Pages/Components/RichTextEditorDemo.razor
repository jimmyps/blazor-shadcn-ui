@page "/components/rich-text-editor"
@using BlazorBlueprint.Components.RichTextEditor
@using BlazorBlueprint.Components.Card
@using BlazorBlueprint.Components.Button
@using BlazorBlueprint.Components.Label
@using BlazorBlueprint.Components.Kbd

<PageTitle>Rich Text Editor - Blazor Blueprint</PageTitle>

<div class="space-y-10 max-w-4xl">
    <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Rich Text Editor</h1>
        <p class="text-xl text-muted-foreground">
            A WYSIWYG rich text editor built on Quill.js with toolbar formatting. Text is formatted directly as you type.
        </p>
    </div>

    @* Basic Example *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Usage</h2>
            <p class="text-muted-foreground">
                A simple rich text editor with two-way data binding. Formatting appears directly as you type.
            </p>
        </div>

        <div class="space-y-4">
            <RichTextEditor @bind-Value="basicValue" Placeholder="Start typing here..." />
            @RenderHtmlOutput(basicValue)
        </div>
    </section>

    @* With Label *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Label</h2>
            <p class="text-muted-foreground">
                Associate a label with the editor for better accessibility.
            </p>
        </div>

        <div class="space-y-4">
            <div class="space-y-2">
                <Label For="description-editor">Description</Label>
                <RichTextEditor @bind-Value="labeledValue"
                                Id="description-editor"
                                Placeholder="Enter a description..." />
            </div>
            @RenderHtmlOutput(labeledValue)
        </div>
    </section>

    @* Toolbar Presets *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Toolbar Presets</h2>
            <p class="text-muted-foreground">
                Choose from preset toolbar configurations to match your needs.
            </p>
        </div>

        <div class="grid gap-6">
            <div class="space-y-4">
                <div class="space-y-2">
                    <Label>Simple Toolbar</Label>
                    <RichTextEditor @bind-Value="simpleValue"
                                    Toolbar="ToolbarPreset.Simple"
                                    Placeholder="Basic formatting only..." />
                </div>
                @RenderHtmlOutput(simpleValue)
            </div>

            <div class="space-y-4">
                <div class="space-y-2">
                    <Label>Standard Toolbar (Default)</Label>
                    <RichTextEditor @bind-Value="standardValue"
                                    Toolbar="ToolbarPreset.Standard"
                                    Placeholder="Common formatting options..." />
                </div>
                @RenderHtmlOutput(standardValue)
            </div>

            <div class="space-y-4">
                <div class="space-y-2">
                    <Label>Full Toolbar</Label>
                    <RichTextEditor @bind-Value="fullValue"
                                    Toolbar="ToolbarPreset.Full"
                                    Placeholder="All formatting options..." />
                </div>
                @RenderHtmlOutput(fullValue)
            </div>

            <div class="space-y-4">
                <div class="space-y-2">
                    <Label>No Toolbar</Label>
                    <RichTextEditor @bind-Value="noToolbarValue"
                                    Toolbar="ToolbarPreset.None"
                                    Placeholder="Plain editor without toolbar..." />
                </div>
                @RenderHtmlOutput(noToolbarValue)
            </div>
        </div>
    </section>

    @* Toolbar Features Demo *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Toolbar Features</h2>
            <p class="text-muted-foreground">
                The toolbar provides quick access to formatting options. You can also use keyboard shortcuts.
            </p>
        </div>

        <div class="rounded-lg border p-6 space-y-4">
            <div class="space-y-3">
                <h3 class="font-semibold">Available Formatting (Full Toolbar)</h3>
                <ul class="space-y-2 text-sm text-muted-foreground list-disc list-inside">
                    <li><strong>Bold</strong> - Select text and click B or press <Kbd>Ctrl+B</Kbd></li>
                    <li><em>Italic</em> - Select text and click I or press <Kbd>Ctrl+I</Kbd></li>
                    <li><u>Underline</u> - Select text and click U or press <Kbd>Ctrl+U</Kbd></li>
                    <li><s>Strikethrough</s> - Select text and click the strikethrough button</li>
                    <li>Headers - H1, H2, H3 heading levels via dropdown</li>
                    <li>Bullet List - Click the bullet list icon</li>
                    <li>Numbered List - Click the numbered list icon</li>
                    <li>Link - Select text and click link icon to add URL</li>
                    <li>Blockquote - Add quoted text blocks</li>
                    <li>Code Block - Add code snippets</li>
                </ul>
            </div>
        </div>

        <div class="space-y-4">
            <RichTextEditor @bind-Value="toolbarDemoValue"
                            Toolbar="ToolbarPreset.Full"
                            Placeholder="Try out the toolbar features..." />
            @RenderHtmlOutput(toolbarDemoValue)
        </div>
    </section>

    @* Pre-populated Content *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Pre-populated Content</h2>
            <p class="text-muted-foreground">
                The editor can be initialized with existing HTML content.
            </p>
        </div>

        <div class="space-y-4">
            <RichTextEditor @bind-Value="prePopulatedValue" />
            @RenderHtmlOutput(prePopulatedValue)
        </div>
    </section>

    @* Height Control *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Height Control</h2>
            <p class="text-muted-foreground">
                Control the editor height with MaxHeight or fixed Height properties.
            </p>
        </div>

        <div class="grid gap-6">
            <div class="space-y-4">
                <div class="space-y-2">
                    <Label>MaxHeight="200px" (scrollbar appears after 200px)</Label>
                    <RichTextEditor @bind-Value="maxHeightValue"
                                    MaxHeight="200px"
                                    Placeholder="Type a lot of content to see the scrollbar..." />
                </div>
                @RenderHtmlOutput(maxHeightValue)
            </div>

            <div class="space-y-4">
                <div class="space-y-2">
                    <Label>Height="150px" (fixed height, always shows scrollbar when needed)</Label>
                    <RichTextEditor @bind-Value="fixedHeightValue"
                                    Height="150px"
                                    Placeholder="Fixed height editor..." />
                </div>
                @RenderHtmlOutput(fixedHeightValue)
            </div>
        </div>
    </section>

    @* Disabled State *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled State</h2>
            <p class="text-muted-foreground">
                The editor can be disabled to prevent user input.
            </p>
        </div>

        <RichTextEditor Value="<p>This editor is <strong>disabled</strong> and cannot be edited.</p>"
                        Disabled="true" />
    </section>

    @* Form Integration *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Integration</h2>
            <p class="text-muted-foreground">
                Use the editor within forms for content submission.
            </p>
        </div>

        <Card>
            <CardHeader>
                <CardTitle>Submit Feedback</CardTitle>
                <CardDescription>Share your thoughts with us using rich text formatting.</CardDescription>
            </CardHeader>
            <CardContent Class="space-y-4">
                <div class="space-y-2">
                    <Label For="feedback-editor">Your Feedback</Label>
                    <RichTextEditor @bind-Value="feedbackValue"
                                    Id="feedback-editor"
                                    Placeholder="What's on your mind?" />
                </div>
                @RenderHtmlOutput(feedbackValue)
            </CardContent>
            <CardFooter>
                <Button OnClick="HandleSubmit" Disabled="@string.IsNullOrWhiteSpace(feedbackValue)">
                    Submit Feedback
                </Button>
            </CardFooter>
        </Card>

        @if (submitted)
        {
            <div class="p-4 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 rounded-md">
                Feedback submitted successfully!
            </div>
        }
    </section>

    @* Usage Notes *@
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Usage Notes</h2>
        </div>

        <div class="rounded-lg border p-6 space-y-4">
            <div class="space-y-3">
                <h3 class="font-semibold">Setup Requirements</h3>
                <p class="text-sm text-muted-foreground">
                    Add Quill.js CSS to your <code class="bg-muted px-1 rounded">&lt;head&gt;</code>:
                </p>
                <pre class="text-xs bg-muted p-3 rounded-md overflow-auto">&lt;link href="https://cdn.jsdelivr.net/npm/quill@2/dist/quill.core.css" rel="stylesheet" /&gt;</pre>
                <p class="text-sm text-muted-foreground mt-2">
                    Add Quill.js script before the closing <code class="bg-muted px-1 rounded">&lt;/body&gt;</code> tag:
                </p>
                <pre class="text-xs bg-muted p-3 rounded-md overflow-auto">&lt;script src="https://cdn.jsdelivr.net/npm/quill@2/dist/quill.js"&gt;&lt;/script&gt;</pre>
            </div>

            <div class="space-y-3">
                <h3 class="font-semibold">Toolbar Presets</h3>
                <ul class="space-y-2 text-sm text-muted-foreground list-disc list-inside">
                    <li><strong>None</strong> - No toolbar, plain editing area</li>
                    <li><strong>Simple</strong> - Bold, italic, underline, and lists</li>
                    <li><strong>Standard</strong> - Headers, basic formatting, lists, links (default)</li>
                    <li><strong>Full</strong> - All formatting options including blockquote and code blocks</li>
                    <li><strong>Custom</strong> - Use ToolbarContent to provide your own toolbar</li>
                </ul>
            </div>

            <div class="space-y-3">
                <h3 class="font-semibold">Key Features</h3>
                <ul class="space-y-2 text-sm text-muted-foreground list-disc list-inside">
                    <li>WYSIWYG editing powered by Quill.js v2</li>
                    <li>Toolbar presets for different use cases</li>
                    <li>Keyboard shortcuts for bold, italic, and underline</li>
                    <li>Two-way data binding with @("@bind-Value")</li>
                    <li>Delta (JSON) binding available via @("@bind-DeltaValue")</li>
                    <li>Outputs clean HTML for storage and display</li>
                    <li>Height control via MinHeight, MaxHeight, and Height</li>
                    <li>Disabled and ReadOnly states</li>
                </ul>
            </div>

            <div class="space-y-3">
                <h3 class="font-semibold">Accessibility</h3>
                <ul class="space-y-2 text-sm text-muted-foreground list-disc list-inside">
                    <li>Supports ARIA labels and descriptions</li>
                    <li>Keyboard shortcuts for common formatting</li>
                    <li>Associate with Label component using Id parameter</li>
                    <li>Supports disabled and read-only states</li>
                    <li>Focus and blur event callbacks</li>
                </ul>
            </div>
        </div>
    </section>
</div>

@code {
    private string? basicValue;
    private string? labeledValue;
    private string? simpleValue;
    private string? standardValue;
    private string? fullValue;
    private string? noToolbarValue;
    private string? toolbarDemoValue;
    private string? feedbackValue;
    private string? maxHeightValue;
    private string? fixedHeightValue;
    private bool submitted;

    private string prePopulatedValue = @"<h2>Welcome to the Rich Text Editor</h2>
<p>This is a <strong>bold</strong> statement and this is <em>italic</em> text.</p>
<h3>Features</h3>
<ul>
<li>Write with visual formatting</li>
<li>See your changes immediately</li>
<li>Use keyboard shortcuts for quick formatting</li>
</ul>
<p>Enjoy writing!</p>";

    private void HandleSubmit()
    {
        submitted = true;
        StateHasChanged();
    }

    private RenderFragment RenderHtmlOutput(string? value) => builder =>
    {
        if (!string.IsNullOrEmpty(value))
        {
            builder.OpenElement(0, "div");
            builder.AddAttribute(1, "class", "mt-4 rounded-lg border bg-muted/30 p-4");

            builder.OpenElement(2, "div");
            builder.AddAttribute(3, "class", "text-xs font-medium text-muted-foreground mb-2");
            builder.AddContent(4, "HTML Output");
            builder.CloseElement();

            builder.OpenElement(5, "pre");
            builder.AddAttribute(6, "class", "text-xs bg-muted p-3 rounded-md overflow-auto whitespace-pre-wrap break-all");
            builder.AddContent(7, value);
            builder.CloseElement();

            builder.CloseElement();
        }
    };
}
