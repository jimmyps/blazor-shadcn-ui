@page "/components/dialog"
@using BlazorBlueprint.Components.Dialog
@using BlazorBlueprint.Components.Combobox

<PageTitle>Dialog Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Dialog Component</h1>
        <p class="text-xl text-muted-foreground">
            A window overlaid on either the primary window or another dialog window, rendering the content underneath inert.
        </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Simple Dialog</h2>
        <p class="text-sm text-muted-foreground">
            A basic dialog with title, description, and action buttons.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog
            </DialogTrigger>

            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Are you absolutely sure?</DialogTitle>
                    <DialogDescription>
                        This action cannot be undone. This will permanently delete your account
                        and remove your data from our servers.
                    </DialogDescription>
                </DialogHeader>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Dialog with Footer</h2>
        <p class="text-sm text-muted-foreground">
            Dialog with action buttons in the footer using DialogFooter component.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Edit Profile
            </DialogTrigger>

            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Edit profile</DialogTitle>
                    <DialogDescription>
                        Make changes to your profile here. Click save when you're done.
                    </DialogDescription>
                </DialogHeader>

                <div class="grid gap-4 py-4">
                    <div class="grid grid-cols-4 items-center gap-4">
                        <label for="name" class="text-right text-sm font-medium">
                            Name
                        </label>
                        <input id="name"
                               value="Pedro Duarte"
                               class="col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" />
                    </div>
                    <div class="grid grid-cols-4 items-center gap-4">
                        <label for="username" class="text-right text-sm font-medium">
                            Username
                        </label>
                        <input id="username"
                               value="@@peduarte"
                               class="col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" />
                    </div>
                </div>

                <DialogFooter>
                    <button type="submit"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Save changes
                    </button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Controlled Dialog</h2>
        <p class="text-sm text-muted-foreground">
            Control the dialog state programmatically using @@bind-Open.
        </p>

        <div class="flex gap-2">
            <button @onclick="() => isDialogOpen = true"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog
            </button>
        </div>

        <Dialog @bind-Open="isDialogOpen">
            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Controlled Dialog</DialogTitle>
                    <DialogDescription>
                        This dialog's open state is controlled from the parent component.
                        You can programmatically open and close it.
                    </DialogDescription>
                </DialogHeader>

                <div class="py-4">
                    <p class="text-sm">
                        Dialog is open: <strong>@isDialogOpen</strong>
                    </p>
                </div>

                <DialogFooter>
                    <button @onclick="() => isDialogOpen = false"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Cancel
                    </button>
                    <button @onclick="HandleSave"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Save
                    </button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Custom Width</h2>
        <p class="text-sm text-muted-foreground">
            Customize the dialog width using the Class parameter.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Wide Dialog
            </DialogTrigger>

            <DialogContent Class="max-w-3xl">
                <DialogHeader>
                    <DialogTitle>Wide Dialog</DialogTitle>
                    <DialogDescription>
                        This dialog uses a custom max-width class to be wider than the default.
                    </DialogDescription>
                </DialogHeader>

                <div class="py-4">
                    <p class="text-sm">
                        You can customize the dialog width by passing additional classes to the DialogContent component.
                        This example uses <code class="bg-muted px-1 py-0.5 rounded">max-w-3xl</code> instead of the default <code class="bg-muted px-1 py-0.5 rounded">max-w-lg</code>.
                    </p>
                </div>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Without Close Button</h2>
        <p class="text-sm text-muted-foreground">
            Hide the default close button using ShowClose="false".
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog
            </DialogTrigger>

            <DialogContent ShowClose="false">
                <DialogHeader>
                    <DialogTitle>Confirm Action</DialogTitle>
                    <DialogDescription>
                        This dialog doesn't have a close button in the top-right corner.
                        You must use one of the action buttons or press Escape to close.
                    </DialogDescription>
                </DialogHeader>

                <DialogFooter Class="mt-4">
                    <BlazorBlueprint.Primitives.Dialog.DialogClose class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Cancel
                    </BlazorBlueprint.Primitives.Dialog.DialogClose>
                    <BlazorBlueprint.Primitives.Dialog.DialogClose class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Confirm
                    </BlazorBlueprint.Primitives.Dialog.DialogClose>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">AsChild Pattern</h2>
        <p class="text-sm text-muted-foreground">
            Use AsChild to compose triggers with your own styled Button components instead of inline styles.
        </p>

        <div class="grid md:grid-cols-2 gap-6">
            <!-- Without AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">Without AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    DialogTrigger renders its own button element with inline classes.
                </p>
                <Dialog>
                    <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Open Dialog
                    </DialogTrigger>
                    <DialogContent>
                        <DialogHeader>
                            <DialogTitle>Without AsChild</DialogTitle>
                            <DialogDescription>
                                This dialog uses inline CSS classes on the trigger.
                            </DialogDescription>
                        </DialogHeader>
                    </DialogContent>
                </Dialog>
            </div>

            <!-- With AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">With AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    Button component receives trigger behavior via TriggerContext.
                </p>
                <Dialog>
                    <DialogTrigger AsChild>
                        <Button Variant="ButtonVariant.Destructive">
                            <LucideIcon Name="trash-2" Size="16" />
                            Delete Account
                        </Button>
                    </DialogTrigger>
                    <DialogContent>
                        <DialogHeader>
                            <DialogTitle>Delete Account</DialogTitle>
                            <DialogDescription>
                                This action cannot be undone. This will permanently delete your account.
                            </DialogDescription>
                        </DialogHeader>
                        <DialogFooter>
                            <DialogClose AsChild>
                                <Button Variant="ButtonVariant.Outline">Cancel</Button>
                            </DialogClose>
                            <Button Variant="ButtonVariant.Destructive">Delete</Button>
                        </DialogFooter>
                    </DialogContent>
                </Dialog>
            </div>
        </div>

        <div class="bg-muted p-4 rounded-md mt-4">
            <p class="text-sm font-medium mb-2">Code Example:</p>
            <pre class="text-sm overflow-x-auto"><code>&lt;Dialog&gt;
    &lt;DialogTrigger AsChild&gt;
        &lt;Button Variant="ButtonVariant.Destructive"&gt;
            Delete Account
        &lt;/Button&gt;
    &lt;/DialogTrigger&gt;
    &lt;DialogContent&gt;
        &lt;DialogHeader&gt;
            &lt;DialogTitle&gt;Delete Account&lt;/DialogTitle&gt;
        &lt;/DialogHeader&gt;
        &lt;DialogFooter&gt;
            &lt;DialogClose AsChild&gt;
                &lt;Button Variant="ButtonVariant.Outline"&gt;Cancel&lt;/Button&gt;
            &lt;/DialogClose&gt;
            &lt;Button Variant="ButtonVariant.Destructive"&gt;Delete&lt;/Button&gt;
        &lt;/DialogFooter&gt;
    &lt;/DialogContent&gt;
&lt;/Dialog&gt;</code></pre>
        </div>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Combobox in Dialog</h2>
        <p class="text-sm text-muted-foreground">
            Dialog containing a Combobox for selecting items. Tests nested portal behavior.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog with Combobox
            </DialogTrigger>

            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Select a Framework</DialogTitle>
                    <DialogDescription>
                        Use the combobox below to search and select a framework.
                    </DialogDescription>
                </DialogHeader>

                <div class="py-4">
                    <Combobox TItem="ComboboxFramework"
                             Items="comboboxFrameworks"
                             @bind-Value="selectedComboboxFramework"
                             ValueSelector="@(f => f.Value)"
                             DisplaySelector="@(f => f.Label)"
                             Placeholder="Select framework..."
                             SearchPlaceholder="Search framework..."
                             EmptyMessage="No framework found."
                             PopoverWidth="w-[300px]" />
                    @if (!string.IsNullOrEmpty(selectedComboboxFramework))
                    {
                        <p class="text-sm mt-2">Selected: <strong>@GetComboboxFrameworkLabel(selectedComboboxFramework)</strong></p>
                    }
                </div>

                <DialogFooter>
                    <BlazorBlueprint.Primitives.Dialog.DialogClose class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Cancel
                    </BlazorBlueprint.Primitives.Dialog.DialogClose>
                    <button class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Confirm Selection
                    </button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Features</h2>
        <ul class="list-disc list-inside space-y-2 text-sm">
            <li>Full keyboard navigation support</li>
            <li>Focus is automatically trapped within the dialog</li>
            <li>Can be controlled or uncontrolled</li>
            <li>Manages screen reader announcements with ARIA</li>
            <li>Scroll lock on body when dialog is open</li>
            <li>Respects prefers-reduced-motion</li>
        </ul>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Installation</h2>

        <div class="space-y-2">
            <p class="text-sm text-muted-foreground">Add the following using statement to your _Imports.razor:</p>
            <div class="bg-muted p-4 rounded-md">
                <code class="text-sm">@@using BlazorBlueprint.Components.Dialog</code>
            </div>
        </div>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Usage</h2>

        <div class="bg-muted p-4 rounded-md">
            <pre class="text-sm overflow-x-auto"><code>&lt;Dialog&gt;
    &lt;DialogTrigger&gt;Open&lt;/DialogTrigger&gt;
    &lt;DialogContent&gt;
        &lt;DialogHeader&gt;
            &lt;DialogTitle&gt;Are you absolutely sure?&lt;/DialogTitle&gt;
            &lt;DialogDescription&gt;
                This action cannot be undone.
            &lt;/DialogDescription&gt;
        &lt;/DialogHeader&gt;
    &lt;/DialogContent&gt;
&lt;/Dialog&gt;</code></pre>
        </div>
    </div>
</div>

@code {
    private bool isDialogOpen = false;
    private string? selectedComboboxFramework;

    private readonly List<ComboboxFramework> comboboxFrameworks = new()
    {
        new ComboboxFramework { Value = "blazor", Label = "Blazor" },
        new ComboboxFramework { Value = "react", Label = "React" },
        new ComboboxFramework { Value = "vue", Label = "Vue" },
        new ComboboxFramework { Value = "angular", Label = "Angular" },
        new ComboboxFramework { Value = "svelte", Label = "Svelte" },
        new ComboboxFramework { Value = "nextjs", Label = "Next.js" },
        new ComboboxFramework { Value = "nuxt", Label = "Nuxt" }
    };

    private void HandleSave()
    {
        // Handle save logic
        isDialogOpen = false;
    }

    private string GetComboboxFrameworkLabel(string? value) =>
        comboboxFrameworks.FirstOrDefault(f => f.Value == value)?.Label ?? value ?? "";

    public class ComboboxFramework
    {
        public required string Value { get; set; }
        public required string Label { get; set; }
    }
}
