@page "/primitives/table"
@using BlazorBlueprint.Primitives.Services
@using BlazorBlueprint.Primitives.Table
@using BlazorBlueprint.Primitives.Popover
@using BlazorBlueprint.Primitives.DropdownMenu
@using BlazorBlueprint.Components.Button
@using BlazorBlueprint.Components.Kbd
@using BlazorBlueprint.Icons.Lucide.Components

<PageTitle>Table Primitive - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-7xl">
    <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Table Primitive</h1>
        <p class="text-xl text-muted-foreground">
            Headless, unstyled table primitive with sorting, pagination, and selection capabilities.
        </p>
    </div>

    <div class="space-y-6">

    @* Basic Table Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Basic Table</h2>
            <p class="text-sm text-muted-foreground">Simple table with no sorting, pagination, or selection</p>
        </div>

        <div class="rounded-md border">
            <Table TData="Person" Data="@people" Class="w-full caption-bottom text-sm">
                <TableHeader Class="[&_tr]:border-b">
                    <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Name</TableHeaderCell>
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Email</TableHeaderCell>
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Age</TableHeaderCell>
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Department</TableHeaderCell>
                    </TableRow>
                </TableHeader>
                <TableBody Class="[&_tr:last-child]:border-0">
                    @foreach (var person in people)
                    {
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Age</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                        </TableRow>
                    }
                </TableBody>
            </Table>
        </div>
    </section>

    @* Row Actions Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Row Actions</h2>
            <p class="text-sm text-muted-foreground">Table with an actions dropdown menu for each row</p>
        </div>

        <div class="rounded-md border">
            <Table TData="Person" Data="@people" Class="w-full caption-bottom text-sm">
                <TableHeader Class="[&_tr]:border-b">
                    <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Name</TableHeaderCell>
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Email</TableHeaderCell>
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Department</TableHeaderCell>
                        <TableHeaderCell TData="Person" Class="h-12 px-4 text-right align-middle font-medium text-muted-foreground w-[70px]">Actions</TableHeaderCell>
                    </TableRow>
                </TableHeader>
                <TableBody Class="[&_tr:last-child]:border-0">
                    @foreach (var person in people)
                    {
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableCell Class="p-4 align-middle font-medium">@person.Name</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                            <TableCell Class="p-4 align-middle text-right">
                                <DropdownMenu>
                                    <DropdownMenuTrigger>
                                        <Button Variant="ButtonVariant.Ghost" Size="ButtonSize.Icon" Class="h-8 w-8" AriaLabel="Open menu">
                                            <LucideIcon Name="ellipsis" Size="16" />
                                        </Button>
                                    </DropdownMenuTrigger>
                                    <DropdownMenuContent Class="w-48 rounded-md border bg-popover p-1 text-popover-foreground shadow-md" Align="PopoverAlign.End">
                                        <BlazorBlueprint.Components.DropdownMenu.DropdownMenuLabel Class="px-2 py-1.5 text-sm font-semibold">Actions</BlazorBlueprint.Components.DropdownMenu.DropdownMenuLabel>
                                        <BlazorBlueprint.Components.DropdownMenu.DropdownMenuSeparator Class="my-1 h-px bg-muted" />
                                        <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground"
                                                          OnClick="@(() => HandleViewDetails(person))">
                                            <LucideIcon Name="eye" Size="16" Class="mr-2" />
                                            View details
                                        </DropdownMenuItem>
                                        <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground"
                                                          OnClick="@(() => HandleEdit(person))">
                                            <LucideIcon Name="pencil" Size="16" Class="mr-2" />
                                            Edit
                                        </DropdownMenuItem>
                                        <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground"
                                                          OnClick="@(() => HandleDuplicate(person))">
                                            <LucideIcon Name="copy" Size="16" Class="mr-2" />
                                            Duplicate
                                        </DropdownMenuItem>
                                        <BlazorBlueprint.Components.DropdownMenu.DropdownMenuSeparator Class="my-1 h-px bg-muted" />
                                        <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-destructive hover:text-destructive-foreground focus:bg-destructive focus:text-destructive-foreground text-destructive"
                                                          OnClick="@(() => HandleDelete(person))">
                                            <LucideIcon Name="trash-2" Size="16" Class="mr-2" />
                                            Delete
                                        </DropdownMenuItem>
                                    </DropdownMenuContent>
                                </DropdownMenu>
                            </TableCell>
                        </TableRow>
                    }
                </TableBody>
            </Table>
        </div>

        @if (!string.IsNullOrEmpty(actionMessage))
        {
            <div class="rounded-lg border bg-card p-4">
                <p class="text-sm">@actionMessage</p>
            </div>
        }
    </section>

    @* Sortable Table Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Sortable Table</h2>
            <p class="text-sm text-muted-foreground">Click column headers to sort. Three-state cycle: None → Ascending → Descending → None</p>
        </div>

        <div class="rounded-md border">
            <Table TData="Person" Data="@GetSortedPeople()" @bind-State="@sortableTableState" Class="w-full caption-bottom text-sm">
                <TableHeader Class="[&_tr]:border-b">
                    <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                        <TableHeaderCell TData="Person" ColumnId="name" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer select-none hover:bg-accent">
                            <div class="flex items-center gap-2">
                                <span>Name</span>
                                @if (sortableTableState.Sorting.SortedColumn == "name")
                                {
                                    @if (sortableTableState.Sorting.Direction == SortDirection.Ascending)
                                    {
                                        <span class="text-xs">↑</span>
                                    }
                                    else if (sortableTableState.Sorting.Direction == SortDirection.Descending)
                                    {
                                        <span class="text-xs">↓</span>
                                    }
                                }
                            </div>
                        </TableHeaderCell>
                        <TableHeaderCell TData="Person" ColumnId="email" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer select-none hover:bg-accent">
                            <div class="flex items-center gap-2">
                                <span>Email</span>
                                @if (sortableTableState.Sorting.SortedColumn == "email")
                                {
                                    @if (sortableTableState.Sorting.Direction == SortDirection.Ascending)
                                    {
                                        <span class="text-xs">↑</span>
                                    }
                                    else if (sortableTableState.Sorting.Direction == SortDirection.Descending)
                                    {
                                        <span class="text-xs">↓</span>
                                    }
                                }
                            </div>
                        </TableHeaderCell>
                        <TableHeaderCell TData="Person" ColumnId="age" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer select-none hover:bg-accent">
                            <div class="flex items-center gap-2">
                                <span>Age</span>
                                @if (sortableTableState.Sorting.SortedColumn == "age")
                                {
                                    @if (sortableTableState.Sorting.Direction == SortDirection.Ascending)
                                    {
                                        <span class="text-xs">↑</span>
                                    }
                                    else if (sortableTableState.Sorting.Direction == SortDirection.Descending)
                                    {
                                        <span class="text-xs">↓</span>
                                    }
                                }
                            </div>
                        </TableHeaderCell>
                        <TableHeaderCell TData="Person" ColumnId="department" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground cursor-pointer select-none hover:bg-accent">
                            <div class="flex items-center gap-2">
                                <span>Department</span>
                                @if (sortableTableState.Sorting.SortedColumn == "department")
                                {
                                    @if (sortableTableState.Sorting.Direction == SortDirection.Ascending)
                                    {
                                        <span class="text-xs">↑</span>
                                    }
                                    else if (sortableTableState.Sorting.Direction == SortDirection.Descending)
                                    {
                                        <span class="text-xs">↓</span>
                                    }
                                }
                            </div>
                        </TableHeaderCell>
                    </TableRow>
                </TableHeader>
                <TableBody Class="[&_tr:last-child]:border-0">
                    @foreach (var person in GetSortedPeople())
                    {
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Age</TableCell>
                            <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                        </TableRow>
                    }
                </TableBody>
            </Table>
        </div>

        <div class="rounded-lg border bg-card p-4">
            <h3 class="font-semibold mb-2">Current Sort State</h3>
            <div class="text-sm space-y-1">
                <p><span class="font-medium">Column:</span> @(sortableTableState.Sorting.SortedColumn ?? "None")</p>
                <p><span class="font-medium">Direction:</span> @sortableTableState.Sorting.Direction</p>
            </div>
        </div>
    </section>

    @* Paginated Table Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Paginated Table</h2>
            <p class="text-sm text-muted-foreground">Table with pagination controls and configurable page size</p>
        </div>

        <div class="space-y-4">
            <div class="rounded-md border">
                <Table TData="Person" Data="@largePeopleDataset" @bind-State="@paginatedTableState"
                       OnPageChange="@HandlePaginationChange"
                       OnPageSizeChange="@HandlePaginationChange"
                       Class="w-full caption-bottom text-sm">
                    <TableHeader Class="[&_tr]:border-b">
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Name</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Email</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Age</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Department</TableHeaderCell>
                        </TableRow>
                    </TableHeader>
                    <TableBody Class="[&_tr:last-child]:border-0">
                        @foreach (var person in GetPaginatedData())
                        {
                            <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                                <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Age</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                            </TableRow>
                        }
                    </TableBody>
                </Table>
            </div>

            <TablePagination TData="Person" State="@paginatedTableState.Pagination"
                             OnPageChange="@HandlePaginationChange"
                             OnPageSizeChange="@HandlePaginationChange">
                <PaginationTemplate Context="context">
                    <div class="flex items-center justify-between px-2">
                        <div class="flex-1 text-sm text-muted-foreground">
                            @context.GetPageInfoText()
                        </div>
                        <div class="flex items-center space-x-6 lg:space-x-8">
                            <div class="flex items-center space-x-2">
                                <p class="text-sm font-medium">Rows per page</p>
                                <select @onchange="@((e) => context.ChangePageSize(int.Parse(e.Value?.ToString() ?? "10")))"
                                        class="h-8 w-[70px] rounded-md border border-input bg-background px-2 py-1 text-sm">
                                    @foreach (var size in context.PageSizeOptions)
                                    {
                                        <option value="@size" selected="@(context.State.PageSize == size)">@size</option>
                                    }
                                </select>
                            </div>
                            <div class="flex w-[100px] items-center justify-center text-sm font-medium">
                                Page @context.State.CurrentPage of @context.State.TotalPages
                            </div>
                            <div class="flex items-center space-x-2">
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToFirstPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to first page">
                                    <LucideIcon Name="chevrons-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToPreviousPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to previous page">
                                    <LucideIcon Name="chevron-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToNextPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to next page">
                                    <LucideIcon Name="chevron-right" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToLastPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to last page">
                                    <LucideIcon Name="chevrons-right" Size="16" />
                                </Button>
                            </div>
                        </div>
                    </div>
                </PaginationTemplate>
            </TablePagination>
        </div>
    </section>

    @* Selectable Table Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Selectable Table (Multi-Select)</h2>
            <p class="text-sm text-muted-foreground">Click rows or checkboxes to select. Click header checkbox to select/deselect all. Use arrow keys to navigate and Enter/Space to select.</p>
        </div>

        <div class="flex items-center gap-2 mb-2">
            <input type="checkbox"
                   id="enableKeyboardNav"
                   checked="@enableKeyboardNavigation"
                   @onchange="@((e) => enableKeyboardNavigation = (bool)(e.Value ?? true))"
                   class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary" />
            <label for="enableKeyboardNav" class="text-sm font-medium">Enable keyboard navigation</label>
        </div>

        <div class="space-y-4">
            <div class="rounded-md border">
                <Table TData="Person" Data="@people" @bind-State="@selectableTableState"
                       SelectionMode="SelectionMode.Multiple"
                       EnableKeyboardNavigation="@enableKeyboardNavigation"
                       OnSelectionChange="@HandleSelectionChange"
                       Class="w-full caption-bottom text-sm">
                    <TableHeader Class="[&_tr]:border-b">
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableHeaderCell TData="Person" Class="h-12 w-12 px-4">
                                <input type="checkbox"
                                       checked="@selectAllChecked"
                                       @onchange="@((e) => { selectAllChecked = (bool)(e.Value ?? false); HandleSelectAllChanged(); })"
                                       class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary"
                                       aria-label="Select all" />
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Name</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Email</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Age</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Department</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-right align-middle font-medium text-muted-foreground w-[70px]">Actions</TableHeaderCell>
                        </TableRow>
                    </TableHeader>
                    <TableBody Class="[&_tr:last-child]:border-0">
                        @foreach (var person in people)
                        {
                            var isSelected = selectableTableState.Selection.IsSelected(person);
                            <TableRow TData="Person" Item="@person" Class="@($"border-b transition-colors hover:bg-muted/50 {(isSelected ? "bg-muted" : "")}")">
                                <TableCell Class="w-12 px-4">
                                    <input type="checkbox"
                                           checked="@isSelected"
                                           @onchange="@(() => ToggleRowSelection(person))"
                                           @onclick:stopPropagation="true"
                                           @onkeydown:stopPropagation="true"
                                           tabindex="-1"
                                           class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary"
                                           aria-label="@($"Select {person.Name}")" />
                                </TableCell>
                                <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Age</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                                <TableCell Class="p-4 align-middle text-right" @onclick:stopPropagation="true">
                                    <DropdownMenu>
                                        <DropdownMenuTrigger>
                                            <Button Variant="ButtonVariant.Ghost" Size="ButtonSize.Icon" Class="h-8 w-8" AriaLabel="Open menu">
                                                <LucideIcon Name="ellipsis" Size="16" />
                                            </Button>
                                        </DropdownMenuTrigger>
                                        <DropdownMenuContent Class="w-48 rounded-md border bg-popover p-1 text-popover-foreground shadow-md" Align="PopoverAlign.End">
                                            <BlazorBlueprint.Components.DropdownMenu.DropdownMenuLabel Class="px-2 py-1.5 text-sm font-semibold">Actions</BlazorBlueprint.Components.DropdownMenu.DropdownMenuLabel>
                                            <BlazorBlueprint.Components.DropdownMenu.DropdownMenuSeparator Class="my-1 h-px bg-muted" />
                                            <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground"
                                                              OnClick="@(() => HandleViewDetails(person))">
                                                <LucideIcon Name="eye" Size="16" Class="mr-2" />
                                                View details
                                            </DropdownMenuItem>
                                            <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground"
                                                              OnClick="@(() => HandleEdit(person))">
                                                <LucideIcon Name="pencil" Size="16" Class="mr-2" />
                                                Edit
                                            </DropdownMenuItem>
                                            <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground"
                                                              OnClick="@(() => HandleDuplicate(person))">
                                                <LucideIcon Name="copy" Size="16" Class="mr-2" />
                                                Duplicate
                                            </DropdownMenuItem>
                                            <BlazorBlueprint.Components.DropdownMenu.DropdownMenuSeparator Class="my-1 h-px bg-muted" />
                                            <DropdownMenuItem Class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-destructive hover:text-destructive-foreground focus:bg-destructive focus:text-destructive-foreground text-destructive"
                                                              OnClick="@(() => HandleDelete(person))">
                                                <LucideIcon Name="trash-2" Size="16" Class="mr-2" />
                                                Delete
                                            </DropdownMenuItem>
                                        </DropdownMenuContent>
                                    </DropdownMenu>
                                </TableCell>
                            </TableRow>
                        }
                    </TableBody>
                </Table>
            </div>

            <div class="rounded-lg border bg-card p-4">
                <h3 class="font-semibold mb-2">Selection State</h3>
                <div class="text-sm space-y-1">
                    <p><span class="font-medium">Selected:</span> @selectableTableState.Selection.SelectedCount rows</p>
                    @if (selectableTableState.Selection.SelectedCount > 0)
                    {
                        <div class="mt-2">
                            <button @onclick="@(() => { selectableTableState.Selection.Clear(); selectAllChecked = false; })"
                                    class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 px-4">
                                Clear Selection
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </section>

    @* Combined Features Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">All Features Combined</h2>
            <p class="text-sm text-muted-foreground">Filtering, sorting, pagination, and selection all working together</p>
        </div>

        <div class="space-y-4">
            <div class="rounded-md border">
                <Table TData="Person" Data="@GetSortedCombinedData()" @bind-State="@combinedTableState"
                       SelectionMode="SelectionMode.Multiple"
                       OnPageChange="@HandleCombinedPaginationChange"
                       OnPageSizeChange="@HandleCombinedPaginationChange"
                       OnSelectionChange="@HandleCombinedSelectionChange"
                       Class="w-full caption-bottom text-sm">
                    <TableHeader Class="[&_tr]:border-b">
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableHeaderCell TData="Person" Class="h-12 w-12 px-4">
                                <input type="checkbox"
                                       checked="@combinedSelectAllChecked"
                                       @onchange="@((e) => { combinedSelectAllChecked = (bool)(e.Value ?? false); HandleCombinedSelectAllChanged(); })"
                                       class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary"
                                       aria-label="Select all on page" />
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center justify-between gap-2">
                                    <div class="flex items-center gap-2 cursor-pointer select-none hover:text-foreground flex-1"
                                         @onclick="@(() => combinedTableState.Sorting.ToggleSort("name"))">
                                        <span>Name</span>
                                        @if (combinedTableState.Sorting.SortedColumn == "name")
                                        {
                                            @if (combinedTableState.Sorting.Direction == SortDirection.Ascending)
                                            {
                                                <span class="text-xs">↑</span>
                                            }
                                            else if (combinedTableState.Sorting.Direction == SortDirection.Descending)
                                            {
                                                <span class="text-xs">↓</span>
                                            }
                                        }
                                    </div>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(combinedNameFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter name">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Name</h4>
                                                <input type="text"
                                                       @bind="combinedNameFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => StateHasChanged())"
                                                       placeholder="Enter name..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(combinedNameFilter))
                                                {
                                                    <button @onclick="@(() => { combinedNameFilter = ""; StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center justify-between gap-2">
                                    <div class="flex items-center gap-2 cursor-pointer select-none hover:text-foreground flex-1"
                                         @onclick="@(() => combinedTableState.Sorting.ToggleSort("email"))">
                                        <span>Email</span>
                                        @if (combinedTableState.Sorting.SortedColumn == "email")
                                        {
                                            @if (combinedTableState.Sorting.Direction == SortDirection.Ascending)
                                            {
                                                <span class="text-xs">↑</span>
                                            }
                                            else if (combinedTableState.Sorting.Direction == SortDirection.Descending)
                                            {
                                                <span class="text-xs">↓</span>
                                            }
                                        }
                                    </div>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(combinedEmailFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter email">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Email</h4>
                                                <input type="text"
                                                       @bind="combinedEmailFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => StateHasChanged())"
                                                       placeholder="Enter email..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(combinedEmailFilter))
                                                {
                                                    <button @onclick="@(() => { combinedEmailFilter = ""; StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center justify-between gap-2">
                                    <div class="flex items-center gap-2 cursor-pointer select-none hover:text-foreground flex-1"
                                         @onclick="@(() => combinedTableState.Sorting.ToggleSort("age"))">
                                        <span>Age</span>
                                        @if (combinedTableState.Sorting.SortedColumn == "age")
                                        {
                                            @if (combinedTableState.Sorting.Direction == SortDirection.Ascending)
                                            {
                                                <span class="text-xs">↑</span>
                                            }
                                            else if (combinedTableState.Sorting.Direction == SortDirection.Descending)
                                            {
                                                <span class="text-xs">↓</span>
                                            }
                                        }
                                    </div>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(combinedAgeFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter age">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Age</h4>
                                                <input type="text"
                                                       @bind="combinedAgeFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => StateHasChanged())"
                                                       placeholder="Enter age..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(combinedAgeFilter))
                                                {
                                                    <button @onclick="@(() => { combinedAgeFilter = ""; StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center justify-between gap-2">
                                    <div class="flex items-center gap-2 cursor-pointer select-none hover:text-foreground flex-1"
                                         @onclick="@(() => combinedTableState.Sorting.ToggleSort("department"))">
                                        <span>Department</span>
                                        @if (combinedTableState.Sorting.SortedColumn == "department")
                                        {
                                            @if (combinedTableState.Sorting.Direction == SortDirection.Ascending)
                                            {
                                                <span class="text-xs">↑</span>
                                            }
                                            else if (combinedTableState.Sorting.Direction == SortDirection.Descending)
                                            {
                                                <span class="text-xs">↓</span>
                                            }
                                        }
                                    </div>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(combinedDepartmentFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter department">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Department</h4>
                                                <input type="text"
                                                       @bind="combinedDepartmentFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => StateHasChanged())"
                                                       placeholder="Enter department..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(combinedDepartmentFilter))
                                                {
                                                    <button @onclick="@(() => { combinedDepartmentFilter = ""; StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                        </TableRow>
                    </TableHeader>
                    <TableBody Class="[&_tr:last-child]:border-0">
                        @foreach (var person in GetCombinedPageData())
                        {
                            var isSelected = combinedTableState.Selection.IsSelected(person);
                            <TableRow TData="Person" Item="@person" Class="@($"border-b transition-colors hover:bg-muted/50 {(isSelected ? "bg-muted" : "")}")">
                                <TableCell Class="w-12 px-4">
                                    <input type="checkbox"
                                           checked="@isSelected"
                                           @onchange="@(() => ToggleCombinedRowSelection(person))"
                                           @onclick:stopPropagation="true"
                                           @onkeydown:stopPropagation="true"
                                           tabindex="-1"
                                           class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-2 focus:ring-primary"
                                           aria-label="@($"Select {person.Name}")" />
                                </TableCell>
                                <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Age</TableCell>
                                <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                            </TableRow>
                        }
                    </TableBody>
                </Table>
            </div>

            <TablePagination TData="Person" State="@combinedTableState.Pagination"
                             OnPageChange="@HandleCombinedPaginationChange"
                             OnPageSizeChange="@HandleCombinedPaginationChange">
                <PaginationTemplate Context="context">
                    <div class="flex items-center justify-between px-2">
                        <div class="flex-1 text-sm text-muted-foreground">
                            @{
                                var selectedOnPage = combinedTableState.Selection.SelectedCount;
                                var pageInfo = context.GetPageInfoText();
                            }
                            @pageInfo
                            @if (selectedOnPage > 0)
                            {
                                <span class="ml-2">(@selectedOnPage selected)</span>
                            }
                        </div>
                        <div class="flex items-center space-x-6 lg:space-x-8">
                            <div class="flex items-center space-x-2">
                                <p class="text-sm font-medium">Rows per page</p>
                                <select @onchange="@((e) => context.ChangePageSize(int.Parse(e.Value?.ToString() ?? "10")))"
                                        class="h-8 w-[70px] rounded-md border border-input bg-background px-2 py-1 text-sm">
                                    @foreach (var size in context.PageSizeOptions)
                                    {
                                        <option value="@size" selected="@(context.State.PageSize == size)">@size</option>
                                    }
                                </select>
                            </div>
                            <div class="flex w-[100px] items-center justify-center text-sm font-medium">
                                Page @context.State.CurrentPage of @context.State.TotalPages
                            </div>
                            <div class="flex items-center space-x-2">
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToFirstPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to first page">
                                    <LucideIcon Name="chevrons-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToPreviousPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to previous page">
                                    <LucideIcon Name="chevron-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToNextPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to next page">
                                    <LucideIcon Name="chevron-right" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToLastPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to last page">
                                    <LucideIcon Name="chevrons-right" Size="16" />
                                </Button>
                            </div>
                        </div>
                    </div>
                </PaginationTemplate>
            </TablePagination>

            <div class="rounded-lg border bg-card p-4">
                <h3 class="font-semibold mb-2">Current State</h3>
                <div class="text-sm space-y-1">
                    <p><span class="font-medium">Active Filters:</span> @(new[] { combinedNameFilter, combinedEmailFilter, combinedAgeFilter, combinedDepartmentFilter }.Count(f => !string.IsNullOrWhiteSpace(f)))</p>
                    <p><span class="font-medium">Sort Column:</span> @(combinedTableState.Sorting.SortedColumn ?? "None")</p>
                    <p><span class="font-medium">Sort Direction:</span> @combinedTableState.Sorting.Direction</p>
                    <p><span class="font-medium">Current Page:</span> @combinedTableState.Pagination.CurrentPage / @combinedTableState.Pagination.TotalPages</p>
                    <p><span class="font-medium">Selected Rows:</span> @combinedTableState.Selection.SelectedCount</p>
                    <p><span class="font-medium">Filtered Results:</span> @GetSortedCombinedData().Count() / @largePeopleDataset.Count</p>
                </div>
            </div>
        </div>
    </section>

    @* Column Filtering Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Column Filtering</h2>
            <p class="text-sm text-muted-foreground">Click filter icons in headers to filter by column</p>
        </div>

        <div class="space-y-4">
            <div class="rounded-md border">
                <Table TData="Person" Data="@GetFilteredPeople()" @bind-State="@filteredTableState"
                       OnPageChange="@HandleFilteredPaginationChange"
                       OnPageSizeChange="@HandleFilteredPaginationChange"
                       Class="w-full caption-bottom text-sm">
                    <TableHeader Class="[&_tr]:border-b">
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center gap-2">
                                    <span>Name</span>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(nameFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter name">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Name</h4>
                                                <input type="text"
                                                       @bind="nameFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => { filteredTableState.Pagination.Reset(); StateHasChanged(); })"
                                                       placeholder="Enter name..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(nameFilter))
                                                {
                                                    <button @onclick="@(() => { nameFilter = ""; filteredTableState.Pagination.Reset(); StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center gap-2">
                                    <span>Email</span>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(emailFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter email">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Email</h4>
                                                <input type="text"
                                                       @bind="emailFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => { filteredTableState.Pagination.Reset(); StateHasChanged(); })"
                                                       placeholder="Enter email..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(emailFilter))
                                                {
                                                    <button @onclick="@(() => { emailFilter = ""; filteredTableState.Pagination.Reset(); StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                <div class="flex items-center gap-2">
                                    <span>Department</span>
                                    <Popover>
                                        <PopoverTrigger>
                                            <button class="inline-flex items-center justify-center h-6 w-6 rounded hover:bg-accent @(!string.IsNullOrWhiteSpace(departmentFilter) ? "text-primary" : "text-muted-foreground")"
                                                    aria-label="Filter department">
                                                <LucideIcon Name="filter" Size="14" />
                                            </button>
                                        </PopoverTrigger>
                                        <PopoverContent Class="w-64 p-4 bg-popover text-popover-foreground rounded-md border shadow-md" Align="PopoverAlign.Start">
                                            <div class="space-y-2">
                                                <h4 class="font-medium text-sm">Filter by Department</h4>
                                                <input type="text"
                                                       @bind="departmentFilter"
                                                       @bind:event="oninput"
                                                       @onchange="@((e) => { filteredTableState.Pagination.Reset(); StateHasChanged(); })"
                                                       placeholder="Enter department..."
                                                       class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
                                                @if (!string.IsNullOrWhiteSpace(departmentFilter))
                                                {
                                                    <button @onclick="@(() => { departmentFilter = ""; filteredTableState.Pagination.Reset(); StateHasChanged(); })"
                                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground">
                                                        Clear
                                                    </button>
                                                }
                                            </div>
                                        </PopoverContent>
                                    </Popover>
                                </div>
                            </TableHeaderCell>
                        </TableRow>
                    </TableHeader>
                    <TableBody Class="[&_tr:last-child]:border-0">
                        @{
                            var filteredPeople = GetFilteredPageData().ToList();
                        }
                        @if (filteredPeople.Any())
                        {
                            @foreach (var person in filteredPeople)
                            {
                                <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                                    <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                                    <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                                    <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                                </TableRow>
                            }
                        }
                        else
                        {
                            <TableRow TData="Person" Class="border-b">
                                <TableCell Class="p-4 align-middle text-center text-muted-foreground" colspan="3">
                                    No results found
                                </TableCell>
                            </TableRow>
                        }
                    </TableBody>
                </Table>
            </div>

            <TablePagination TData="Person" State="@filteredTableState.Pagination"
                             OnPageChange="@HandleFilteredPaginationChange"
                             OnPageSizeChange="@HandleFilteredPaginationChange">
                <PaginationTemplate Context="context">
                    <div class="flex items-center justify-between px-2">
                        <div class="flex-1 text-sm text-muted-foreground">
                            @context.GetPageInfoText()
                        </div>
                        <div class="flex items-center space-x-6 lg:space-x-8">
                            <div class="flex items-center space-x-2">
                                <p class="text-sm font-medium">Rows per page</p>
                                <select @onchange="@((e) => context.ChangePageSize(int.Parse(e.Value?.ToString() ?? "10")))"
                                        class="h-8 w-[70px] rounded-md border border-input bg-background px-2 py-1 text-sm">
                                    @foreach (var size in context.PageSizeOptions)
                                    {
                                        <option value="@size" selected="@(context.State.PageSize == size)">@size</option>
                                    }
                                </select>
                            </div>
                            <div class="flex w-[100px] items-center justify-center text-sm font-medium">
                                Page @context.State.CurrentPage of @context.State.TotalPages
                            </div>
                            <div class="flex items-center space-x-2">
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToFirstPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to first page">
                                    <LucideIcon Name="chevrons-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToPreviousPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to previous page">
                                    <LucideIcon Name="chevron-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToNextPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to next page">
                                    <LucideIcon Name="chevron-right" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToLastPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to last page">
                                    <LucideIcon Name="chevrons-right" Size="16" />
                                </Button>
                            </div>
                        </div>
                    </div>
                </PaginationTemplate>
            </TablePagination>

            <div class="rounded-lg border bg-card p-4">
                <h3 class="font-semibold mb-2">Filter State</h3>
                <div class="text-sm space-y-1">
                    <p><span class="font-medium">Active Filters:</span> @(new[] { nameFilter, emailFilter, departmentFilter }.Count(f => !string.IsNullOrWhiteSpace(f)))</p>
                    <p><span class="font-medium">Results:</span> @GetFilteredPeople().Count() / @people.Count</p>
                    @if (new[] { nameFilter, emailFilter, departmentFilter }.Any(f => !string.IsNullOrWhiteSpace(f)))
                    {
                        <button @onclick="@(() => { nameFilter = ""; emailFilter = ""; departmentFilter = ""; StateHasChanged(); })"
                                class="mt-2 inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 px-4">
                            Clear Filters
                        </button>
                    }
                </div>
            </div>
        </div>
    </section>

    @* Global Search Example *@
    <section class="space-y-4">
        <div>
            <h2 class="text-2xl font-semibold">Global Search</h2>
            <p class="text-sm text-muted-foreground">Search across all columns simultaneously</p>
        </div>

        <div class="space-y-4">
            <div class="flex items-center gap-4">
                <input type="text"
                       @bind="globalSearchFilter"
                       @bind:event="oninput"
                       @onchange="@(() => { globalSearchTableState.Pagination.Reset(); StateHasChanged(); })"
                       placeholder="Search across all columns..."
                       class="flex-1 h-10 px-3 rounded-md border border-input bg-background" />
                @if (!string.IsNullOrWhiteSpace(globalSearchFilter))
                {
                    <button @onclick="@(() => { globalSearchFilter = ""; globalSearchTableState.Pagination.Reset(); StateHasChanged(); })"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4">
                        Clear
                    </button>
                }
            </div>

            <div class="rounded-md border">
                <Table TData="Person" Data="@GetGloballyFilteredPeople()" @bind-State="@globalSearchTableState"
                       OnPageChange="@HandleGlobalSearchPaginationChange"
                       OnPageSizeChange="@HandleGlobalSearchPaginationChange"
                       Class="w-full caption-bottom text-sm">
                    <TableHeader Class="[&_tr]:border-b">
                        <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Name</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Email</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Age</TableHeaderCell>
                            <TableHeaderCell TData="Person" Class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">Department</TableHeaderCell>
                        </TableRow>
                    </TableHeader>
                    <TableBody Class="[&_tr:last-child]:border-0">
                        @{
                            var globalFilteredPeople = GetGlobalSearchPageData().ToList();
                        }
                        @if (globalFilteredPeople.Any())
                        {
                            @foreach (var person in globalFilteredPeople)
                            {
                                <TableRow TData="Person" Class="border-b transition-colors hover:bg-muted/50">
                                    <TableCell Class="p-4 align-middle">@person.Name</TableCell>
                                    <TableCell Class="p-4 align-middle">@person.Email</TableCell>
                                    <TableCell Class="p-4 align-middle">@person.Age</TableCell>
                                    <TableCell Class="p-4 align-middle">@person.Department</TableCell>
                                </TableRow>
                            }
                        }
                        else
                        {
                            <TableRow TData="Person" Class="border-b">
                                <TableCell Class="p-4 align-middle text-center text-muted-foreground" colspan="4">
                                    No results found for "@globalSearchFilter"
                                </TableCell>
                            </TableRow>
                        }
                    </TableBody>
                </Table>
            </div>

            <TablePagination TData="Person" State="@globalSearchTableState.Pagination"
                             OnPageChange="@HandleGlobalSearchPaginationChange"
                             OnPageSizeChange="@HandleGlobalSearchPaginationChange">
                <PaginationTemplate Context="context">
                    <div class="flex items-center justify-between px-2">
                        <div class="flex-1 text-sm text-muted-foreground">
                            @context.GetPageInfoText()
                        </div>
                        <div class="flex items-center space-x-6 lg:space-x-8">
                            <div class="flex items-center space-x-2">
                                <p class="text-sm font-medium">Rows per page</p>
                                <select @onchange="@((e) => context.ChangePageSize(int.Parse(e.Value?.ToString() ?? "10")))"
                                        class="h-8 w-[70px] rounded-md border border-input bg-background px-2 py-1 text-sm">
                                    @foreach (var size in context.PageSizeOptions)
                                    {
                                        <option value="@size" selected="@(context.State.PageSize == size)">@size</option>
                                    }
                                </select>
                            </div>
                            <div class="flex w-[100px] items-center justify-center text-sm font-medium">
                                Page @context.State.CurrentPage of @context.State.TotalPages
                            </div>
                            <div class="flex items-center space-x-2">
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToFirstPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to first page">
                                    <LucideIcon Name="chevrons-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToPreviousPage"
                                        Disabled="@(!context.State.CanGoPrevious)"
                                        AriaLabel="Go to previous page">
                                    <LucideIcon Name="chevron-left" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToNextPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to next page">
                                    <LucideIcon Name="chevron-right" Size="16" />
                                </Button>
                                <Button Variant="ButtonVariant.Outline"
                                        Size="ButtonSize.Icon"
                                        OnClick="@context.GoToLastPage"
                                        Disabled="@(!context.State.CanGoNext)"
                                        AriaLabel="Go to last page">
                                    <LucideIcon Name="chevrons-right" Size="16" />
                                </Button>
                            </div>
                        </div>
                    </div>
                </PaginationTemplate>
            </TablePagination>

            <div class="rounded-lg border bg-card p-4">
                <h3 class="font-semibold mb-2">Search Results</h3>
                <div class="text-sm space-y-1">
                    <p><span class="font-medium">Query:</span> @(string.IsNullOrWhiteSpace(globalSearchFilter) ? "None" : $"\"{globalSearchFilter}\"")</p>
                    <p><span class="font-medium">Results:</span> @GetGloballyFilteredPeople().Count() / @people.Count</p>
                </div>
            </div>
        </div>
    </section>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Accessibility Features</h2>
                <p class="text-muted-foreground">
                    Built-in accessibility features following WAI-ARIA design patterns.
                </p>
            </div>

            <div class="rounded-lg border p-6 space-y-3 bg-muted/50">
                <div>
                    <h3 class="font-semibold mb-2">ARIA Attributes</h3>
                    <ul class="space-y-2 text-sm text-muted-foreground">
                        <li class="flex items-start gap-2">
                            <span class="text-green-600 dark:text-green-400">✓</span>
                            <span><code class="text-xs bg-muted px-1 py-0.5 rounded">role="grid"</code> for screen readers</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-600 dark:text-green-400">✓</span>
                            <span><code class="text-xs bg-muted px-1 py-0.5 rounded">aria-sort</code> indicates column sort direction</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-600 dark:text-green-400">✓</span>
                            <span><code class="text-xs bg-muted px-1 py-0.5 rounded">aria-selected</code> indicates row selection state</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-600 dark:text-green-400">✓</span>
                            <span><code class="text-xs bg-muted px-1 py-0.5 rounded">aria-rowcount</code> for total row count</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-600 dark:text-green-400">✓</span>
                            <span>Focusable rows with visible focus indicator</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Keyboard Shortcuts</h2>
                <p class="text-muted-foreground">
                    Navigate and interact with the table using keyboard.
                </p>
            </div>

            <div class="rounded-lg border p-6 space-y-3 bg-muted/50">
                <div class="grid gap-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium">Navigate to next row</span>
                        <Kbd>ArrowDown</Kbd>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium">Navigate to previous row</span>
                        <Kbd>ArrowUp</Kbd>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium">Toggle row selection</span>
                        <Kbd>Enter / Space</Kbd>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium">Sort column</span>
                        <span class="text-sm text-muted-foreground">Click header</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">API Reference</h2>
                <p class="text-muted-foreground">
                    Component properties and parameters.
                </p>
            </div>

            <div class="space-y-4">
                <div class="rounded-lg border p-4">
                    <h3 class="font-semibold mb-3">Table</h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">Data</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>IEnumerable&lt;TData&gt;</code><br/>
                                The data source for the table.
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">State</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>TableState&lt;TData&gt;?</code><br/>
                                The table state for controlled mode. Use with @@bind-State for two-way binding.
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">SelectionMode</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>SelectionMode</code><br/>
                                <strong>Default:</strong> <code>None</code><br/>
                                The selection mode: None, Single, or Multiple.
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">EnableKeyboardNavigation</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>bool</code><br/>
                                <strong>Default:</strong> <code>true</code><br/>
                                Enables keyboard navigation for table rows (arrow keys to navigate, Enter/Space to select).
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">ManualPagination</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>bool</code><br/>
                                <strong>Default:</strong> <code>false</code><br/>
                                When true, the table will not automatically set TotalItems.
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">OnSelectionChange</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>EventCallback&lt;IReadOnlyCollection&lt;TData&gt;&gt;</code><br/>
                                Callback invoked when the selection changes.
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">OnSortChange</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>EventCallback&lt;(string, SortDirection)&gt;</code><br/>
                                Callback invoked when sorting changes.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="rounded-lg border p-4">
                    <h3 class="font-semibold mb-3">TableRow</h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">Item</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>TData?</code><br/>
                                The data item for this row. Required for selection to work.
                            </p>
                        </div>
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">Class</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>string?</code><br/>
                                Additional CSS classes to apply to the row.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="rounded-lg border p-4">
                    <h3 class="font-semibold mb-3">TableHeaderCell</h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <code class="text-xs bg-muted px-1 py-0.5 rounded">ColumnId</code>
                            <p class="text-muted-foreground mt-1">
                                <strong>Type:</strong> <code>string?</code><br/>
                                The column identifier. When provided, clicking the header toggles sorting.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

@code {
    private List<Person> people = new();
    private List<Person> largePeopleDataset = new();

    private TableState<Person> sortableTableState = new();
    private TableState<Person> paginatedTableState = new() { Pagination = { PageSize = 5 } };
    private TableState<Person> selectableTableState = new();
    private TableState<Person> combinedTableState = new() { Pagination = { PageSize = 5 } };
    private TableState<Person> filteredTableState = new();
    private TableState<Person> globalSearchTableState = new();

    private bool selectAllChecked = false;
    private bool combinedSelectAllChecked = false;
    private string actionMessage = "";
    private bool enableKeyboardNavigation = true;

    // Row action handlers
    private void HandleViewDetails(Person person)
    {
        actionMessage = $"Viewing details for {person.Name}";
    }

    private void HandleEdit(Person person)
    {
        actionMessage = $"Editing {person.Name}";
    }

    private void HandleDuplicate(Person person)
    {
        actionMessage = $"Duplicating {person.Name}";
    }

    private void HandleDelete(Person person)
    {
        actionMessage = $"Deleting {person.Name}";
    }

    // Filter input values
    private string nameFilter = "";
    private string emailFilter = "";
    private string departmentFilter = "";

    // Combined table filter values
    private string combinedNameFilter = "";
    private string combinedEmailFilter = "";
    private string combinedAgeFilter = "";
    private string combinedDepartmentFilter = "";

    // Global search value
    private string globalSearchFilter = "";

    protected override void OnInitialized()
    {
        // Set selection modes on the selection state
        selectableTableState.Selection.Mode = SelectionMode.Multiple;
        combinedTableState.Selection.Mode = SelectionMode.Multiple;

        // Generate sample data - small dataset
        people = new List<Person>
        {
            new Person { Id = 1, Name = "John Doe", Email = "john@example.com", Age = 32, Department = "Engineering" },
            new Person { Id = 2, Name = "Jane Smith", Email = "jane@example.com", Age = 28, Department = "Design" },
            new Person { Id = 3, Name = "Bob Johnson", Email = "bob@example.com", Age = 45, Department = "Sales" },
            new Person { Id = 4, Name = "Alice Williams", Email = "alice@example.com", Age = 35, Department = "Engineering" },
            new Person { Id = 5, Name = "Charlie Brown", Email = "charlie@example.com", Age = 29, Department = "Marketing" },
            new Person { Id = 6, Name = "Diana Prince", Email = "diana@example.com", Age = 31, Department = "Design" },
            new Person { Id = 7, Name = "Eve Davis", Email = "eve@example.com", Age = 27, Department = "Sales" },
            new Person { Id = 8, Name = "Frank Miller", Email = "frank@example.com", Age = 38, Department = "Engineering" },
        };

        // Generate larger dataset for pagination demo
        largePeopleDataset = new List<Person>();
        var firstNames = new[] { "Mathew", "John", "Jane", "Bob", "Alice", "Charlie", "Diana", "Eve", "Frank", "Grace", "Henry", "Ivy", "Jack", "Kate", "Leo", "Mary", "Nathan", "Olivia", "Paul", "Quinn", "Rachel", "Samuel", "Tina", "Uma", "Victor", "Wendy", "Xavier", "Yolanda", "Zachary", "Aria", "Blake", "Noah", "Liam", "Sophia", "Emma", "Mason", "Lucas", "Chloe", "Lily", "Owen", "Zoey" };
        var lastNames = new[] { "Taylor", "Doe", "Smith", "Johnson", "Williams", "Brown", "Jones", "Garcia", "Miller", "Davis", "Rodriguez", "Martinez", "Hernandez", "Lopez", "Gonzalez", "Wilson", "Anderson", "Thomas", "Moore", "Jackson", "Martin", "Lee", "Perez", "Thompson", "White", "Harris", "Sanchez", "Clark", "Ramirez", "Lewis", "Robinson", "Bennett", "Graham", "Foster", "Coleman", "Hughes", "Cruz", "Reed", "Cook", "Morgan", "Bell" };
        var departments = new[] { "Engineering", "Design", "Sales", "Marketing", "HR", "Finance", "Operations", "Support" };

        for (int i = 0; i < 500; i++)
        {
            var firstNameIndex = i % firstNames.Length;
            var lastNameIndex = (i / firstNames.Length + i) % lastNames.Length;
            var firstName = firstNames[firstNameIndex];
            var lastName = lastNames[lastNameIndex];

            largePeopleDataset.Add(new Person
            {
                Id = i + 1,
                Name = $"{firstName} {lastName}",
                Email = $"{firstName.ToLower()}.{lastName.ToLower()}@example.com",
                Age = 22 + (i % 40),
                Department = departments[i % departments.Length]
            });
        }

        // Explicitly set TotalItems for pagination to work correctly
        paginatedTableState.Pagination.TotalItems = largePeopleDataset.Count;
        combinedTableState.Pagination.TotalItems = largePeopleDataset.Count;
    }

    // Pagination change handlers
    private void HandlePaginationChange(int page)
    {
        // Trigger re-render of the demo page so GetPaginatedData() is called again
        StateHasChanged();
    }

    private void HandleCombinedPaginationChange(int page)
    {
        // Trigger re-render of the demo page
        StateHasChanged();
    }

    // Selection change handlers
    private void HandleSelectionChange(IReadOnlyCollection<Person> selectedItems)
    {
        UpdateSelectAllCheckbox();
        StateHasChanged();
    }

    private void HandleCombinedSelectionChange(IReadOnlyCollection<Person> selectedItems)
    {
        UpdateCombinedSelectAllCheckbox();
        StateHasChanged();
    }

    // Manual sorting for sortable table
    private IEnumerable<Person> GetSortedPeople()
    {
        var data = people.AsEnumerable();
        var sorting = sortableTableState.Sorting;

        if (sorting.SortedColumn == null || sorting.Direction == SortDirection.None)
            return data;

        return sorting.SortedColumn switch
        {
            "name" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Name)
                : data.OrderByDescending(p => p.Name),
            "email" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Email)
                : data.OrderByDescending(p => p.Email),
            "age" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Age)
                : data.OrderByDescending(p => p.Age),
            "department" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Department)
                : data.OrderByDescending(p => p.Department),
            _ => data
        };
    }

    // Manual pagination for paginated table
    private IEnumerable<Person> GetPaginatedData()
    {
        var pagination = paginatedTableState.Pagination;
        var skip = (pagination.CurrentPage - 1) * pagination.PageSize;
        return largePeopleDataset.Skip(skip).Take(pagination.PageSize);
    }

    // Manual filtering and sorting for combined table
    private IEnumerable<Person> GetSortedCombinedData()
    {
        var data = largePeopleDataset.AsEnumerable();

        // Apply filters first
        if (!string.IsNullOrWhiteSpace(combinedNameFilter))
        {
            data = data.Where(p => p.Name.Contains(combinedNameFilter, StringComparison.OrdinalIgnoreCase));
        }

        if (!string.IsNullOrWhiteSpace(combinedEmailFilter))
        {
            data = data.Where(p => p.Email.Contains(combinedEmailFilter, StringComparison.OrdinalIgnoreCase));
        }

        if (!string.IsNullOrWhiteSpace(combinedAgeFilter))
        {
            data = data.Where(p => p.Age.ToString().Contains(combinedAgeFilter, StringComparison.OrdinalIgnoreCase));
        }

        if (!string.IsNullOrWhiteSpace(combinedDepartmentFilter))
        {
            data = data.Where(p => p.Department.Contains(combinedDepartmentFilter, StringComparison.OrdinalIgnoreCase));
        }

        // Then apply sorting
        var sorting = combinedTableState.Sorting;
        if (sorting.SortedColumn == null || sorting.Direction == SortDirection.None)
            return data;

        return sorting.SortedColumn switch
        {
            "name" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Name)
                : data.OrderByDescending(p => p.Name),
            "email" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Email)
                : data.OrderByDescending(p => p.Email),
            "age" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Age)
                : data.OrderByDescending(p => p.Age),
            "department" => sorting.Direction == SortDirection.Ascending
                ? data.OrderBy(p => p.Department)
                : data.OrderByDescending(p => p.Department),
            _ => data
        };
    }

    // Manual pagination for combined table
    private IEnumerable<Person> GetCombinedPageData()
    {
        var sortedData = GetSortedCombinedData().ToList();
        var pagination = combinedTableState.Pagination;

        // Update total items based on filtered/sorted data
        pagination.TotalItems = sortedData.Count;

        var skip = (pagination.CurrentPage - 1) * pagination.PageSize;
        return sortedData.Skip(skip).Take(pagination.PageSize);
    }

    // Selection handlers
    private void ToggleRowSelection(Person person)
    {
        selectableTableState.Selection.Toggle(person);
        UpdateSelectAllCheckbox();
        StateHasChanged();
    }

    private void ToggleCombinedRowSelection(Person person)
    {
        combinedTableState.Selection.Toggle(person);
        UpdateCombinedSelectAllCheckbox();
        StateHasChanged();
    }

    private void HandleSelectAllChanged()
    {
        if (selectAllChecked)
        {
            selectableTableState.Selection.SelectAll(people);
        }
        else
        {
            selectableTableState.Selection.Clear();
        }
        StateHasChanged();
    }

    private void HandleCombinedSelectAllChanged()
    {
        var pageData = GetCombinedPageData().ToList();
        if (combinedSelectAllChecked)
        {
            combinedTableState.Selection.SelectAll(pageData);
        }
        else
        {
            combinedTableState.Selection.DeselectAll(pageData);
        }
        StateHasChanged();
    }

    private void UpdateSelectAllCheckbox()
    {
        selectAllChecked = people.All(p => selectableTableState.Selection.IsSelected(p));
    }

    private void UpdateCombinedSelectAllCheckbox()
    {
        var pageData = GetCombinedPageData().ToList();
        combinedSelectAllChecked = pageData.All(p => combinedTableState.Selection.IsSelected(p)) && pageData.Any();
    }

    // Column filtering
    private IEnumerable<Person> GetFilteredPeople()
    {
        var data = largePeopleDataset.AsEnumerable();

        // Apply column filters using AND logic
        if (!string.IsNullOrWhiteSpace(nameFilter))
        {
            data = data.Where(p => p.Name.Contains(nameFilter, StringComparison.OrdinalIgnoreCase));
        }

        if (!string.IsNullOrWhiteSpace(emailFilter))
        {
            data = data.Where(p => p.Email.Contains(emailFilter, StringComparison.OrdinalIgnoreCase));
        }

        if (!string.IsNullOrWhiteSpace(departmentFilter))
        {
            data = data.Where(p => p.Department.Contains(departmentFilter, StringComparison.OrdinalIgnoreCase));
        }

        return data;
    }

    // Manual pagination for filtered table
    private IEnumerable<Person> GetFilteredPageData()
    {
        var filteredData = GetFilteredPeople().ToList();
        var pagination = filteredTableState.Pagination;

        // Update total items based on filtered data
        pagination.TotalItems = filteredData.Count;

        var skip = (pagination.CurrentPage - 1) * pagination.PageSize;
        return filteredData.Skip(skip).Take(pagination.PageSize);
    }

    private void HandleFilteredPaginationChange()
    {
        StateHasChanged();
    }

    // Global search filtering
    private IEnumerable<Person> GetGloballyFilteredPeople()
    {
        var data = largePeopleDataset.AsEnumerable();

        if (string.IsNullOrWhiteSpace(globalSearchFilter))
        {
            return data;
        }

        // Search across all text columns
        return data.Where(p =>
            p.Name.Contains(globalSearchFilter, StringComparison.OrdinalIgnoreCase) ||
            p.Email.Contains(globalSearchFilter, StringComparison.OrdinalIgnoreCase) ||
            p.Department.Contains(globalSearchFilter, StringComparison.OrdinalIgnoreCase) ||
            p.Age.ToString().Contains(globalSearchFilter, StringComparison.OrdinalIgnoreCase)
        );
    }

    // Manual pagination for global search table
    private IEnumerable<Person> GetGlobalSearchPageData()
    {
        var filteredData = GetGloballyFilteredPeople().ToList();
        var pagination = globalSearchTableState.Pagination;

        // Update total items based on filtered data
        pagination.TotalItems = filteredData.Count;

        var skip = (pagination.CurrentPage - 1) * pagination.PageSize;
        return filteredData.Skip(skip).Take(pagination.PageSize);
    }

    private void HandleGlobalSearchPaginationChange()
    {
        StateHasChanged();
    }

    public class Person
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public int Age { get; set; }
        public string Department { get; set; } = string.Empty;
    }
}
