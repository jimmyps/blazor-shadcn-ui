@page "/components/dialog"
@using BlazorUI.Components.Dialog
@using BlazorUI.Components.Combobox
@using BlazorUI.Components.Input
@using BlazorUI.Components.MaskedInput
@using BlazorUI.Components.DatePicker
@using BlazorUI.Components.ColorPicker
@using BlazorUI.Components.Textarea
@using BlazorUI.Components.Slider
@using BlazorUI.Components.MultiSelect
@using BlazorUI.Components.NumericInput
@using BlazorUI.Components.RangeSlider
@using BlazorUI.Components.Rating
@using BlazorUI.Components.CurrencyInput
@using BlazorUI.Components.Alert
@using BlazorUI.Components.Field
@using BlazorUI.Components.Separator
@using BlazorUI.Components.ScrollArea
@using BlazorUI.Components.Collapsible
@using BlazorUI.Components.Toast
@using BlazorUI.Components.Extensions
@using System.ComponentModel.DataAnnotations
@using System.Text.Json
@inject IToastService ToastService

<PageTitle>Dialog Component - BlazorUI</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">Dialog Component</h1>
            <p class="text-xl text-muted-foreground">
                A window overlaid on either the primary window or another dialog window, rendering the content underneath inert.
            </p>
        </div>
    </div>

    <div class="space-y-6">
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Simple Dialog</h2>
        <p class="text-sm text-muted-foreground">
            A basic dialog with title, description, and action buttons.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog
            </DialogTrigger>

            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Are you absolutely sure?</DialogTitle>
                    <DialogDescription>
                        This action cannot be undone. This will permanently delete your account
                        and remove your data from our servers.
                    </DialogDescription>
                </DialogHeader>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Dialog with Footer</h2>
        <p class="text-sm text-muted-foreground">
            Dialog with action buttons in the footer using DialogFooter component.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Edit Profile
            </DialogTrigger>

            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Edit profile</DialogTitle>
                    <DialogDescription>
                        Make changes to your profile here. Click save when you're done.
                    </DialogDescription>
                </DialogHeader>

                <div class="grid gap-4 py-4">
                    <div class="grid grid-cols-4 items-center gap-4">
                        <label for="name" class="text-right text-sm font-medium">
                            Name
                        </label>
                        <input id="name"
                               value="Pedro Duarte"
                               class="col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" />
                    </div>
                    <div class="grid grid-cols-4 items-center gap-4">
                        <label for="username" class="text-right text-sm font-medium">
                            Username
                        </label>
                        <input id="username"
                               value="@@peduarte"
                               class="col-span-3 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" />
                    </div>
                </div>

                <DialogFooter>
                    <button type="submit"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Save changes
                    </button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Controlled Dialog</h2>
        <p class="text-sm text-muted-foreground">
            Control the dialog state programmatically using @@bind-Open.
        </p>

        <div class="flex gap-2">
            <button @onclick="() => isDialogOpen = true"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog
            </button>
        </div>

        <Dialog @bind-Open="isDialogOpen">
            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Controlled Dialog</DialogTitle>
                    <DialogDescription>
                        This dialog's open state is controlled from the parent component.
                        You can programmatically open and close it.
                    </DialogDescription>
                </DialogHeader>

                <div class="py-4">
                    <p class="text-sm">
                        Dialog is open: <strong>@isDialogOpen</strong>
                    </p>
                </div>

                <DialogFooter>
                    <button @onclick="() => isDialogOpen = false"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Cancel
                    </button>
                    <button @onclick="HandleSave"
                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Save
                    </button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Custom Width</h2>
        <p class="text-sm text-muted-foreground">
            Customize the dialog width using the Class parameter.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Wide Dialog
            </DialogTrigger>

            <DialogContent Class="max-w-3xl">
                <DialogHeader>
                    <DialogTitle>Wide Dialog</DialogTitle>
                    <DialogDescription>
                        This dialog uses a custom max-width class to be wider than the default.
                    </DialogDescription>
                </DialogHeader>

                <div class="py-4">
                    <p class="text-sm">
                        You can customize the dialog width by passing additional classes to the DialogContent component.
                        This example uses <code class="bg-muted px-1 py-0.5 rounded">max-w-3xl</code> instead of the default <code class="bg-muted px-1 py-0.5 rounded">max-w-lg</code>.
                    </p>
                </div>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Without Close Button</h2>
        <p class="text-sm text-muted-foreground">
            Hide the default close button using ShowClose="false".
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog
            </DialogTrigger>

            <DialogContent ShowClose="false">
                <DialogHeader>
                    <DialogTitle>Confirm Action</DialogTitle>
                    <DialogDescription>
                        This dialog doesn't have a close button in the top-right corner.
                        You must use one of the action buttons or press Escape to close.
                    </DialogDescription>
                </DialogHeader>

                <DialogFooter Class="mt-4">
                    <BlazorUI.Primitives.Dialog.DialogClose class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        Cancel
                    </BlazorUI.Primitives.Dialog.DialogClose>
                    <BlazorUI.Primitives.Dialog.DialogClose class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Confirm
                    </BlazorUI.Primitives.Dialog.DialogClose>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">AsChild Pattern</h2>
        <p class="text-sm text-muted-foreground">
            Use AsChild to compose triggers with your own styled Button components instead of inline styles.
        </p>

        <div class="grid md:grid-cols-2 gap-6">
            <!-- Without AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">Without AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    DialogTrigger renders its own button element with inline classes.
                </p>
                <Dialog>
                    <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Open Dialog
                    </DialogTrigger>
                    <DialogContent>
                        <DialogHeader>
                            <DialogTitle>Without AsChild</DialogTitle>
                            <DialogDescription>
                                This dialog uses inline CSS classes on the trigger.
                            </DialogDescription>
                        </DialogHeader>
                    </DialogContent>
                </Dialog>
            </div>

            <!-- With AsChild -->
            <div class="space-y-3 p-4 border rounded-lg">
                <h3 class="text-lg font-medium">With AsChild</h3>
                <p class="text-sm text-muted-foreground">
                    Button component receives trigger behavior via TriggerContext.
                </p>
                <Dialog>
                    <DialogTrigger AsChild>
                        <Button Variant="ButtonVariant.Destructive">
                            <LucideIcon Name="trash-2" Size="16" />
                            Delete Account
                        </Button>
                    </DialogTrigger>
                    <DialogContent>
                        <DialogHeader>
                            <DialogTitle>Delete Account</DialogTitle>
                            <DialogDescription>
                                This action cannot be undone. This will permanently delete your account.
                            </DialogDescription>
                        </DialogHeader>
                        <DialogFooter>
                            <DialogClose AsChild>
                                <Button Variant="ButtonVariant.Outline">Cancel</Button>
                            </DialogClose>
                            <Button Variant="ButtonVariant.Destructive">Delete</Button>
                        </DialogFooter>
                    </DialogContent>
                </Dialog>
            </div>
        </div>

        <div class="bg-muted p-4 rounded-md mt-4">
            <p class="text-sm font-medium mb-2">Code Example:</p>
            <pre class="text-sm overflow-x-auto"><code>&lt;Dialog&gt;
    &lt;DialogTrigger AsChild&gt;
        &lt;Button Variant="ButtonVariant.Destructive"&gt;
            Delete Account
        &lt;/Button&gt;
    &lt;/DialogTrigger&gt;
    &lt;DialogContent&gt;
        &lt;DialogHeader&gt;
            &lt;DialogTitle&gt;Delete Account&lt;/DialogTitle&gt;
        &lt;/DialogHeader&gt;
        &lt;DialogFooter&gt;
            &lt;DialogClose AsChild&gt;
                &lt;Button Variant="ButtonVariant.Outline"&gt;Cancel&lt;/Button&gt;
            &lt;/DialogClose&gt;
            &lt;Button Variant="ButtonVariant.Destructive"&gt;Delete&lt;/Button&gt;
        &lt;/DialogFooter&gt;
    &lt;/DialogContent&gt;
&lt;/Dialog&gt;</code></pre>
        </div>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Combobox in Dialog</h2>
        <p class="text-sm text-muted-foreground">
            Dialog containing a Combobox for selecting items. Tests nested portal behavior.
        </p>

        <Dialog>
            <DialogTrigger class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Open Dialog with Combobox
            </DialogTrigger>

            <DialogContent>
                <DialogHeader>
                    <DialogTitle>Select a Framework</DialogTitle>
                    <DialogDescription>
                        Use the combobox below to search and select a framework.
                    </DialogDescription>
                </DialogHeader>

                <div class="py-4">
                    <Combobox TItem="ComboboxFramework"
                              Items="comboboxFrameworks"
                              @bind-Value="selectedComboboxFramework"
                              ValueSelector="@(f => f.Value)"
                              DisplaySelector="@(f => f.Label)"
                              Placeholder="Select framework..."
                              SearchPlaceholder="Search framework..."
                              EmptyMessage="No framework found."
                              PopoverWidth="w-[300px]" />
                    @if (!string.IsNullOrEmpty(selectedComboboxFramework))
                    {
                        <p class="text-sm mt-2">Selected: <strong>@GetComboboxFrameworkLabel(selectedComboboxFramework)</strong></p>
                    }
                </div>

                <DialogFooter>
                    <DialogClose AsChild>
                        <Button Variant="ButtonVariant.Outline">Cancel</Button>
                    </DialogClose>
                    <DialogClose AsChild>
                        <Button Variant="ButtonVariant.Default">Confirm</Button>
                    </DialogClose>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    </div>

    <!-- ========================================= -->
    <!-- ADVANCED DIALOG DEMOS -->
    <!-- ========================================= -->
    <div class="space-y-8 mt-16 pt-12 border-t-2">
        <div class="space-y-4">
            <div class="flex items-center gap-3">
                <LucideIcon Name="sparkles" Size="32" Class="text-primary" />
                <h2 class="text-3xl font-bold tracking-tight">Advanced Dialog Demos</h2>
            </div>
            <Alert Variant="AlertVariant.Default" Class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 border-blue-200 dark:border-blue-800">
                <Icon>
                    <LucideIcon Name="info" Size="16" />
                </Icon>
                <ChildContent>
                    <AlertDescription Class="text-sm ml-2">
                        <strong>Real-world examples:</strong> These demos showcase complex forms with multiple input components,
                        validation, dynamic calculations, and nested dialogs. Perfect for testing component integration and benchmarking against React.
                    </AlertDescription>
                </ChildContent>
            </Alert>
        </div>

        <!-- Grid of trigger buttons -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Demo 1: User Profile Settings -->
            <button @onclick="() => showUserProfileDialog = true"
                    class="flex flex-col items-center justify-center gap-3 p-6 rounded-lg border-2 border-input bg-background hover:border-primary hover:bg-primary/5 transition-all duration-200 group">
                <LucideIcon Name="user-cog" Size="32" Class="text-primary group-hover:scale-110 transition-transform" />
                <div class="text-center">
                    <div class="font-semibold">User Profile Settings</div>
                    <div class="text-xs text-muted-foreground">Comprehensive form validation</div>
                </div>
            </button>

            <!-- Demo 2: Subscription Plan Selection -->
            <button @onclick="() => showSubscriptionDialog = true"
                    class="flex flex-col items-center justify-center gap-3 p-6 rounded-lg border-2 border-input bg-background hover:border-primary hover:bg-primary/5 transition-all duration-200 group">
                <LucideIcon Name="credit-card" Size="32" Class="text-primary group-hover:scale-110 transition-transform" />
                <div class="text-center">
                    <div class="font-semibold">Subscription Plan</div>
                    <div class="text-xs text-muted-foreground">Dynamic pricing calculator</div>
                </div>
            </button>

            <!-- Demo 3: Team Member Invite -->
            <button @onclick="() => showTeamInviteDialog = true"
                    class="flex flex-col items-center justify-center gap-3 p-6 rounded-lg border-2 border-input bg-background hover:border-primary hover:bg-primary/5 transition-all duration-200 group">
                <LucideIcon Name="user-plus" Size="32" Class="text-primary group-hover:scale-110 transition-transform" />
                <div class="text-center">
                    <div class="font-semibold">Team Member Invite</div>
                    <div class="text-xs text-muted-foreground">Role-based access control</div>
                </div>
            </button>

            <!-- Demo 4: Product Configuration -->
            <button @onclick="() => showProductConfigDialog = true"
                    class="flex flex-col items-center justify-center gap-3 p-6 rounded-lg border-2 border-input bg-background hover:border-primary hover:bg-primary/5 transition-all duration-200 group">
                <LucideIcon Name="package" Size="32" Class="text-primary group-hover:scale-110 transition-transform" />
                <div class="text-center">
                    <div class="font-semibold">Product Configuration</div>
                    <div class="text-xs text-muted-foreground">E-commerce customization</div>
                </div>
            </button>

            <!-- Demo 5: Nested Dialog -->
            <button @onclick="() => showProjectDialog = true"
                    class="flex flex-col items-center justify-center gap-3 p-6 rounded-lg border-2 border-input bg-background hover:border-primary hover:bg-primary/5 transition-all duration-200 group">
                <LucideIcon Name="layers" Size="32" Class="text-primary group-hover:scale-110 transition-transform" />
                <div class="text-center">
                    <div class="font-semibold">Create Project</div>
                    <div class="text-xs text-muted-foreground">Nested dialog behavior</div>
                </div>
            </button>
        </div>

        <!-- Demo 1: User Profile Settings Dialog -->
        <Dialog @bind-Open="showUserProfileDialog">
            <DialogContent Variant="DialogContentVariant.Form" Class="p-4 max-w-2xl max-h-[90vh] flex flex-col">
                <DialogHeader Class="flex-shrink-0">
                    <DialogTitle>
                        <div class="flex items-center gap-2">
                            <LucideIcon Name="user-cog" Size="20" />
                            User Profile Settings
                        </div>
                    </DialogTitle>
                    <DialogDescription>
                        Update your profile information and preferences.
                    </DialogDescription>
                </DialogHeader>

                <ScrollArea FillContainer="true" EnableScrollShadows="true">
                    <EditForm EditContext="userProfileEditContext">
                        <DataAnnotationsValidator />
                        <FieldGroup Orientation="FieldGroupOrientation.Vertical" Class="mx-1">
                            <!-- Personal Information Section -->
                            <h3 class="text-xs font-semibold text-muted-foreground uppercase tracking-wide">Personal Information</h3>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <Field>
                                    <FieldLabel For="profile-name">Full Name *</FieldLabel>
                                    <FieldContent>
                                        <Input Id="profile-name"
                                               @bind-Value="userProfileModel.Name"
                                               ShowValidationError="true"
                                               Placeholder="Enter your full name" />
                                    </FieldContent>
                                </Field>

                                <Field>
                                    <FieldLabel For="profile-username">Username</FieldLabel>
                                    <FieldContent>
                                        <Input Id="profile-username"
                                               @bind-Value="userProfileModel.Username"
                                               ShowValidationError="true"
                                               Placeholder="username" />
                                    </FieldContent>
                                </Field>
                            </div>

                            <Field>
                                <FieldLabel For="profile-email">Email Address *</FieldLabel>
                                <FieldContent>
                                    <Input Id="profile-email"
                                           @bind-Value="userProfileModel.Email"
                                           ShowValidationError="true"
                                           Type="InputType.Email"
                                           Placeholder="your@email.com" />
                                </FieldContent>
                            </Field>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <Field>
                                    <FieldLabel For="profile-phone">Phone Number</FieldLabel>
                                    <FieldContent>
                                        <MaskedInput Id="profile-phone"
                                                     @bind-Value="userProfileModel.PhoneNumber"
                                                     Mask="@MaskedInput.Masks.PhoneUS"
                                                     ShowMask="true"
                                                     Placeholder="(000) 000-0000" />
                                    </FieldContent>
                                </Field>

                                <Field>
                                    <FieldLabel For="profile-dob">Date of Birth</FieldLabel>
                                    <FieldContent>
                                        <DatePicker @bind-SelectedDate="userProfileModel.DateOfBirth"
                                                    Placeholder="Pick a date" ButtonSize="ButtonSize.Small" />
                                    </FieldContent>
                                </Field>
                            </div>

                            <Separator />

                            <!-- Preferences Section -->
                            <h3 class="text-xs font-semibold text-muted-foreground uppercase tracking-wide">Preferences</h3>

                            <Field>
                                <FieldLabel For="profile-theme-color">Theme Color</FieldLabel>
                                <FieldContent>
                                    <ColorPicker @bind-Color="userProfileModel.ThemeColor" />
                                </FieldContent>
                            </Field>

                            <Field>
                                <FieldLabel For="profile-bio">Bio</FieldLabel>
                                <FieldContent>
                                    <Textarea Id="profile-bio"
                                              @bind-Value="userProfileModel.Bio"
                                              Placeholder="Tell us about yourself..."
                                              Rows="3" />
                                    <FieldDescription>Brief description for your profile. Maximum 500 characters.</FieldDescription>
                                </FieldContent>
                            </Field>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <Field Orientation="FieldOrientation.Horizontal">
                                    <FieldContent Class="flex flex-row justify-between gap-4">
                                        <div class="flex-1">
                                            <FieldLabel For="profile-email-notif">Email Notifications</FieldLabel>
                                            <FieldDescription Class="text-wrap">Receive email updates about your account activity, security, and important changes</FieldDescription>
                                        </div>
                                        <Switch @bind-Checked="userProfileModel.EmailNotifications" Class="flex-shrink-0 mt-2 mr-2" />
                                    </FieldContent>
                                </Field>

                                <Field Orientation="FieldOrientation.Horizontal">
                                    <FieldContent Class="flex flex-row justify-between gap-4">
                                        <div class="flex-1">
                                            <FieldLabel For="profile-marketing">Marketing Emails</FieldLabel>
                                            <FieldDescription Class="text-wrap">Receive emails about new products, special offers, and exclusive promotions</FieldDescription>
                                        </div>
                                        <Switch @bind-Checked="userProfileModel.MarketingEmails" Class="flex-shrink-0 mt-2 mr-2" />
                                    </FieldContent>
                                </Field>
                            </div>
                    </FieldGroup>
                    </EditForm>
                </ScrollArea>

                <DialogFooter Class="flex-shrink-0 mt-auto pt-3 border-t">
                    <Button Variant="ButtonVariant.Outline" OnClick="CancelUserProfile">Cancel</Button>
                    <Button OnClick="SaveUserProfile">Save Changes</Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>

        <!-- State Display for Demo 1 -->
        <Collapsible Class="mt-4 mb-2 border rounded-lg">
            <div class="px-4 py-3">
                <CollapsibleTrigger Class="flex w-full items-center justify-between text-left [&_svg]:transition-transform [&_svg]:duration-200 data-[state=open]:[&_svg]:rotate-180">
                    <span class="text-sm font-medium">User Profile Form State (JSON)</span>
                    <LucideIcon Name="chevron-down" Size="16" />
                </CollapsibleTrigger>
            </div>
            <CollapsibleContent Class="px-4 pb-4 border-t">
                <div class="pt-4">
                    <pre class="text-xs overflow-x-auto bg-muted/50 p-3 rounded">@JsonSerializer.Serialize(userProfileModel, new JsonSerializerOptions { WriteIndented = true })</pre>
                </div>
            </CollapsibleContent>
        </Collapsible>

        <!-- Demo 2: Subscription Plan Selection Dialog -->
        <Dialog @bind-Open="showSubscriptionDialog">
            <DialogContent Variant="DialogContentVariant.Form" Class="p-4 max-w-3xl max-h-[90vh] flex flex-col">
                <DialogHeader Class="flex-shrink-0">
                    <DialogTitle>
                        <div class="flex items-center gap-2">
                            <LucideIcon Name="credit-card" Size="20" />
                            Choose Your Plan
                        </div>
                    </DialogTitle>
                    <DialogDescription>
                        Select the perfect plan for your needs. Switch between monthly and annual billing.
                    </DialogDescription>
                </DialogHeader>

                <ScrollArea FillContainer="true" EnableScrollShadows="true">
                    <FieldGroup Orientation="FieldGroupOrientation.Vertical" Class="mx-1">
                        <!-- Billing Toggle -->
                        <Field Orientation="FieldOrientation.Horizontal">
                            <FieldContent Class="flex flex-row justify-center gap-3 p-4 bg-muted/30 rounded-lg">
                                <span class="text-sm font-medium @(subscriptionModel.IsAnnual ? "text-muted-foreground" : "")">Monthly</span>
                                <Switch @bind-Checked="subscriptionModel.IsAnnual" />
                                <span class="text-sm font-medium @(subscriptionModel.IsAnnual ? "" : "text-muted-foreground")">
                                    Annual
                                    <Badge Variant="BadgeVariant.Secondary" Class="ml-2 bg-green-800 hover:bg-green-800/80 text-white dark:bg-green-600">Save 20%</Badge>
                                </span>
                            </FieldContent>
                        </Field>

                        <!-- Plan Selection -->
                        <Field>
                            <FieldLabel>Select Plan</FieldLabel>
                            <FieldContent>
                                <RadioGroup @bind-Value="subscriptionModel.SelectedPlan" AriaLabel="Select subscription plan">
                                    <label for="plan-starter"
                                           class="@($"flex items-start space-x-3 rounded-lg border-2 p-4 cursor-pointer transition-all duration-200 {(subscriptionModel.SelectedPlan == "starter" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <div @onclick:stopPropagation class="mt-2">
                                            <RadioGroupItem Value="@("starter")" Id="plan-starter" />
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between">
                                                <div class="text-base font-semibold">Starter</div>
                                                <div class="text-xl font-bold">$@(subscriptionModel.IsAnnual ? "8" : "10")<span class="text-sm font-normal text-muted-foreground">/mo</span></div>
                                            </div>
                                            <p class="text-sm text-muted-foreground mt-1.5">Perfect for individuals and small projects</p>
                                            <ul class="mt-3 space-y-1 text-sm">
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Up to 3 projects</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> 5 GB storage</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Email support</li>
                                            </ul>
                                        </div>
                                    </label>

                                    <label for="plan-pro"
                                           class="@($"flex items-start space-x-3 rounded-lg border-2 p-4 cursor-pointer transition-all duration-200 {(subscriptionModel.SelectedPlan == "pro" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <div @onclick:stopPropagation class="mt-2">
                                            <RadioGroupItem Value="@("pro")" Id="plan-pro" />
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-2">
                                                    <div class="text-base font-semibold">Pro</div>
                                                    <Badge Variant="BadgeVariant.Default">Popular</Badge>
                                                </div>
                                                <div class="text-xl font-bold">$@(subscriptionModel.IsAnnual ? "24" : "30")<span class="text-sm font-normal text-muted-foreground">/mo</span></div>
                                            </div>
                                            <p class="text-sm text-muted-foreground mt-1.5">For professionals and growing teams</p>
                                            <ul class="mt-3 space-y-1 text-sm">
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Unlimited projects</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> 100 GB storage</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Priority support</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Advanced analytics</li>
                                            </ul>
                                        </div>
                                    </label>

                                    <label for="plan-enterprise"
                                           class="@($"flex items-start space-x-3 rounded-lg border-2 p-4 cursor-pointer transition-all duration-200 {(subscriptionModel.SelectedPlan == "enterprise" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <div @onclick:stopPropagation class="mt-2">
                                            <RadioGroupItem Value="@("enterprise")" Id="plan-enterprise" />
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between">
                                                <div class="text-base font-semibold">Enterprise</div>
                                                <div class="text-xl font-bold">$@(subscriptionModel.IsAnnual ? "80" : "100")<span class="text-sm font-normal text-muted-foreground">/mo</span></div>
                                            </div>
                                            <p class="text-sm text-muted-foreground mt-1.5">For large organizations with advanced needs</p>
                                            <ul class="mt-3 space-y-1 text-sm">
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Everything in Pro</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Unlimited storage</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> 24/7 phone support</li>
                                                <li class="flex items-center gap-2"><LucideIcon Name="check" Size="14" Class="text-green-600" /> Custom integrations</li>
                                            </ul>
                                        </div>
                                    </label>
                                </RadioGroup>
                            </FieldContent>
                        </Field>

                        <Separator />

                        <!-- Team Size Slider -->
                        <Field>
                            <FieldLabel For="team-size">Team Size: @((int)subscriptionModel.TeamSize) members</FieldLabel>
                            <FieldContent>
                                <Slider @bind-Value="subscriptionModel.TeamSize"
                                        Class="my-2" Min="1"
                                        Max="50"
                                        Step="1" />
                                <FieldDescription>Additional $5/member for teams larger than 10</FieldDescription>
                            </FieldContent>
                        </Field>

                        <!-- Promo Code -->
                        <Field>
                            <FieldLabel For="promo-code">Promo Code (Optional)</FieldLabel>
                            <FieldContent>
                                <Input Id="promo-code"
                                       @bind-Value="subscriptionModel.PromoCode"
                                       Placeholder="Enter promo code" />
                            </FieldContent>
                        </Field>

                        <!-- Auto-renew -->
                        <Field Orientation="FieldOrientation.Horizontal">
                            <FieldContent Class="flex flex-row justify-between gap-4">
                                <div class="flex-1">
                                    <FieldLabel For="auto-renew">Auto-renew subscription</FieldLabel>
                                    <FieldDescription Class="text-wrap">Automatically renew at the end of billing period</FieldDescription>
                                </div>
                                <Switch @bind-Checked="subscriptionModel.AutoRenew" Class="flex-shrink-0 mt-2 mr-2" />
                            </FieldContent>
                        </Field>

                        <!-- Total Calculation -->
                        <Alert Variant="AlertVariant.Info">
                            <Icon>
                                <LucideIcon Name="info" Size="16" />
                            </Icon>
                            <ChildContent>
                                <AlertTitle Class="mb-1">Subscription Total</AlertTitle>
                                <AlertDescription>
                                    <div class="flex items-center justify-between gap-4">
                                        <div class="flex-1">
                                            <div class="text-sm">
                                                @(subscriptionModel.IsAnnual ? "Billed annually" : "Billed monthly")
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold">$@CalculateSubscriptionTotal()</div>
                                            @if (subscriptionModel.IsAnnual)
                                            {
                                                <div class="text-xs text-green-600 font-medium mt-0.5">Save $@(CalculateAnnualSavings())/year</div>
                                            }
                                        </div>
                                    </div>
                                </AlertDescription>
                            </ChildContent>
                        </Alert>
                    </FieldGroup>
                </ScrollArea>

                <DialogFooter Class="flex-shrink-0 mt-auto pt-3 border-t">
                    <Button Variant="ButtonVariant.Outline" OnClick="CancelSubscription">Cancel</Button>
                    <Button OnClick="SaveSubscription">Subscribe Now</Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>

        <!-- State Display for Demo 2 -->
        <Collapsible Class="mt-4 mb-2 border rounded-lg">
            <div class="px-4 py-3">
                <CollapsibleTrigger Class="flex w-full items-center justify-between text-left [&_svg]:transition-transform [&_svg]:duration-200 data-[state=open]:[&_svg]:rotate-180">
                    <span class="text-sm font-medium">Subscription Form State (JSON)</span>
                    <LucideIcon Name="chevron-down" Size="16" />
                </CollapsibleTrigger>
            </div>
            <CollapsibleContent Class="px-4 pb-4 border-t">
                <div class="pt-4">
                    <pre class="text-xs overflow-x-auto bg-muted/50 p-3 rounded">@JsonSerializer.Serialize(subscriptionModel, new JsonSerializerOptions { WriteIndented = true })</pre>
                </div>
            </CollapsibleContent>
        </Collapsible>

        <!-- Demo 3: Team Member Invite Dialog -->
        <Dialog @bind-Open="showTeamInviteDialog">
            <DialogContent Variant="DialogContentVariant.Form" Class="p-4 max-w-2xl max-h-[90vh] flex flex-col">
                <DialogHeader Class="flex-shrink-0">
                    <DialogTitle>
                        <div class="flex items-center gap-2">
                            <LucideIcon Name="user-plus" Size="20" />
                            Invite Team Member
                        </div>
                    </DialogTitle>
                    <DialogDescription>
                        Send an invitation to join your team workspace.
                    </DialogDescription>
                </DialogHeader>

                <ScrollArea FillContainer="true" EnableScrollShadows="true">
                    <EditForm EditContext="teamInviteEditContext">
                        <DataAnnotationsValidator />
                        <FieldGroup Orientation="FieldGroupOrientation.Vertical" Class="mx-1">
                            <!-- Email Input -->
                            <Field>
                            <FieldLabel For="invite-email">Email Address *</FieldLabel>
                            <FieldContent>
                                <Input Id="invite-email"
                                       @bind-Value="teamInviteModel.Email"
                                       ShowValidationError="true"
                                       Type="InputType.Email"
                                       Placeholder="colleague@company.com" />
                            </FieldContent>
                        </Field>

                        <!-- Role Selection -->
                        <Field>
                            <FieldLabel>Role *</FieldLabel>
                            <FieldContent>
                                <RadioGroup @bind-Value="teamInviteModel.Role" AriaLabel="Select role">
                                    <label for="role-admin"
                                           class="@($"flex items-start justify-between rounded-lg border p-4 cursor-pointer transition-colors {(teamInviteModel.Role == "admin" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2">
                                                <LucideIcon Name="shield" Size="16" Class="text-orange-600" />
                                                <div class="text-sm font-medium leading-none">Admin</div>
                                            </div>
                                            <p class="text-sm text-muted-foreground mt-1.5">Full access to all workspace features and settings</p>
                                        </div>
                                        <RadioGroupItem Value="@("admin")" Id="role-admin" Variant="RadioGroupItemVariant.Check" Class="ml-3 mt-1" />
                                    </label>

                                    <label for="role-member"
                                           class="@($"flex items-start justify-between rounded-lg border p-4 cursor-pointer transition-colors {(teamInviteModel.Role == "member" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2">
                                                <LucideIcon Name="user" Size="16" Class="text-blue-600" />
                                                <div class="text-sm font-medium leading-none">Member</div>
                                            </div>
                                            <p class="text-sm text-muted-foreground mt-1.5">Can create and edit projects, limited admin features</p>
                                        </div>
                                        <RadioGroupItem Value="@("member")" Id="role-member" Variant="RadioGroupItemVariant.Check" Class="ml-3 mt-1" />
                                    </label>

                                    <label for="role-viewer"
                                           class="@($"flex items-start justify-between rounded-lg border p-4 cursor-pointer transition-colors {(teamInviteModel.Role == "viewer" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2">
                                                <LucideIcon Name="eye" Size="16" Class="text-green-600" />
                                                <div class="text-sm font-medium leading-none">Viewer</div>
                                            </div>
                                            <p class="text-sm text-muted-foreground mt-1.5">Read-only access to view projects and reports</p>
                                        </div>
                                        <RadioGroupItem Value="@("viewer")" Id="role-viewer" Variant="RadioGroupItemVariant.Check" Class="ml-3 mt-0.5" />
                                    </label>
                                </RadioGroup>
                            </FieldContent>
                        </Field>

                        <Separator />

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Department Selection -->
                            <Field>
                                <FieldLabel For="invite-department">Department</FieldLabel>
                                <FieldContent>
                                    <Select @bind-Value="teamInviteModel.Department" TValue="string">
                                        <SelectTrigger>
                                            <SelectValue Placeholder="Select department" />
                                        </SelectTrigger>
                                        <SelectContent>
                                            <SelectItem Value="@("engineering")" Text="Engineering" />
                                            <SelectItem Value="@("design")" Text="Design" />
                                            <SelectItem Value="@("marketing")" Text="Marketing" />
                                            <SelectItem Value="@("sales")" Text="Sales" />
                                            <SelectItem Value="@("support")" Text="Support" />
                                            <SelectItem Value="@("hr")" Text="Human Resources" />
                                        </SelectContent>
                                    </Select>
                                </FieldContent>
                            </Field>

                            <!-- Project Assignment -->
                            <Field>
                                <FieldLabel For="invite-projects">Assign to Projects (Optional)</FieldLabel>
                                <FieldContent>
                                    <MultiSelect TItem="Project"
                                                 @bind-Values="teamInviteModel.AssignedProjects"
                                                 Placeholder="Select projects"
                                                 Items="availableProjects"
                                                 ValueSelector="@(p => p.Name)"
                                                 DisplaySelector="@(p => p.Name)" />
                                </FieldContent>
                            </Field>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Access Expiry -->
                            <Field>
                                <FieldLabel For="invite-expires">Access Expires On (Optional)</FieldLabel>
                                <FieldContent>
                                    <DatePicker @bind-SelectedDate="teamInviteModel.AccessExpiresOn"
                                                Placeholder="No expiration" />
                                </FieldContent>
                            </Field>

                            <!-- Send Email Toggle -->
                            <Field Orientation="FieldOrientation.Horizontal">
                                <FieldContent Class="flex flex-row justify-between gap-4">
                                    <div class="flex-1">
                                        <FieldLabel For="send-email">Send invitation email immediately</FieldLabel>
                                        <FieldDescription Class="text-wrap">User will receive an email with invitation link</FieldDescription>
                                    </div>
                                    <Switch @bind-Checked="teamInviteModel.SendEmailImmediately" Class="flex-shrink-0 mt-2 mr-2" />
                                </FieldContent>
                            </Field>
                        </div>
                    </FieldGroup>
                    </EditForm>
                </ScrollArea>

                <DialogFooter Class="flex-shrink-0 mt-auto pt-3 border-t">
                    <Button Variant="ButtonVariant.Outline" OnClick="CancelTeamInvite">Cancel</Button>
                    <Button OnClick="SaveTeamInvite">Send Invitation</Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>

        <!-- State Display for Demo 3 -->
        <Collapsible Class="mt-4 mb-2 border rounded-lg">
            <div class="px-4 py-3">
                <CollapsibleTrigger Class="flex w-full items-center justify-between text-left [&_svg]:transition-transform [&_svg]:duration-200 data-[state=open]:[&_svg]:rotate-180">
                    <span class="text-sm font-medium">Team Invite Form State (JSON)</span>
                    <LucideIcon Name="chevron-down" Size="16" />
                </CollapsibleTrigger>
            </div>
            <CollapsibleContent Class="px-4 pb-4 border-t">
                <div class="pt-4">
                    <pre class="text-xs overflow-x-auto bg-muted/50 p-3 rounded">@JsonSerializer.Serialize(teamInviteModel, new JsonSerializerOptions { WriteIndented = true })</pre>
                </div>
            </CollapsibleContent>
        </Collapsible>

        <!-- Demo 4: E-commerce Product Configuration Dialog -->
        <Dialog @bind-Open="showProductConfigDialog">
            <DialogContent Variant="DialogContentVariant.Form" Class="p-4 max-w-2xl max-h-[90vh] flex flex-col">
                <DialogHeader Class="flex-shrink-0">
                    <DialogTitle>
                        <div class="flex items-center gap-2">
                            <LucideIcon Name="package" Size="20" />
                            Configure Product
                        </div>
                    </DialogTitle>
                    <DialogDescription>
                        Customize your product options and pricing.
                    </DialogDescription>
                </DialogHeader>

                <ScrollArea FillContainer="true" EnableScrollShadows="true">
                    <FieldGroup Orientation="FieldGroupOrientation.Vertical" Class="mx-1">
                        <!-- Product Name -->
                        <Field>
                            <FieldLabel For="product-name">Product Name</FieldLabel>
                            <FieldContent>
                                <Input Id="product-name"
                                       @bind-Value="productConfigModel.ProductName"
                                       Placeholder="Enter product name" />
                            </FieldContent>
                        </Field>

                        <!-- Color and Size -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <Field>
                                <FieldLabel For="product-color">Product Color</FieldLabel>
                                <FieldContent>
                                    <ColorPicker @bind-Color="productConfigModel.ProductColor"
                                        Size="ColorPickerSize.Compact" ShowPresets="false"
                                        ShowInputs="false"/>
                                </FieldContent>
                            </Field>

                            <Field>
                                <FieldLabel For="product-size">Size</FieldLabel>
                                <FieldContent>
                                    <Select @bind-Value="productConfigModel.Size" TValue="string">
                                        <SelectTrigger>
                                            <SelectValue Placeholder="Select size" />
                                        </SelectTrigger>
                                        <SelectContent>
                                            <SelectItem Value="@("S")" Text="Small (S)" TValue="string" />
                                            <SelectItem Value="@("M")" Text="Medium (M)" TValue="string" />
                                            <SelectItem Value="@("L")" Text="Large (L)" TValue="string" />
                                            <SelectItem Value="@("XL")" Text="Extra Large (XL)" TValue="string" />
                                        </SelectContent>
                                    </Select>
                                </FieldContent>
                            </Field>
                        </div>

                        <Separator />

                        <!-- Quantity and Rating -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <Field>
                                <FieldLabel For="product-quantity">Quantity</FieldLabel>
                                <FieldContent>
                                    <NumericInput @bind-Value="productConfigModel.Quantity"
                                                  Min="1"
                                                  Max="999"
                                                  ShowStepper="true" />
                                </FieldContent>
                            </Field>

                            <Field>
                                <FieldLabel For="product-rating">Initial Rating</FieldLabel>
                                <FieldContent Class="flex-row items-center pt-2">
                                    <Rating @bind-Value="productConfigModel.Rating"
                                            AllowHalf="true" Size="RatingSize.Small"
                                            MaxRating="5" />
                                </FieldContent>
                            </Field>
                        </div>

                        <!-- Price Range for Bulk Orders -->
                        <Field>
                            <FieldLabel For="price-range">Price Range for Bulk Orders</FieldLabel>
                            <FieldContent Class="p-2">
                                <RangeSlider @bind-MinValue="productConfigModel.MinPrice"
                                             @bind-MaxValue="productConfigModel.MaxPrice"
                                             Class="my-3" Min="10" Max="500" Step="10" />
                                <FieldDescription>
                                    Range: $@productConfigModel.MinPrice - $@productConfigModel.MaxPrice
                                </FieldDescription>
                            </FieldContent>
                        </Field>

                        <!-- Custom Offer Price -->
                        <Field>
                            <FieldLabel For="offer-price">Custom Offer Price</FieldLabel>
                            <FieldContent>
                                <CurrencyInput Id="offer-price"
                                               @bind-Value="productConfigModel.CustomOfferPrice"
                                               Currency="USD"
                                               Placeholder="0.00" />
                            </FieldContent>
                        </Field>

                        <!-- Special Instructions -->
                        <Field>
                            <FieldLabel For="special-instructions">Special Instructions</FieldLabel>
                            <FieldContent>
                                <Textarea Id="special-instructions"
                                          @bind-Value="productConfigModel.SpecialInstructions"
                                          Placeholder="Add any special requests..."
                                          Rows="3" />
                            </FieldContent>
                        </Field>

                        <Separator />

                        <!-- Additional Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <Field Orientation="FieldOrientation.Horizontal">
                                <FieldContent Class="flex flex-row justify-between gap-4">
                                    <div class="flex-1">
                                        <FieldLabel For="gift-wrap">Gift Wrap</FieldLabel>
                                        <FieldDescription Class="text-wrap">Add gift wrapping (+$5.00)</FieldDescription>
                                    </div>
                                    <Switch @bind-Checked="productConfigModel.GiftWrap" Class="flex-shrink-0 mt-2 mr-2" />
                                </FieldContent>
                            </Field>

                            <Field Orientation="FieldOrientation.Horizontal">
                                <FieldContent Class="flex flex-row justify-between gap-4">
                                    <div class="flex-1">
                                        <FieldLabel For="priority-shipping">Priority Shipping</FieldLabel>
                                        <FieldDescription Class="text-wrap">2-day delivery (+$15.00)</FieldDescription>
                                    </div>
                                    <Switch @bind-Checked="productConfigModel.PriorityShipping" Class="flex-shrink-0 mt-2 mr-2" />
                                </FieldContent>
                            </Field>
                        </div>
                    </FieldGroup>
                </ScrollArea>

                <DialogFooter Class="flex-shrink-0 mt-auto pt-3 border-t">
                    <Button Variant="ButtonVariant.Outline" OnClick="CancelProductConfig">Cancel</Button>
                    <Button OnClick="SaveProductConfig">Add to Cart</Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>

        <!-- State Display for Demo 4 -->
        <Collapsible Class="mt-4 mb-2 border rounded-lg">
            <div class="px-4 py-3">
                <CollapsibleTrigger Class="flex w-full items-center justify-between text-left [&_svg]:transition-transform [&_svg]:duration-200 data-[state=open]:[&_svg]:rotate-180">
                    <span class="text-sm font-medium">Product Configuration Form State (JSON)</span>
                    <LucideIcon Name="chevron-down" Size="16" />
                </CollapsibleTrigger>
            </div>
            <CollapsibleContent Class="px-4 pb-4 border-t">
                <div class="pt-4">
                    <pre class="text-xs overflow-x-auto bg-muted/50 p-3 rounded">@JsonSerializer.Serialize(productConfigModel, new JsonSerializerOptions { WriteIndented = true })</pre>
                </div>
            </CollapsibleContent>
        </Collapsible>

        <!-- Demo 5: Nested Dialog - Create Project with Advanced Settings -->
        <Dialog @bind-Open="showProjectDialog">
            <DialogContent Variant="DialogContentVariant.Form" Class="p-4 max-w-2xl max-h-[90vh] flex flex-col">
                <DialogHeader Class="flex-shrink-0">
                    <DialogTitle>
                        <div class="flex items-center gap-2">
                            <LucideIcon Name="folder-plus" Size="20" />
                            Quick Project Setup
                        </div>
                    </DialogTitle>
                    <DialogDescription>
                        Create a new project with your preferred template and framework.
                    </DialogDescription>
                </DialogHeader>

                <ScrollArea FillContainer="true" EnableScrollShadows="true">
                    <EditForm EditContext="projectEditContext">
                        <DataAnnotationsValidator />
                        <FieldGroup Orientation="FieldGroupOrientation.Vertical" Class="mx-1">
                            <!-- Project Name -->
                            <Field>
                            <FieldLabel For="project-name">Project Name *</FieldLabel>
                            <FieldContent>
                                <Input Id="project-name"
                                       @bind-Value="projectModel.ProjectName"
                                       ShowValidationError="true"
                                       Placeholder="my-awesome-project" />
                            </FieldContent>
                        </Field>

                        <!-- Template Selection -->
                        <Field>
                            <FieldLabel For="project-template">Template</FieldLabel>
                            <FieldContent>
                                <Combobox TItem="TemplateOption"
                                          Items="templateOptions"
                                          @bind-Value="projectModel.Template"
                                          ValueSelector="@(t => t.Value)"
                                          DisplaySelector="@(t => t.Label)"
                                          Placeholder="Select template..."
                                          SearchPlaceholder="Search templates..."
                                          EmptyMessage="No template found."
                                          PopoverWidth="w-full" />
                            </FieldContent>
                        </Field>

                        <!-- Framework Selection -->
                        <Field>
                            <FieldLabel>Framework</FieldLabel>
                            <FieldContent>
                                <RadioGroup @bind-Value="projectModel.Framework" AriaLabel="Select framework">
                                    <label for="fw-react"
                                           class="@($"flex items-center justify-between rounded-lg border p-3 cursor-pointer transition-colors {(projectModel.Framework == "react" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <span class="flex-1">React</span>
                                        <RadioGroupItem Value="@("react")" Id="fw-react" Variant="RadioGroupItemVariant.Check" Class="ml-3" />
                                    </label>

                                    <label for="fw-vue"
                                           class="@($"flex items-center justify-between rounded-lg border p-3 cursor-pointer transition-colors {(projectModel.Framework == "vue" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <span class="flex-1">Vue</span>
                                        <RadioGroupItem Value="@("vue")" Id="fw-vue" Variant="RadioGroupItemVariant.Check" Class="ml-3" />
                                    </label>

                                    <label for="fw-svelte"
                                           class="@($"flex items-center justify-between rounded-lg border p-3 cursor-pointer transition-colors {(projectModel.Framework == "svelte" ? "border-primary bg-primary/5" : "border-input")}")">
                                        <span class="flex-1">Svelte</span>
                                        <RadioGroupItem Value="@("svelte")" Id="fw-svelte" Variant="RadioGroupItemVariant.Check" Class="ml-3" />
                                    </label>
                                </RadioGroup>
                            </FieldContent>
                        </Field>

                        <!-- Advanced Settings Button -->
                        <Button Variant="ButtonVariant.Outline"
                                OnClick="OpenAdvancedSettings"
                                Class="w-full">
                            <LucideIcon Name="settings" Size="16" />
                            Advanced Settings
                        </Button>
                    </FieldGroup>
                    </EditForm>
                </ScrollArea>

                <DialogFooter Class="flex-shrink-0 mt-auto pt-3 border-t">
                    <Button Variant="ButtonVariant.Outline" OnClick="CancelProject">Cancel</Button>
                    <Button OnClick="SaveProject">Create Project</Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>

        <!-- Nested Dialog B - Advanced Configuration -->
        <Dialog @bind-Open="showAdvancedSettingsDialog">
            <DialogContent Variant="DialogContentVariant.Form" Class="p-4 max-w-xl max-h-[90vh] flex flex-col">
                <DialogHeader Class="flex-shrink-0">
                    <DialogTitle>
                        <div class="flex items-center gap-2">
                            <LucideIcon Name="settings" Size="20" />
                            Advanced Configuration
                        </div>
                    </DialogTitle>
                    <DialogDescription>
                        Configure advanced deployment and build settings.
                    </DialogDescription>
                </DialogHeader>

                <ScrollArea FillContainer="true" EnableScrollShadows="true">
                    <FieldGroup Orientation="FieldGroupOrientation.Vertical" Class="mx-1">
                        <!-- Build Command -->
                        <Field>
                            <FieldLabel For="build-command">Build Command</FieldLabel>
                            <FieldContent>
                                <Input Id="build-command"
                                       @bind-Value="advancedSettingsModel.BuildCommand"
                                       Placeholder="npm run build" />
                            </FieldContent>
                        </Field>

                        <!-- Region -->
                        <Field>
                            <FieldLabel For="region">Region</FieldLabel>
                            <FieldContent>
                                <Select @bind-Value="advancedSettingsModel.Region" TValue="string">
                                    <SelectTrigger>
                                        <SelectValue Placeholder="Select region" />
                                    </SelectTrigger>
                                    <SelectContent>
                                        <SelectItem Value="@("us-east")" Text="US East" TValue="string" />
                                        <SelectItem Value="@("us-west")" Text="US West" TValue="string" />
                                        <SelectItem Value="@("eu")" Text="Europe" TValue="string" />
                                        <SelectItem Value="@("asia")" Text="Asia Pacific" TValue="string" />
                                    </SelectContent>
                                </Select>
                            </FieldContent>
                        </Field>

                        <Separator />

                        <!-- Timeout and Memory -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <Field>
                                <FieldLabel For="timeout">Timeout (seconds)</FieldLabel>
                                <FieldContent>
                                    <NumericInput @bind-Value="advancedSettingsModel.TimeoutSeconds"
                                                  Min="30"
                                                  Max="3600"
                                                  ShowStepper="true" />
                                </FieldContent>
                            </Field>

                            <Field>
                                <FieldLabel For="memory">Memory Limit (MB)</FieldLabel>
                                <FieldContent>
                                    <NumericInput @bind-Value="advancedSettingsModel.MemoryLimitMB"
                                                  Min="128"
                                                  Max="8192"
                                                  Step="128"
                                                  ShowStepper="true" />
                                </FieldContent>
                            </Field>
                        </div>

                        <Separator />

                        <!-- Feature Toggles -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <Field Orientation="FieldOrientation.Horizontal">
                                <FieldContent Class="flex flex-row justify-between gap-4">
                                    <div class="flex-1">
                                        <FieldLabel For="enable-cdn">Enable CDN</FieldLabel>
                                        <FieldDescription Class="text-wrap">Serve assets via global CDN</FieldDescription>
                                    </div>
                                    <Switch @bind-Checked="advancedSettingsModel.EnableCDN" Class="flex-shrink-0 mt-2 mr-2" />
                                </FieldContent>
                            </Field>

                            <Field Orientation="FieldOrientation.Horizontal">
                                <FieldContent Class="flex flex-row justify-between gap-4">
                                    <div class="flex-1">
                                        <FieldLabel For="enable-analytics">Enable Analytics</FieldLabel>
                                        <FieldDescription Class="text-wrap">Track page views and performance</FieldDescription>
                                    </div>
                                    <Switch @bind-Checked="advancedSettingsModel.EnableAnalytics" Class="flex-shrink-0 mt-2 mr-2" />
                                </FieldContent>
                            </Field>

                            <Field Orientation="FieldOrientation.Horizontal">
                                <FieldContent Class="flex flex-row justify-between gap-4">
                                    <div class="flex-1">
                                        <FieldLabel For="auto-deploy">Enable Auto-Deploy</FieldLabel>
                                        <FieldDescription Class="text-wrap">Deploy on every push to main</FieldDescription>
                                    </div>
                                    <Switch @bind-Checked="advancedSettingsModel.EnableAutoDeploy" Class="flex-shrink-0 mt-2 mr-2" />
                                </FieldContent>
                            </Field>
                        </div>

                        <!-- Environment Variables -->
                        <Field>
                            <FieldLabel For="env-vars">Environment Variables</FieldLabel>
                            <FieldContent>
                                <Textarea Id="env-vars"
                                          @bind-Value="advancedSettingsModel.EnvironmentVariables"
                                          Placeholder="KEY=value&#10;API_KEY=your_key_here"
                                          Rows="4" />
                                <FieldDescription>One variable per line in KEY=value format</FieldDescription>
                            </FieldContent>
                        </Field>
                    </FieldGroup>
                </ScrollArea>

                <DialogFooter Class="flex-shrink-0 mt-auto pt-3 border-t">
                    <Button Variant="ButtonVariant.Outline" OnClick="CancelAdvancedSettings">Cancel</Button>
                    <Button OnClick="SaveAdvancedSettings">Save Settings</Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>

        <!-- State Display for Demo 5 -->
        <Collapsible Class="mt-4 mb-2 border rounded-lg">
            <div class="px-4 py-3">
                <CollapsibleTrigger Class="flex w-full items-center justify-between text-left [&_svg]:transition-transform [&_svg]:duration-200 data-[state=open]:[&_svg]:rotate-180">
                    <span class="text-sm font-medium">Project & Advanced Settings Form State (JSON)</span>
                    <LucideIcon Name="chevron-down" Size="16" />
                </CollapsibleTrigger>
            </div>
            <CollapsibleContent Class="px-4 pb-4 border-t">
                <div class="pt-4">
                    <pre class="text-xs overflow-x-auto bg-muted/50 p-3 rounded">@JsonSerializer.Serialize(new { Project = projectModel, AdvancedSettings = advancedSettingsModel }, new JsonSerializerOptions { WriteIndented = true })</pre>
                </div>
            </CollapsibleContent>
        </Collapsible>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Features</h2>
        <ul class="list-disc list-inside space-y-2 text-sm">
            <li>Full keyboard navigation support</li>
            <li>Focus is automatically trapped within the dialog</li>
            <li>Can be controlled or uncontrolled</li>
            <li>Manages screen reader announcements with ARIA</li>
            <li>Scroll lock on body when dialog is open</li>
            <li>Respects prefers-reduced-motion</li>
        </ul>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Installation</h2>

        <div class="space-y-2">
            <p class="text-sm text-muted-foreground">Add the following using statement to your _Imports.razor:</p>
            <div class="bg-muted p-4 rounded-md">
                <code class="text-sm">@@using BlazorUI.Components.Dialog</code>
            </div>
        </div>
    </div>

    <div class="space-y-4">
        <h2 class="text-2xl font-semibold">Usage</h2>

        <div class="bg-muted p-4 rounded-md">
            <pre class="text-sm overflow-x-auto"><code>&lt;Dialog&gt;
    &lt;DialogTrigger&gt;Open&lt;/DialogTrigger&gt;
    &lt;DialogContent&gt;
        &lt;DialogHeader&gt;
            &lt;DialogTitle&gt;Are you absolutely sure?&lt;/DialogTitle&gt;
            &lt;DialogDescription&gt;
                This action cannot be undone.
            &lt;/DialogDescription&gt;
        &lt;/DialogHeader&gt;
    &lt;/DialogContent&gt;
&lt;/Dialog&gt;</code></pre>
        </div>
    </div>
</div>

@code {
    private bool isDialogOpen = false;
    private string? selectedComboboxFramework;

    private readonly List<ComboboxFramework> comboboxFrameworks = new()
{
    new ComboboxFramework { Value = "blazor", Label = "Blazor" },
    new ComboboxFramework { Value = "react", Label = "React" },
    new ComboboxFramework { Value = "vue", Label = "Vue" },
    new ComboboxFramework { Value = "angular", Label = "Angular" },
    new ComboboxFramework { Value = "svelte", Label = "Svelte" },
    new ComboboxFramework { Value = "nextjs", Label = "Next.js" },
    new ComboboxFramework { Value = "nuxt", Label = "Nuxt" }
};

    private void HandleSave()
    {
        // Handle save logic
        isDialogOpen = false;
    }

    private string GetComboboxFrameworkLabel(string? value) =>
        comboboxFrameworks.FirstOrDefault(f => f.Value == value)?.Label ?? value ?? "";

    public class ComboboxFramework
    {
        public required string Value { get; set; }
        public required string Label { get; set; }
    }

    // ========================================
    // Advanced Dialog Demos - State Management
    // ========================================

    // Demo 1: User Profile Settings
    private bool showUserProfileDialog = false;
    private UserProfileModel userProfileModel = new();
    private EditContext userProfileEditContext = null!;

    protected override void OnInitialized()
    {
        userProfileEditContext = new EditContext(userProfileModel);
        teamInviteEditContext = new EditContext(teamInviteModel);
        projectEditContext = new EditContext(projectModel);
    }

    private class UserProfileModel
    {
        [Required(ErrorMessage = "Name is required")]
        public string? Name { get; set; }

        public string? Username { get; set; }

        [Required, EmailAddress]
        public string? Email { get; set; }

        [Phone]
        public string? PhoneNumber { get; set; }

        public DateOnly? DateOfBirth { get; set; }
        public string? ThemeColor { get; set; } = "#3b82f6";
        public string? Bio { get; set; }
        public bool EmailNotifications { get; set; } = true;
        public bool MarketingEmails { get; set; } = false;
    }

    private void SaveUserProfile()
    {
        // Set request focus on the first invalid input
        userProfileEditContext.RequestFocusFirstInvalidInput();

        if (!userProfileEditContext.Validate())
        {
            ToastService.Error("Validation failed", "Please fix the errors before saving");
            return;
        }

        showUserProfileDialog = false;
        ToastService.Success("Changes saved", "See the output form JSON below");
    }

    private void CancelUserProfile()
    {
        showUserProfileDialog = false;
        ToastService.Show("Changes cancelled");
    }

    // Demo 2: Subscription Plan Selection
    private bool showSubscriptionDialog = false;
    private SubscriptionModel subscriptionModel = new();

    private class SubscriptionModel
    {
        public string SelectedPlan { get; set; } = "pro";
        public bool IsAnnual { get; set; } = true;
        public double TeamSize { get; set; } = 5;
        public string? PromoCode { get; set; }
        public bool AutoRenew { get; set; } = true;
    }

    private decimal CalculateSubscriptionTotal()
    {
        var basePrice = subscriptionModel.SelectedPlan switch
        {
            "starter" => subscriptionModel.IsAnnual ? 8 : 10,
            "pro" => subscriptionModel.IsAnnual ? 24 : 30,
            "enterprise" => subscriptionModel.IsAnnual ? 80 : 100,
            _ => 0
        };

        // Add extra cost for team members over 10
        var teamCost = subscriptionModel.TeamSize > 10 ? ((int)subscriptionModel.TeamSize - 10) * 5 : 0;

        return basePrice + teamCost;
    }

    private decimal CalculateAnnualSavings()
    {
        var monthlyTotal = subscriptionModel.SelectedPlan switch
        {
            "starter" => 10,
            "pro" => 30,
            "enterprise" => 100,
            _ => 0
        };

        var annualTotal = subscriptionModel.SelectedPlan switch
        {
            "starter" => 8,
            "pro" => 24,
            "enterprise" => 80,
            _ => 0
        };

        return (monthlyTotal - annualTotal) * 12;
    }

    private void SaveSubscription()
    {
        showSubscriptionDialog = false;
        ToastService.Success("Subscription confirmed", "See the output form JSON below");
    }

    private void CancelSubscription()
    {
        showSubscriptionDialog = false;
        ToastService.Show("Subscription cancelled");
    }

    // Demo 3: Team Member Invite
    private bool showTeamInviteDialog = false;
    private TeamInviteModel teamInviteModel = new();
    private EditContext teamInviteEditContext = null!;
    private readonly List<Project> availableProjects = new()
    {
        new Project { Name = "Project Alpha" },
        new Project { Name = "Project Beta" },
        new Project { Name = "Project Gamma" },
        new Project { Name = "Project Delta" }
    };

    private class TeamInviteModel
    {
        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string? Email { get; set; }

        [Required]
        public string Role { get; set; } = "member";

        public string? Department { get; set; }

        public IEnumerable<string> AssignedProjects { get; set; } = new List<string>();
        public DateOnly? AccessExpiresOn { get; set; }
        public bool SendEmailImmediately { get; set; } = true;
    }

    private void SaveTeamInvite()
    {
        // Set request focus on the first invalid input
        teamInviteEditContext.RequestFocusFirstInvalidInput();

        if (!teamInviteEditContext.Validate())
        {
            ToastService.Error("Validation failed", "Please fix the errors before sending the invitation");
            return;
        }

        showTeamInviteDialog = false;
        ToastService.Success("Invitation sent", "See the output form JSON below");
    }

    private void CancelTeamInvite()
    {
        showTeamInviteDialog = false;
        ToastService.Show("Invitation cancelled");
    }

    private class Project
    {
        public required string Name { get; set; }
    }

    // Demo 4: E-commerce Product Configuration
    private bool showProductConfigDialog = false;
    private ProductConfigModel productConfigModel = new();

    private class ProductConfigModel
    {
        public string? ProductName { get; set; }
        public string ProductColor { get; set; } = "#3b82f6";
        public string? Size { get; set; } = "M";
        public int Quantity { get; set; } = 1;
        public double Rating { get; set; } = 4.5;
        public double MinPrice { get; set; } = 50;
        public double MaxPrice { get; set; } = 200;
        public decimal? CustomOfferPrice { get; set; }
        public string? SpecialInstructions { get; set; }
        public bool GiftWrap { get; set; } = false;
        public bool PriorityShipping { get; set; } = false;
    }

    private void SaveProductConfig()
    {
        showProductConfigDialog = false;
        ToastService.Success("Product added to cart", "See the output form JSON below");
    }

    private void CancelProductConfig()
    {
        showProductConfigDialog = false;
        ToastService.Show("Product configuration cancelled");
    }

    // Demo 5: Nested Dialog - Create Project with Advanced Settings
    private bool showProjectDialog = false;
    private bool showAdvancedSettingsDialog = false;
    private ProjectModel projectModel = new();
    private EditContext projectEditContext = null!;
    private AdvancedSettingsModel advancedSettingsModel = new();

    private class ProjectModel
    {
        [Required(ErrorMessage = "Project name is required")]
        public string? ProjectName { get; set; }

        public string? Template { get; set; } = "nextjs";
        public string Framework { get; set; } = "react";
    }

    private class TemplateOption
    {
        public required string Value { get; set; }
        public required string Label { get; set; }
    }

    private readonly List<TemplateOption> templateOptions = new()
    {
        new TemplateOption { Value = "nextjs", Label = "Next.js" },
        new TemplateOption { Value = "vite", Label = "Vite" },
        new TemplateOption { Value = "nuxt", Label = "Nuxt" },
        new TemplateOption { Value = "remix", Label = "Remix" },
        new TemplateOption { Value = "astro", Label = "Astro" }
    };

    private class AdvancedSettingsModel
    {
        public string BuildCommand { get; set; } = "npm run build";
        public string? Region { get; set; } = "us-east";
        public int TimeoutSeconds { get; set; } = 300;
        public int MemoryLimitMB { get; set; } = 512;
        public bool EnableCDN { get; set; } = true;
        public bool EnableAnalytics { get; set; } = false;
        public bool EnableAutoDeploy { get; set; } = true;
        public string? EnvironmentVariables { get; set; }
    }

    private void OpenAdvancedSettings()
    {
        showAdvancedSettingsDialog = true;
    }

    private void SaveAdvancedSettings()
    {
        showAdvancedSettingsDialog = false;
        ToastService.Success("Advanced settings saved", "Configuration applied successfully");
    }

    private void CancelAdvancedSettings()
    {
        showAdvancedSettingsDialog = false;
        ToastService.Show("Advanced settings cancelled");
    }

    private void SaveProject()
    {
        if (!projectEditContext.Validate())
        {
            // Request focus on the first invalid input
            projectEditContext.RequestFocusFirstInvalidInput();
            ToastService.Error("Validation failed", "Please fix the errors before creating the project");
            return;
        }

        showProjectDialog = false;
        ToastService.Success("Project created", "See the output form JSON below");
    }

    private void CancelProject()
    {
        showProjectDialog = false;
        ToastService.Show("Project creation cancelled");
    }
}
