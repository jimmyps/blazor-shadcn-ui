@page "/components/chart/pie"
@using BlazorUI.Components.Card
@using BlazorUI.Components.Chart

<PageTitle>Chart Components - Pie Chart</PageTitle>

<div class="space-y-8">
    @* Hero - Interactive Pie Chart with Month Selector *@
    <Card>
        <CardHeader Class="flex items-center gap-2 space-y-0 border-b py-5 sm:flex-row">
            <div class="grid flex-1 gap-1">
                <CardTitle>Pie Chart - Interactive</CardTitle>
                <CardDescription>Showing browser usage statistics for @(monthDescriptions.TryGetValue(selectedMonth, out var description) ? description.ToLower() : "January")</CardDescription>
            </div>
            <Select @bind-Value="@selectedMonth" Class="hidden w-[160px] rounded-lg sm:ml-auto sm:flex">
                <SelectTrigger>
                    <SelectValue Placeholder="January" />
                </SelectTrigger>
                <SelectContent>
                    @foreach (var month in monthDescriptions)
                    {
                        <SelectItem Value="@month.Key" Text="@month.Value">@month.Value</SelectItem>
                    }
                </SelectContent>
            </Select>
        </CardHeader>
        <CardContent Class="px-2 pt-4 sm:px-6 sm:pt-6">
            <ChartContainer Height="250" Class="w-full">
                <PieChart Data="@FilteredBrowserData">
                    <Tooltip />
                    <Legend Show="false" />
                    <Pie DataKey="value" NameKey="name" Color="var(--chart-1)">
                        <LabelList Color="var(--muted-foreground)" />
                    </Pie>
                </PieChart>
            </ChartContainer>
        </CardContent>
    </Card>

    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-2">
        @* Simple Pie Chart *@
        <Card>
            <CardHeader>
                <CardTitle>Simple Pie</CardTitle>
                <CardDescription>Basic pie chart</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name">
                            <LabelList Show="false" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Donut Chart *@
        <Card>
            <CardHeader>
                <CardTitle>Donut Chart</CardTitle>
                <CardDescription>Pie with inner radius</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" InnerRadius="30%">
                            <LabelList Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Donut Active (Emphasis) *@
        <Card>
            <CardHeader>
                <CardTitle>Ring Chart</CardTitle>
                <CardDescription>Ring chart with emphasis effect</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" InnerRadius="60%" EmphasisScaleSize="10">
                            <LabelList Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Rose/Nightingale Chart *@
        <Card>
            <CardHeader>
                <CardTitle>Rose Chart</CardTitle>
                <CardDescription>Nightingale rose chart where radius represents value</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" RoseType="radius">
                            <LabelList Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Pie with Labels *@
        <Card>
            <CardHeader>
                <CardTitle>With Labels</CardTitle>
                <CardDescription>Data labels on slices</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" ShowLabel="true">
                            <LabelList Position="LabelPosition.Outside" Formatter="{b}: {c}%" FontSize="10" Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Pie with Custom Labels *@
        <Card>
            <CardHeader>
                <CardTitle>Custom Labels</CardTitle>
                <CardDescription>Custom formatted labels</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" ShowLabel="true">
                            <LabelList Position="LabelPosition.Outside" Formatter="function(params) { return params.name + '\n' + params.value + '%'; }" FontSize="9" Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Pie with Label Lines *@
        <Card>
            <CardHeader>
                <CardTitle>With Label Lines</CardTitle>
                <CardDescription>Labels connected with curved lines</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" ShowLabel="true">
                            <LabelList Position="LabelPosition.Outside" Formatter="{b}" FontSize="10" Color="var(--muted-foreground)" />
                            <LabelLine Length="10" Length2="15" Smooth="true" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Pie Label List *@
        <Card>
            <CardHeader>
                <CardTitle>Label List</CardTitle>
                <CardDescription>Inside labels with percentage</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" ShowLabel="true">
                            <LabelList Position="LabelPosition.Inside" Formatter="{c}%" FontSize="11" Color="var(--color-white)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Pie with Legend *@
        <Card>
            <CardHeader>
                <CardTitle>With Legend</CardTitle>
                <CardDescription>Legend and chart positioning</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend VerticalAlign="LegendVerticalAlign.Bottom" Align="LegendAlign.Center" />
                        <Pie DataKey="value" NameKey="name" OuterRadius="40%" Center="@(new string[] {"50%", "40%"})">
                            <LabelList Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Slice Spacing with PadAngle *@
        <Card>
            <CardHeader>
                <CardTitle>Slice Spacing</CardTitle>
                <CardDescription>PadAngle adds gaps between slices</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" PadAngle="5">
                            <LabelList Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Semi-Circle Gauge *@
        <Card>
            <CardHeader>
                <CardTitle>Semi-Circle</CardTitle>
                <CardDescription>Half-circle gauge using custom angles</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <PieChart Data="@browserData">
                        <Tooltip />
                        <Legend Show="false" />
                        <Pie DataKey="value" NameKey="name" StartAngle="180" EndAngle="360" InnerRadius="50%">
                            <LabelList Color="var(--muted-foreground)" />
                        </Pie>
                    </PieChart>
                </ChartContainer>
            </CardContent>
        </Card>
    </div>
</div>

@code {
private string selectedMonth = "jan";

// Month descriptions for display
private Dictionary<string, string> monthDescriptions = new()
{
    { "jan", "January" },
    { "feb", "February" },
    { "mar", "March" }
};

// Monthly browser usage statistics
    private List<BrowserMonthData> browserMonthlyData = new()
    {
        // January
        new() { month = "jan", name = "Chrome", value = 45 },
        new() { month = "jan", name = "Firefox", value = 25 },
        new() { month = "jan", name = "Safari", value = 15 },
        new() { month = "jan", name = "Edge", value = 10 },
        new() { month = "jan", name = "Other", value = 5 },
        
        // February - Larger values to show significant change in interactive demo
        new() { month = "feb", name = "Chrome", value = 58 },
        new() { month = "feb", name = "Firefox", value = 43 },
        new() { month = "feb", name = "Safari", value = 26 },
        new() { month = "feb", name = "Edge", value = 19 },
        new() { month = "feb", name = "Other", value = 14 },
        
        // March - Even larger values to show progressive increase
        new() { month = "mar", name = "Chrome", value = 77 },
        new() { month = "mar", name = "Firefox", value = 64 },
        new() { month = "mar", name = "Safari", value = 37 },
        new() { month = "mar", name = "Edge", value = 28 },
        new() { month = "mar", name = "Other", value = 34 }
    };

    private List<BrowserData> browserData => FilteredBrowserData;

    private List<BrowserData> FilteredBrowserData
    {
        get
        {
            return browserMonthlyData
                .Where(x => x.month == selectedMonth)
                .Select(x => new BrowserData { name = x.name, value = x.value })
                .ToList();
        }
    }

    public class BrowserMonthData
    {
        public string month { get; set; } = "";
        public string name { get; set; } = "";
        public int value { get; set; }
    }

    public class BrowserData
    {
        public string name { get; set; } = "";
        public int value { get; set; }
    }
}
