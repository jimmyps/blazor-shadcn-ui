@page "/components/chart/bar"
@using BlazorUI.Components.Card
@using BlazorUI.Components.Chart

<PageTitle>Chart Components - Bar Chart</PageTitle>

<div class="space-y-8">
    @* Hero - Interactive Bar Chart with Date Filter *@
    <Card>
        <CardHeader Class="flex items-center gap-2 space-y-0 border-b pb-4 sm:flex-row">
            <div class="grid flex-1 gap-1">
                <CardTitle Class="text-xl">Bar Chart - Interactive</CardTitle>
                <CardDescription>Showing sales data for the @(timeRanges.TryGetValue(timeRange, out var description) ? description.ToLower() : "last 30 days")</CardDescription>
            </div>
            <Select @bind-Value="@timeRange" Class="w-[160px] rounded-lg sm:ml-auto sm:flex">
                <SelectTrigger>
                    <SelectValue Placeholder="Last 30 days" />
                </SelectTrigger>
                <SelectContent>
                    @foreach (var range in timeRanges)
                    {
                        <SelectItem Value="@range.Key" Text="@range.Value">@range.Value</SelectItem>
                    }
                </SelectContent>
            </Select>
        </CardHeader>
        <CardContent Class="p-6 pt-2 sm:px-6 sm:pt-6">
            <ChartContainer Height="250" Class="w-full">
                <BarChart Data="@FilteredData" Padding="@(new Padding(32, 16, 0, 16))">
                    <Grid Vertical="false" Stroke="var(--border)" />
                    <XAxis DataKey="date" TickLine="false" Color="var(--border)">
                        <AxisLabel Color="var(--muted-foreground)" Formatter="@dateFormatter" />
                    </XAxis>
                    <YAxis Show="false" TickLine="false">
                        <AxisLabel Show="false" />
                    </YAxis>
                    <Tooltip Mode="TooltipMode.Axis" Cursor="TooltipCursor.Shadow" />
                    <Legend TextColor="var(--foreground)" />
                    <Bar DataKey="desktop" Name="Desktop" Radius="4" Color="var(--chart-1)" />
                    <Bar DataKey="mobile" Name="Mobile" Radius="4" Color="var(--chart-2)" />
                </BarChart>
            </ChartContainer>
        </CardContent>
    </Card>

    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-2">
        @* Default Bar Chart *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Bar Chart</CardTitle>
                <CardDescription>Default bar chart</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@simpleData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend Show="false" />
                        <Bar DataKey="sales" Name="Sales" Radius="4" Color="var(--chart-1)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Horizontal Bar Chart *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Horizontal Bars</CardTitle>
                <CardDescription>Horizontal orientation</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@simpleData" Layout="BarLayout.Horizontal" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="sales" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend Show="false" />
                        <Bar DataKey="sales" Name="Sales" Radius="4" Color="var(--chart-2)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Multiple Bars *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Multiple Bars</CardTitle>
                <CardDescription>Side-by-side bars</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@multiData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend TextColor="var(--foreground)" />
                        <Bar DataKey="product1" Name="Product A" Radius="4" Color="var(--chart-1)" />
                        <Bar DataKey="product2" Name="Product B" Radius="4" Color="var(--chart-2)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Stacked Bar Chart *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Stacked Bars</CardTitle>
                <CardDescription>Stacked bar chart</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@multiData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend TextColor="var(--foreground)" />
                        <Bar DataKey="product1" Name="Product A" StackId="total" Radius="4" Color="var(--chart-1)" />
                        <Bar DataKey="product2" Name="Product B" StackId="total" Radius="4" Color="var(--chart-2)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Bar with Labels (MVP+ Feature) *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">With Labels</CardTitle>
                <CardDescription>Data labels on bars</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@simpleData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend Show="false" />
                        <Bar DataKey="sales" Name="Sales" Radius="4" ShowLabel="true" LabelPosition="LabelPosition.Top" Color="var(--chart-3)">
                            <LabelList Position="LabelPosition.Top" Formatter="{c}" FontSize="11" Color="#666" />
                        </Bar>
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Bar with Custom Labels (MVP+ Feature) *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Custom Labels</CardTitle>
                <CardDescription>Custom label formatting</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@simpleData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend Show="false" />
                        <Bar DataKey="sales" Name="Sales" Radius="4" ShowLabel="true" Color="var(--chart-4)">
                            <LabelList Position="LabelPosition.Inside" Formatter="function(params) { return '$' + params.value; }" FontSize="10" Color="#fff" />
                        </Bar>
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* 100% Stacked Bars (MVP+ Feature) *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">100% Stacked</CardTitle>
                <CardDescription>Percentage stacking</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@multiData" StackOffset="StackOffset.Expand" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip Formatter="function(params) { return params.seriesName + ': ' + params.value.toFixed(1) + '%'; }" />
                        <Legend TextColor="var(--foreground)" />
                        <Bar DataKey="product1" Name="Product A" StackId="total" Radius="4" Color="var(--chart-1)" />
                        <Bar DataKey="product2" Name="Product B" StackId="total" Radius="4" Color="var(--chart-2)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Active Bar (Emphasis) *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Active/Hover</CardTitle>
                <CardDescription>Hover emphasis effect</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@simpleData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend Show="false" />
                        <Bar DataKey="sales" Name="Sales" Radius="4" Color="var(--chart-5)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Mixed (Bar + Line) *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Mixed Chart</CardTitle>
                <CardDescription>Bar and line combined</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <ComposedChart Data="@multiData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend TextColor="var(--foreground)" />
                        <Bar DataKey="product1" Name="Product A" Radius="4" Color="var(--chart-1)" />
                        <Line DataKey="product2" Name="Product B" Color="var(--chart-2)" />
                    </ComposedChart>
                </ChartContainer>
            </CardContent>
        </Card>

        @* Negative Values *@
        <Card>
            <CardHeader Class="pb-2">
                <CardTitle Class="text-xl">Negative Values</CardTitle>
                <CardDescription>Bars with positive and negative</CardDescription>
            </CardHeader>
            <CardContent>
                <ChartContainer Height="200">
                    <BarChart Data="@negativeData" Padding="ChartDefaults.DefaultPadding">
                        <Grid Stroke="var(--border)" />
                        <XAxis DataKey="month" Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </XAxis>
                        <YAxis Color="var(--border)">
                            <AxisLabel Color="var(--muted-foreground)" />
                        </YAxis>
                        <Tooltip />
                        <Legend Show="false" />
                        <Bar DataKey="value" Name="Profit/Loss" Radius="4" Color="var(--chart-3)" />
                    </BarChart>
                </ChartContainer>
            </CardContent>
        </Card>
    </div>
</div>

@code {
private string timeRange = "30d";

// Time range options - single source of truth for maintainability
private readonly Dictionary<string, string> timeRanges = new()
{
    { "90d", "Last 3 months" },
    { "30d", "Last 30 days" },
    { "7d", "Last 7 days" }
};

    // 90-day comprehensive dataset
    private List<ChartDataPoint> chartData = new()
    {
        new() { date = "2024-04-01", desktop = 222, mobile = 150 },
        new() { date = "2024-04-02", desktop = 97, mobile = 180 },
        new() { date = "2024-04-03", desktop = 167, mobile = 120 },
        new() { date = "2024-04-04", desktop = 242, mobile = 260 },
        new() { date = "2024-04-05", desktop = 373, mobile = 290 },
        new() { date = "2024-04-06", desktop = 301, mobile = 340 },
        new() { date = "2024-04-07", desktop = 245, mobile = 180 },
        new() { date = "2024-04-08", desktop = 409, mobile = 320 },
        new() { date = "2024-04-09", desktop = 59, mobile = 110 },
        new() { date = "2024-04-10", desktop = 261, mobile = 190 },
        new() { date = "2024-04-11", desktop = 327, mobile = 350 },
        new() { date = "2024-04-12", desktop = 292, mobile = 210 },
        new() { date = "2024-04-13", desktop = 342, mobile = 380 },
        new() { date = "2024-04-14", desktop = 137, mobile = 220 },
        new() { date = "2024-04-15", desktop = 120, mobile = 170 },
        new() { date = "2024-04-16", desktop = 138, mobile = 190 },
        new() { date = "2024-04-17", desktop = 446, mobile = 360 },
        new() { date = "2024-04-18", desktop = 364, mobile = 410 },
        new() { date = "2024-04-19", desktop = 243, mobile = 180 },
        new() { date = "2024-04-20", desktop = 89, mobile = 150 },
        new() { date = "2024-04-21", desktop = 137, mobile = 200 },
        new() { date = "2024-04-22", desktop = 224, mobile = 170 },
        new() { date = "2024-04-23", desktop = 138, mobile = 230 },
        new() { date = "2024-04-24", desktop = 387, mobile = 290 },
        new() { date = "2024-04-25", desktop = 215, mobile = 250 },
        new() { date = "2024-04-26", desktop = 75, mobile = 130 },
        new() { date = "2024-04-27", desktop = 383, mobile = 420 },
        new() { date = "2024-04-28", desktop = 122, mobile = 180 },
        new() { date = "2024-04-29", desktop = 315, mobile = 240 },
        new() { date = "2024-04-30", desktop = 454, mobile = 380 },
        new() { date = "2024-05-01", desktop = 165, mobile = 220 },
        new() { date = "2024-05-02", desktop = 293, mobile = 310 },
        new() { date = "2024-05-03", desktop = 247, mobile = 190 },
        new() { date = "2024-05-04", desktop = 385, mobile = 420 },
        new() { date = "2024-05-05", desktop = 481, mobile = 390 },
        new() { date = "2024-05-06", desktop = 498, mobile = 520 },
        new() { date = "2024-05-07", desktop = 388, mobile = 300 },
        new() { date = "2024-05-08", desktop = 149, mobile = 210 },
        new() { date = "2024-05-09", desktop = 227, mobile = 180 },
        new() { date = "2024-05-10", desktop = 293, mobile = 330 },
        new() { date = "2024-05-11", desktop = 335, mobile = 270 },
        new() { date = "2024-05-12", desktop = 197, mobile = 240 },
        new() { date = "2024-05-13", desktop = 197, mobile = 160 },
        new() { date = "2024-05-14", desktop = 448, mobile = 490 },
        new() { date = "2024-05-15", desktop = 473, mobile = 380 },
        new() { date = "2024-05-16", desktop = 338, mobile = 400 },
        new() { date = "2024-05-17", desktop = 499, mobile = 420 },
        new() { date = "2024-05-18", desktop = 315, mobile = 350 },
        new() { date = "2024-05-19", desktop = 235, mobile = 180 },
        new() { date = "2024-05-20", desktop = 177, mobile = 230 },
        new() { date = "2024-05-21", desktop = 82, mobile = 140 },
        new() { date = "2024-05-22", desktop = 81, mobile = 120 },
        new() { date = "2024-05-23", desktop = 252, mobile = 290 },
        new() { date = "2024-05-24", desktop = 294, mobile = 220 },
        new() { date = "2024-05-25", desktop = 201, mobile = 250 },
        new() { date = "2024-05-26", desktop = 213, mobile = 170 },
        new() { date = "2024-05-27", desktop = 420, mobile = 460 },
        new() { date = "2024-05-28", desktop = 233, mobile = 190 },
        new() { date = "2024-05-29", desktop = 78, mobile = 130 },
        new() { date = "2024-05-30", desktop = 340, mobile = 280 },
        new() { date = "2024-05-31", desktop = 178, mobile = 230 },
        new() { date = "2024-06-01", desktop = 178, mobile = 200 },
        new() { date = "2024-06-02", desktop = 470, mobile = 410 },
        new() { date = "2024-06-03", desktop = 103, mobile = 160 },
        new() { date = "2024-06-04", desktop = 439, mobile = 380 },
        new() { date = "2024-06-05", desktop = 88, mobile = 140 },
        new() { date = "2024-06-06", desktop = 294, mobile = 250 },
        new() { date = "2024-06-07", desktop = 323, mobile = 370 },
        new() { date = "2024-06-08", desktop = 385, mobile = 320 },
        new() { date = "2024-06-09", desktop = 438, mobile = 480 },
        new() { date = "2024-06-10", desktop = 155, mobile = 200 },
        new() { date = "2024-06-11", desktop = 92, mobile = 150 },
        new() { date = "2024-06-12", desktop = 492, mobile = 420 },
        new() { date = "2024-06-13", desktop = 81, mobile = 130 },
        new() { date = "2024-06-14", desktop = 426, mobile = 380 },
        new() { date = "2024-06-15", desktop = 307, mobile = 350 },
        new() { date = "2024-06-16", desktop = 371, mobile = 310 },
        new() { date = "2024-06-17", desktop = 475, mobile = 520 },
        new() { date = "2024-06-18", desktop = 107, mobile = 170 },
        new() { date = "2024-06-19", desktop = 341, mobile = 290 },
        new() { date = "2024-06-20", desktop = 408, mobile = 450 },
        new() { date = "2024-06-21", desktop = 169, mobile = 210 },
        new() { date = "2024-06-22", desktop = 317, mobile = 270 },
        new() { date = "2024-06-23", desktop = 480, mobile = 530 },
        new() { date = "2024-06-24", desktop = 132, mobile = 180 },
        new() { date = "2024-06-25", desktop = 141, mobile = 190 },
        new() { date = "2024-06-26", desktop = 434, mobile = 380 },
        new() { date = "2024-06-27", desktop = 448, mobile = 490 },
        new() { date = "2024-06-28", desktop = 149, mobile = 200 },
        new() { date = "2024-06-29", desktop = 103, mobile = 160 },
        new() { date = "2024-06-30", desktop = 446, mobile = 400 }
    };

    private const string dateFormatter = @"
function (value) {
    const date = new Date(value);
    return date.toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric'})
}";

    private List<ChartDataPoint> FilteredData => timeRange switch
    {
        "7d" => chartData.TakeLast(7).ToList(),
        "30d" => chartData.TakeLast(30).ToList(),
        _ => chartData
    };

    private List<SimpleChartData> simpleData = new()
    {
        new() { month = "Jan", sales = 186 },
        new() { month = "Feb", sales = 305 },
        new() { month = "Mar", sales = 237 },
        new() { month = "Apr", sales = 273 },
        new() { month = "May", sales = 209 },
        new() { month = "Jun", sales = 214 }
    };

    private List<MultiChartData> multiData = new()
    {
        new() { month = "Jan", product1 = 186, product2 = 80 },
        new() { month = "Feb", product1 = 305, product2 = 200 },
        new() { month = "Mar", product1 = 237, product2 = 120 },
        new() { month = "Apr", product1 = 273, product2 = 190 },
        new() { month = "May", product1 = 209, product2 = 130 },
        new() { month = "Jun", product1 = 214, product2 = 140 }
    };

    private List<NegativeData> negativeData = new()
    {
        new() { month = "Jan", value = 150 },
        new() { month = "Feb", value = -80 },
        new() { month = "Mar", value = 200 },
        new() { month = "Apr", value = -120 },
        new() { month = "May", value = 90 },
        new() { month = "Jun", value = 180 }
    };

    public class ChartDataPoint
    {
        public string date { get; set; } = "";
        public int desktop { get; set; }
        public int mobile { get; set; }
    }

    public class SimpleChartData
    {
        public string month { get; set; } = "";
        public int sales { get; set; }
    }

    public class MultiChartData
    {
        public string month { get; set; } = "";
        public int product1 { get; set; }
        public int product2 { get; set; }
    }

    public class NegativeData
    {
        public string month { get; set; } = "";
        public int value { get; set; }
    }
}
