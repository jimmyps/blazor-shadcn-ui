@using BlazorUI.Components.Grid
@using BlazorUI.Components.Badge
@using BlazorUI.Components.Button
@using BlazorUI.Components.DropdownMenu
@using BlazorUI.Demo.Shared.Data

<PageTitle>Grid Components - Templating Examples</PageTitle>

<div class="space-y-8">
    @* Demo 6: Custom Cell Templates *@
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Cell Templates</h2>
            <p class="text-muted-foreground">
                Custom cell rendering using Badge for status and formatted currency for amounts.
            </p>
        </div>

        <div class="rounded-lg border bg-card p-6">
            <Grid Items="@orders">
                <Columns>
                    <GridColumn Field="Id" Header="Order ID" Width="100px" />
                    <GridColumn Field="Customer" Header="Customer" />
                    <GridColumn Field="Status" Header="Status" Width="130px">
                        <CellTemplate Context="order">
                            <Badge Variant="@GetStatusVariant(order.Status)">
                                @order.Status
                            </Badge>
                        </CellTemplate>
                    </GridColumn>
                    <GridColumn Field="Amount" Header="Amount" Width="140px">
                        <CellTemplate Context="order">
                            <span class="font-mono font-medium">@order.Amount.ToString("C")</span>
                        </CellTemplate>
                    </GridColumn>
                    <GridColumn Field="OrderDate" Header="Order Date" Width="140px">
                        <CellTemplate Context="order">
                            <span class="text-sm text-muted-foreground">@order.OrderDate.ToString("MMM dd, yyyy")</span>
                        </CellTemplate>
                    </GridColumn>
                </Columns>
            </Grid>
        </div>

        <details class="rounded-lg border">
            <summary class="cursor-pointer select-none px-4 py-3 font-medium hover:bg-muted/50">
                View Code
            </summary>
            <div class="border-t bg-muted/20 p-4">
                <pre class="overflow-x-auto text-sm"><code>&lt;GridColumn Field="Status" Header="Status"&gt;
    &lt;CellTemplate Context="order"&gt;
        &lt;Badge Variant="@@GetStatusVariant(order.Status)"&gt;@@order.Status&lt;/Badge&gt;
    &lt;/CellTemplate&gt;
&lt;/GridColumn&gt;</code></pre>
            </div>
        </details>
    </section>

    @* Demo 7: Custom Header Templates *@
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Custom Header Templates</h2>
            <p class="text-muted-foreground">
                Custom header rendering with icons for enhanced visual hierarchy.
            </p>
        </div>

        <div class="rounded-lg border bg-card p-6">
            <Grid Items="@orders.Take(10).ToList()">
                <Columns>
                    <GridColumn Field="Id" Header="Order ID" Width="100px" />
                    <GridColumn Field="Customer" Header="Customer">
                        <HeaderTemplate>
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <span>Customer</span>
                            </div>
                        </HeaderTemplate>
                    </GridColumn>
                    <GridColumn Field="Amount" Header="Amount" Width="140px">
                        <HeaderTemplate>
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>Amount</span>
                            </div>
                        </HeaderTemplate>
                    </GridColumn>
                    <GridColumn Field="Status" Header="Status" Width="130px" />
                </Columns>
            </Grid>
        </div>

        <details class="rounded-lg border">
            <summary class="cursor-pointer select-none px-4 py-3 font-medium hover:bg-muted/50">
                View Code
            </summary>
            <div class="border-t bg-muted/20 p-4">
                <pre class="overflow-x-auto text-sm"><code>&lt;GridColumn Field="Customer"&gt;
    &lt;HeaderTemplate&gt;
        &lt;div class="flex items-center gap-2"&gt;
            &lt;Icon Name="user" /&gt;Customer
        &lt;/div&gt;
    &lt;/HeaderTemplate&gt;
&lt;/GridColumn&gt;</code></pre>
            </div>
        </details>
    </section>

    @* Demo 8: Row Actions *@
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Row Actions</h2>
            <p class="text-muted-foreground">
                Action column with DropdownMenu for Edit, Duplicate, and Delete operations.
            </p>
        </div>

        <div class="rounded-lg border bg-card p-6">
            <Grid Items="@orders.Take(10).ToList()">
                <Columns>
                    <GridColumn Field="Id" Header="Order ID" Width="100px" />
                    <GridColumn Field="Customer" Header="Customer" />
                    <GridColumn Field="Status" Header="Status" Width="120px" />
                    <GridColumn Field="Amount" Header="Amount" Width="120px" />
                    <GridColumn Header="Actions" Width="80px">
                        <CellTemplate Context="order">
                            <DropdownMenu>
                                <DropdownMenuTrigger AsChild>
                                    <Button Variant="ButtonVariant.Ghost" Size="ButtonSize.Icon">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                        </svg>
                                    </Button>
                                </DropdownMenuTrigger>
                                <DropdownMenuContent Align="DropdownMenuAlign.End">
                                    <DropdownMenuItem OnClick="@(() => EditOrder(order.Id))">Edit</DropdownMenuItem>
                                    <DropdownMenuItem OnClick="@(() => DuplicateOrder(order.Id))">Duplicate</DropdownMenuItem>
                                    <DropdownMenuSeparator />
                                    <DropdownMenuItem OnClick="@(() => DeleteOrder(order.Id))" Class="text-destructive">Delete</DropdownMenuItem>
                                </DropdownMenuContent>
                            </DropdownMenu>
                        </CellTemplate>
                    </GridColumn>
                </Columns>
            </Grid>
        </div>

        @if (!string.IsNullOrEmpty(actionMessage))
        {
            <div class="rounded-lg border bg-muted p-4">
                <p class="text-sm">@actionMessage</p>
            </div>
        }

        <details class="rounded-lg border">
            <summary class="cursor-pointer select-none px-4 py-3 font-medium hover:bg-muted/50">
                View Code
            </summary>
            <div class="border-t bg-muted/20 p-4">
                <pre class="overflow-x-auto text-sm"><code>&lt;GridColumn Header="Actions"&gt;
    &lt;CellTemplate Context="order"&gt;
        &lt;DropdownMenu&gt;
            &lt;DropdownMenuTrigger AsChild&gt;&lt;Button&gt;...&lt;/Button&gt;&lt;/DropdownMenuTrigger&gt;
            &lt;DropdownMenuContent&gt;
                &lt;DropdownMenuItem&gt;Edit&lt;/DropdownMenuItem&gt;
            &lt;/DropdownMenuContent&gt;
        &lt;/DropdownMenu&gt;
    &lt;/CellTemplate&gt;
&lt;/GridColumn&gt;</code></pre>
            </div>
        </details>
    </section>

    @* Demo 9: Conditional Styling *@
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Conditional Styling</h2>
            <p class="text-muted-foreground">
                Dynamic CSS classes applied based on data values (high-value orders in green, cancelled in red).
            </p>
        </div>

        <div class="rounded-lg border bg-card p-6">
            <Grid Items="@orders.Take(15).ToList()">
                <Columns>
                    <GridColumn Field="Id" Header="Order ID" Width="100px" />
                    <GridColumn Field="Customer" Header="Customer" />
                    <GridColumn Field="Amount" Header="Amount" Width="140px">
                        <CellTemplate Context="order">
                            <span class="@GetAmountClass(order.Amount)">
                                @order.Amount.ToString("C")
                            </span>
                        </CellTemplate>
                    </GridColumn>
                    <GridColumn Field="Status" Header="Status" Width="130px">
                        <CellTemplate Context="order">
                            <span class="@GetStatusClass(order.Status)">
                                @order.Status
                            </span>
                        </CellTemplate>
                    </GridColumn>
                </Columns>
            </Grid>
        </div>

        <details class="rounded-lg border">
            <summary class="cursor-pointer select-none px-4 py-3 font-medium hover:bg-muted/50">
                View Code
            </summary>
            <div class="border-t bg-muted/20 p-4">
                <pre class="overflow-x-auto text-sm"><code>@@code {
    private string GetAmountClass(decimal amount) 
        =&gt; amount &gt; 5000 ? "font-bold text-green-600" : "";
}</code></pre>
            </div>
        </details>
    </section>
</div>

@code {
    private List<Order> orders = new();
    private string actionMessage = "";

    protected override void OnInitialized()
    {
        orders = GridDemoData.GenerateOrders(100);
    }

    private BadgeVariant GetStatusVariant(OrderStatus status) => status switch
    {
        OrderStatus.Delivered => BadgeVariant.Default,
        OrderStatus.Shipped => BadgeVariant.Secondary,
        OrderStatus.Processing => BadgeVariant.Outline,
        OrderStatus.Pending => BadgeVariant.Outline,
        OrderStatus.Cancelled => BadgeVariant.Destructive,
        _ => BadgeVariant.Default
    };

    private string GetAmountClass(decimal amount)
    {
        return amount > 5000 ? "font-bold text-green-600 dark:text-green-400" : "font-mono";
    }

    private string GetStatusClass(OrderStatus status)
    {
        return status == OrderStatus.Cancelled 
            ? "text-destructive font-medium" 
            : status == OrderStatus.Delivered 
                ? "text-green-600 dark:text-green-400 font-medium" 
                : "";
    }

    private void EditOrder(int orderId)
    {
        actionMessage = $"Edit order #{orderId} (demo action)";
        StateHasChanged();
    }

    private void DuplicateOrder(int orderId)
    {
        actionMessage = $"Duplicate order #{orderId} (demo action)";
        StateHasChanged();
    }

    private void DeleteOrder(int orderId)
    {
        actionMessage = $"Delete order #{orderId} (demo action)";
        StateHasChanged();
    }
}
