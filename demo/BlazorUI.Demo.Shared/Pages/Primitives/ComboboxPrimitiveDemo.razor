@page "/primitives/combobox"
@using BlazorUI.Primitives.Combobox

<PageTitle>Combobox Primitive - BlazorUI</PageTitle>

<div class="space-y-6">
    <div class="space-y-3">
        <h1 class="text-4xl font-bold">Combobox Primitive</h1>
        <p class="text-xl text-muted-foreground">
            Headless, unstyled combobox with filtering and keyboard navigation.
        </p>
    </div>

    <div class="space-y-6">
        <!-- Basic Example -->
        <section class="space-y-4">
            <h2 class="text-2xl font-semibold">Basic Usage</h2>
            <p class="text-muted-foreground">
                The primitive provides autocomplete behavior and filtering without styling.
            </p>

            <div class="rounded-lg border bg-card p-6 max-w-md">
                <Combobox @bind-SearchQuery="_searchQuery" OnValueChange="HandleValueChange">
                    <div class="space-y-2">
                        <!-- Input with basic styling -->
                        <ComboboxInput class="w-full px-3 py-2 border rounded-md" placeholder="Search fruits..." />

                        <!-- Content with basic styling -->
                        <ComboboxContent class="border rounded-md bg-popover p-2 max-h-[200px] overflow-auto">
                            <ComboboxEmpty class="py-6 text-center text-sm text-muted-foreground">
                                No results found for "@_searchQuery"
                            </ComboboxEmpty>

                            <ComboboxItem Value="apple" SearchText="apple" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üçé Apple
                            </ComboboxItem>
                            <ComboboxItem Value="banana" SearchText="banana" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üçå Banana
                            </ComboboxItem>
                            <ComboboxItem Value="cherry" SearchText="cherry" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üçí Cherry
                            </ComboboxItem>
                            <ComboboxItem Value="date" SearchText="date" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üìÖ Date
                            </ComboboxItem>
                            <ComboboxItem Value="elderberry" SearchText="elderberry" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                ü´ê Elderberry
                            </ComboboxItem>
                            <ComboboxItem Value="fig" SearchText="fig" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üå∞ Fig
                            </ComboboxItem>
                            <ComboboxItem Value="grape" SearchText="grape" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üçá Grape
                            </ComboboxItem>
                        </ComboboxContent>
                    </div>
                </Combobox>

                <div class="mt-4 text-sm">
                    <div><strong>Search Query:</strong> @_searchQuery</div>
                    <div><strong>Selected Value:</strong> @_selectedValue</div>
                </div>
            </div>
        </section>

        <!-- With Disabled Items -->
        <section class="space-y-4">
            <h2 class="text-2xl font-semibold">With Disabled Items</h2>
            <p class="text-muted-foreground">
                Certain items can be disabled to prevent selection while remaining visible.
            </p>

            <div class="rounded-lg border bg-card p-6 max-w-md">
                <Combobox @bind-SearchQuery="_searchQuery2" OnValueChange="HandleValueChange2">
                    <div class="space-y-2">
                        <ComboboxInput class="w-full px-3 py-2 border rounded-md" placeholder="Search colors..." />

                        <ComboboxContent class="border rounded-md bg-popover p-2 max-h-[200px] overflow-auto">
                            <ComboboxEmpty class="py-6 text-center text-sm text-muted-foreground">
                                No colors found
                            </ComboboxEmpty>

                            <ComboboxItem Value="red" SearchText="red" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üî¥ Red
                            </ComboboxItem>
                            <ComboboxItem Value="blue" SearchText="blue" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üîµ Blue
                            </ComboboxItem>
                            <ComboboxItem Value="green" SearchText="green" Disabled="true" class="px-2 py-1.5 opacity-50 cursor-not-allowed rounded-sm">
                                üü¢ Green (Disabled)
                            </ComboboxItem>
                            <ComboboxItem Value="yellow" SearchText="yellow" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üü° Yellow
                            </ComboboxItem>
                            <ComboboxItem Value="purple" SearchText="purple" Disabled="true" class="px-2 py-1.5 opacity-50 cursor-not-allowed rounded-sm">
                                üü£ Purple (Disabled)
                            </ComboboxItem>
                        </ComboboxContent>
                    </div>
                </Combobox>

                <div class="mt-4 text-sm">
                    <div><strong>Search Query:</strong> @_searchQuery2</div>
                    <div><strong>Selected Value:</strong> @_selectedValue2</div>
                </div>
            </div>
        </section>

        <!-- Custom Filter Function -->
        <section class="space-y-4">
            <h2 class="text-2xl font-semibold">Custom Filter Function</h2>
            <p class="text-muted-foreground">
                Implement custom filtering logic by providing a FilterFunction parameter.
                This example uses "starts with" instead of the default "contains" behavior.
            </p>

            <div class="rounded-lg border bg-card p-6 max-w-md">
                <Combobox @bind-SearchQuery="_searchQuery3"
                                   OnValueChange="HandleValueChange3"
                                   FilterFunction="@StartsWithFilter">
                    <div class="space-y-2">
                        <ComboboxInput class="w-full px-3 py-2 border rounded-md" placeholder="Search commands (starts with)..." />

                        <ComboboxContent class="border rounded-md bg-popover p-2 max-h-[200px] overflow-auto">
                            <ComboboxEmpty class="py-6 text-center text-sm text-muted-foreground">
                                No commands found
                            </ComboboxEmpty>

                            <ComboboxItem Value="calendar" SearchText="calendar" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üìÖ Calendar
                            </ComboboxItem>
                            <ComboboxItem Value="search" SearchText="search emoji" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üîç Search Emoji
                            </ComboboxItem>
                            <ComboboxItem Value="calculator" SearchText="calculator" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                üßÆ Calculator
                            </ComboboxItem>
                            <ComboboxItem Value="settings" SearchText="settings" class="px-2 py-1.5 cursor-pointer hover:bg-accent rounded-sm">
                                ‚öôÔ∏è Settings
                            </ComboboxItem>
                        </ComboboxContent>
                    </div>
                </Combobox>

                <div class="mt-4 text-sm">
                    <div><strong>Search Query:</strong> @_searchQuery3</div>
                    <div><strong>Selected Value:</strong> @_selectedValue3</div>
                    <div class="text-muted-foreground mt-1">Try typing "cal" or "set"</div>
                </div>
            </div>
        </section>

        <!-- Keyboard Navigation -->
        <section class="space-y-4">
            <h2 class="text-2xl font-semibold">Keyboard Shortcuts</h2>
            <p class="text-muted-foreground">
                Navigate and interact with the combobox using keyboard.
            </p>

            <div class="rounded-lg border p-6 space-y-3 bg-muted/50">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">Navigate items</span>
                    <div class="flex gap-1">
                        <kbd class="px-2 py-1 text-xs font-semibold bg-background border rounded">‚Üì</kbd>
                        <kbd class="px-2 py-1 text-xs font-semibold bg-background border rounded">‚Üë</kbd>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">First / Last item</span>
                    <div class="flex gap-1">
                        <kbd class="px-2 py-1 text-xs font-semibold bg-background border rounded">Home</kbd>
                        <kbd class="px-2 py-1 text-xs font-semibold bg-background border rounded">End</kbd>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">Select focused item</span>
                    <kbd class="px-2 py-1 text-xs font-semibold bg-background border rounded">Enter</kbd>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">Clear search</span>
                    <kbd class="px-2 py-1 text-xs font-semibold bg-background border rounded">Escape</kbd>
                </div>
            </div>
        </section>
    </div>
</div>

@code {
    private string _searchQuery = "";
    private string _selectedValue = "None";

    private string _searchQuery2 = "";
    private string _selectedValue2 = "None";

    private string _searchQuery3 = "";
    private string _selectedValue3 = "None";

    private void HandleValueChange(string value)
    {
        _selectedValue = value;
    }

    private void HandleValueChange2(string value)
    {
        _selectedValue2 = value;
    }

    private void HandleValueChange3(string value)
    {
        _selectedValue3 = value;
    }

    // Custom filter function that checks if SearchText starts with the query
    private bool StartsWithFilter(ComboboxItemMetadata item, string query)
    {
        if (string.IsNullOrWhiteSpace(query)) return true;
        return item.SearchText?.StartsWith(query, StringComparison.OrdinalIgnoreCase) ?? false;
    }
}
