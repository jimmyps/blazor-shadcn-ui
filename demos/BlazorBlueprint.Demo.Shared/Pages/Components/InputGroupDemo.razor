@page "/components/input-group"
@using BlazorBlueprint.Primitives.Services
@using BlazorBlueprint.Components.InputGroup
@using BlazorBlueprint.Components.Input
@using BlazorBlueprint.Components.Label
@using BlazorBlueprint.Components.DropdownMenu
@using System.ComponentModel.DataAnnotations

<PageTitle>Input Group - Blazor Blueprint</PageTitle>

<div class="space-y-10 max-w-sm">
    <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Input Group</h1>
        <p class="text-xl text-muted-foreground">
            Enhance inputs with icons, text, and action buttons.
        </p>
    </div>

    <!-- Basic Examples -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Examples</h2>
            <p class="text-muted-foreground">
                Add icons and text to inputs for better context.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Icon Start -->
            <div class="space-y-2">
                <Label>Search</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="search" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput Placeholder="Search..." />
                </InputGroup>
            </div>

            <!-- Icon End -->
            <div class="space-y-2">
                <Label>Username</Label>
                <InputGroup>
                    <InputGroupInput Value="johndoe123" Placeholder="Enter username" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd" Class="text-sm text-muted-foreground">
                        @@company.com
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- Icons on Both Sides -->
            <div class="space-y-2">
                <Label>Email</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="at-sign" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput Type="InputType.Email" Placeholder="name@example.com" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <LucideIcon Name="circle-check" Size="16" />
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- Icons on Both Sides and Rounded -->
            <div class="space-y-2">
                <Label>Website</Label>
                <InputGroup Class="rounded-full">
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="circle-alert" Size="16" />
                        <span class="font-semibold text-sm">https://</span>
                    </InputGroupAddon>
                    <InputGroupInput Type="InputType.Text" Placeholder="www.example.com" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <LucideIcon Name="star" Size="16" />
                    </InputGroupAddon>
                </InputGroup>
            </div>
        </div>
    </section>

    <!-- Text Addons -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Text Addons</h2>
            <p class="text-muted-foreground">
                Add text prefixes, suffixes, and labels to inputs.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Currency -->
            <div class="space-y-2">
                <Label>Price</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <InputGroupText>$</InputGroupText>
                    </InputGroupAddon>
                    <InputGroupInput Type="InputType.Number" Placeholder="0.00" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupText>USD</InputGroupText>
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- URL -->
            <div class="space-y-2">
                <Label>Website</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <InputGroupText>https://</InputGroupText>
                    </InputGroupAddon>
                    <InputGroupInput Placeholder="example.com" />
                </InputGroup>
            </div>

            <!-- Weight -->
            <div class="space-y-2">
                <Label>Weight</Label>
                <InputGroup>
                    <InputGroupInput Type="InputType.Number" Placeholder="0" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupText>kg</InputGroupText>
                    </InputGroupAddon>
                </InputGroup>
            </div>
        </div>
    </section>

    <!-- Action Buttons -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Action Buttons</h2>
            <p class="text-muted-foreground">
                Integrate action buttons directly into inputs.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Search with Button -->
            <div class="space-y-2">
                <Label>Search</Label>
                <InputGroup>
                    <InputGroupInput Placeholder="Search products..." />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupButton Class="!px-2.5 !py-0.5 !rounded-sm">
                            Search
                        </InputGroupButton>
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- Icon Button -->
            <div class="space-y-2">
                <Label>API Key</Label>
                <InputGroup>
                    <InputGroupInput Value="sk-1234567890abcdef" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupButton Variant="ButtonVariant.Ghost" Class="!px-1.5 !py-1.5 !rounded-md">
                            <LucideIcon Name="copy" Size="16" />
                        </InputGroupButton>
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- Icon + Button -->
            <div class="space-y-2">
                <Label>Newsletter</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="mail" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput Type="InputType.Email" Placeholder="Enter your email" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupButton Class="!px-2.5 !py-0.5 !rounded-sm">
                            Subscribe
                        </InputGroupButton>
                    </InputGroupAddon>
                </InputGroup>
            </div>
        </div>
    </section>

    <!-- Form Validation -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-muted-foreground">
                Show validation states with icons and colors.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Success State -->
            <div class="space-y-2">
                <Label>Username</Label>
                <InputGroup>
                    <InputGroupInput Value="johndoe" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <LucideIcon Name="circle-check" Size="16" Color="Green" />
                    </InputGroupAddon>
                </InputGroup>
                <p class="text-sm text-green-600">Username is available</p>
            </div>

            <!-- Error State -->
            <div class="space-y-2">
                <Label>Email</Label>
                <InputGroup>
                    <InputGroupInput
                        Type="InputType.Email"
                        Value="invalid-email"
                        AriaInvalid="true" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <LucideIcon Name="triangle-alert" Size="16" Class="text-destructive" />
                    </InputGroupAddon>
                </InputGroup>
                <p class="text-sm text-destructive">Please enter a valid email address</p>
            </div>

            <!-- Loading State -->
            <div class="space-y-2">
                <Label>Verification Code</Label>
                <InputGroup>
                    <InputGroupInput Placeholder="Enter code..." />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <LucideIcon Name="loader-circle" Size="16" Class="animate-spin" />
                    </InputGroupAddon>
                </InputGroup>
                <p class="text-sm text-muted-foreground">Verifying...</p>
            </div>
        </div>
    </section>

    <!-- Advanced Examples -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Advanced Examples</h2>
            <p class="text-muted-foreground">
                Combine multiple features for complex use cases.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Search with Clear and Search Button -->
            <div class="space-y-2">
                <Label>Advanced Search</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="search" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput Placeholder="Search files and folders..." />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupButton Variant="ButtonVariant.Ghost" Class="!px-1.5 !py-1.5 !rounded-md">
                            <LucideIcon Name="x" Size="16" />
                        </InputGroupButton>
                    </InputGroupAddon>
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupButton Class="!px-2.5 !py-0.5 !rounded-sm">
                            Search
                        </InputGroupButton>
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- Amount with Currency Button -->
            <div class="space-y-2">
                <Label>Transfer Amount</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="circle-dollar-sign" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput Type="InputType.Number" Placeholder="0.00" />
                    <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                        <InputGroupButton Variant="ButtonVariant.Outline" Class="!px-2.5 !py-0.5 !rounded-sm">
                            USD <LucideIcon Name="chevron-down" Size="14" />
                        </InputGroupButton>
                    </InputGroupAddon>
                </InputGroup>
            </div>

            <!-- Textarea with Action Buttons -->
            <div class="space-y-2">
                <Label>Comment</Label>
                <InputGroup>
                    <InputGroupTextarea Rows="4" Placeholder="Write your comment..." />
                    <InputGroupAddon Align="InputGroupAlign.BlockEnd">
                        <div class="flex items-center justify-between w-full">
                            <p class="text-sm text-muted-foreground">Max 500 characters</p>
                            <div class="flex gap-2">
                                <InputGroupButton Variant="ButtonVariant.Ghost" Class="!px-2.5 !py-0.5 !rounded-sm">
                                    Cancel
                                </InputGroupButton>
                                <InputGroupButton Class="!px-2.5 !py-0.5 !rounded-sm">
                                    Post
                                </InputGroupButton>
                            </div>
                        </div>
                    </InputGroupAddon>
                </InputGroup>
            </div>
        </div>
    </section>

    <!-- Dropdown Menu Example -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Dropdown Menu</h2>
            <p class="text-muted-foreground">
                Integrate dropdown menus with input fields for context actions.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Input with Dropdown Menu -->
            <div class="space-y-2">
                <Label>File Name</Label>
                <DropdownMenu>
                    <InputGroup>
                        <InputGroupInput Placeholder="Enter file name" />
                        <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                            <DropdownMenuTrigger AsChild="true">
                                <InputGroupButton Variant="ButtonVariant.Ghost" Class="!px-1.5 !py-1.5 !rounded-md">
                                    <LucideIcon Name="chevron-down" Size="16" />
                                </InputGroupButton>
                            </DropdownMenuTrigger>
                        </InputGroupAddon>
                    </InputGroup>
                    <DropdownMenuContent Align="@PopoverAlign.End">
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("Settings"))">Settings</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("Copy path"))">Copy path</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleMenuAction("Open location"))">Open location</DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
            </div>

            <!-- Input with Search Scope Dropdown -->
            <div class="space-y-2">
                <Label>Search</Label>
                <DropdownMenu>
                    <InputGroup Class="rounded-lg">
                        <InputGroupInput Placeholder="Enter search query" />
                        <InputGroupAddon Align="InputGroupAlign.InlineEnd">
                            <DropdownMenuTrigger AsChild="true">
                                <InputGroupButton Variant="ButtonVariant.Ghost" Class="!px-1 !py-1 !rounded-md">
                                    Search In...
                                    <LucideIcon Name="chevron-down" Size="16" />
                                </InputGroupButton>
                            </DropdownMenuTrigger>
                        </InputGroupAddon>
                    </InputGroup>
                    <DropdownMenuContent Align="@PopoverAlign.End">
                        <DropdownMenuItem OnClick="@(() => HandleSearchScope("Documentation"))">Documentation</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleSearchScope("Blog Posts"))">Blog Posts</DropdownMenuItem>
                        <DropdownMenuItem OnClick="@(() => HandleSearchScope("Changelog"))">Changelog</DropdownMenuItem>
                    </DropdownMenuContent>
                </DropdownMenu>
            </div>
        </div>
    </section>

    <!-- Code Editor Example -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Code Editor</h2>
            <p class="text-muted-foreground">
                Create code editor interfaces with header and footer toolbars.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Code Editor with Toolbar -->
            <div class="space-y-2">
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.BlockStart" Class="order-1 border-b !py-3">
                        <InputGroupText Class="font-mono font-medium gap-1.5">
                            <LucideIcon Name="file-code" Size="16" />
                            script.js
                        </InputGroupText>
                        <InputGroupButton Variant="ButtonVariant.Ghost" Class="ml-auto !px-2 !py-2 !rounded-md">
                            <LucideIcon Name="refresh-cw" Size="16" />
                        </InputGroupButton>
                        <InputGroupButton Variant="ButtonVariant.Ghost" Class="!px-2 !py-2 !rounded-md">
                            <LucideIcon Name="copy" Size="16" />
                        </InputGroupButton>
                    </InputGroupAddon>
                    <InputGroupTextarea
                        Placeholder="console.log('Hello, world!');"
                        Rows="8"
                        Class="min-h-[200px] font-mono text-sm order-2 !border-0" />
                    <InputGroupAddon Align="InputGroupAlign.BlockEnd" Class="order-3 border-t !py-3">
                        <InputGroupText>Line 1, Column 1</InputGroupText>
                        <InputGroupButton Class="ml-auto !px-3 !py-1.5 !rounded-md">
                            Run <LucideIcon Name="corner-down-left" Size="16" />
                        </InputGroupButton>
                    </InputGroupAddon>
                </InputGroup>
            </div>
        </div>
    </section>

    <!-- Update Timing -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Update Timing</h2>
            <p class="text-muted-foreground">
                Control when <code class="text-xs bg-muted px-1 py-0.5 rounded">ValueChanged</code> fires using the
                <code class="text-xs bg-muted px-1 py-0.5 rounded">UpdateTiming</code> parameter on InputGroupInput and InputGroupTextarea.
            </p>
        </div>

        <div class="space-y-6">
            <!-- Immediate -->
            <div class="space-y-2">
                <Label>Immediate (default)</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="search" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput UpdateTiming="UpdateTiming.Immediate"
                                     Value="@_igImmediateValue"
                                     ValueChanged="@((v) => _igImmediateValue = v)"
                                     Placeholder="Fires on every keystroke" />
                </InputGroup>
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_igImmediateValue) ? "(empty)" : _igImmediateValue)</p>
                </div>
            </div>

            <!-- OnChange -->
            <div class="space-y-2">
                <Label>OnChange (blur / Enter)</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="search" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput UpdateTiming="UpdateTiming.OnChange"
                                     Value="@_igOnChangeValue"
                                     ValueChanged="@((v) => _igOnChangeValue = v)"
                                     Placeholder="Fires on blur or Enter" />
                </InputGroup>
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_igOnChangeValue) ? "(empty)" : _igOnChangeValue)</p>
                </div>
            </div>

            <!-- Debounced -->
            <div class="space-y-2">
                <Label>Debounced (500ms)</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="search" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput UpdateTiming="UpdateTiming.Debounced"
                                     DebounceInterval="500"
                                     Value="@_igDebouncedValue"
                                     ValueChanged="@((v) => _igDebouncedValue = v)"
                                     Placeholder="Fires after typing pauses" />
                </InputGroup>
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_igDebouncedValue) ? "(empty)" : _igDebouncedValue)</p>
                </div>
            </div>

            <!-- Textarea Debounced -->
            <div class="space-y-2">
                <Label>Textarea Debounced (300ms)</Label>
                <InputGroup>
                    <InputGroupTextarea UpdateTiming="UpdateTiming.Debounced"
                                        DebounceInterval="300"
                                        Rows="3"
                                        Value="@_igTextareaDebouncedValue"
                                        ValueChanged="@((v) => _igTextareaDebouncedValue = v)"
                                        Placeholder="Type to see debounced updates..." />
                    <InputGroupAddon Align="InputGroupAlign.BlockEnd">
                        <InputGroupText>Debounced at 300ms</InputGroupText>
                    </InputGroupAddon>
                </InputGroup>
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@(string.IsNullOrEmpty(_igTextareaDebouncedValue) ? "(empty)" : _igTextareaDebouncedValue)</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Form Validation with EditForm -->
    <section class="space-y-6">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">EditForm Validation</h2>
            <p class="text-muted-foreground">
                InputGroupInput and InputGroupTextarea integrate with Blazor's EditForm for model validation.
                Validation errors automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>

        <EditForm Model="formModel" OnValidSubmit="HandleValidSubmit" class="space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <Label>Email</Label>
                <InputGroup>
                    <InputGroupAddon Align="InputGroupAlign.InlineStart">
                        <LucideIcon Name="at-sign" Size="16" />
                    </InputGroupAddon>
                    <InputGroupInput Type="InputType.Email" @bind-Value="formModel.Email" Placeholder="name@example.com" />
                </InputGroup>
                <ValidationMessage For="@(() => formModel.Email)" class="text-sm text-destructive" />
            </div>

            <div class="space-y-2">
                <Label>Comment</Label>
                <InputGroup>
                    <InputGroupTextarea @bind-Value="formModel.Comment" Rows="3" Placeholder="Write your comment..." />
                </InputGroup>
                <ValidationMessage For="@(() => formModel.Comment)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <Button Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</Button>
                <Button Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetForm">Reset</Button>
            </div>

            @if (!string.IsNullOrEmpty(formMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@formMessage</p>
                </div>
            }
        </EditForm>
    </section>
</div>

<!-- Code Example -->
<section class="space-y-4 mt-10">
    <h2 class="text-2xl font-semibold">Usage</h2>
    <div class="rounded-lg border bg-muted/30 p-6">
        <pre class="text-sm overflow-x-auto"><code>@@using BlazorBlueprint.Components.InputGroup
@@using BlazorBlueprint.Components.Input

&lt;!-- Icon at start --&gt;
&lt;InputGroup&gt;
    &lt;InputGroupAddon Align="InputGroupAlign.InlineStart"&gt;
        &lt;SearchIcon Size="16" /&gt;
    &lt;/InputGroupAddon&gt;
    &lt;InputGroupInput Placeholder="Search..." /&gt;
&lt;/InputGroup&gt;

&lt;!-- Button at end --&gt;
&lt;InputGroup&gt;
    &lt;InputGroupInput Placeholder="Enter email" /&gt;
    &lt;InputGroupAddon Align="InputGroupAlign.InlineEnd"&gt;
        &lt;InputGroupButton&gt;Subscribe&lt;/InputGroupButton&gt;
    &lt;/InputGroupAddon&gt;
&lt;/InputGroup&gt;

&lt;!-- Icons on both sides --&gt;
&lt;InputGroup&gt;
    &lt;InputGroupAddon Align="InputGroupAlign.InlineStart"&gt;
        &lt;MailIcon Size="16" /&gt;
    &lt;/InputGroupAddon&gt;
    &lt;InputGroupInput Type="InputType.Email" Placeholder="name@example.com" /&gt;
    &lt;InputGroupAddon Align="InputGroupAlign.InlineEnd"&gt;
        &lt;CheckCircle2Icon Size="16" /&gt;
    &lt;/InputGroupAddon&gt;
&lt;/InputGroup&gt;</code></pre>
    </div>
</section>

@code {
    private string? _igImmediateValue;
    private string? _igOnChangeValue;
    private string? _igDebouncedValue;
    private string? _igTextareaDebouncedValue;
    private InputGroupFormModel formModel = new();
    private string? formMessage;

    private void HandleValidSubmit()
    {
        formMessage = $"Form submitted! Email: {formModel.Email}, Comment: {formModel.Comment}";
    }

    private void ResetForm()
    {
        formModel = new();
        formMessage = null;
    }

    private void HandleMenuAction(string action)
    {
        // Handle menu action
        // The dropdown menu closes automatically after clicking an item
        Console.WriteLine($"Menu action: {action}");
    }

    private void HandleSearchScope(string scope)
    {
        // Handle search scope selection
        Console.WriteLine($"Search scope: {scope}");
    }

    private class InputGroupFormModel
    {
        [Required(ErrorMessage = "Email is required.")]
        [EmailAddress(ErrorMessage = "Please enter a valid email address.")]
        public string? Email { get; set; }

        [Required(ErrorMessage = "Comment is required.")]
        [StringLength(500, MinimumLength = 5, ErrorMessage = "Comment must be between 5 and 500 characters.")]
        public string? Comment { get; set; }
    }
}
