@page "/components/numeric-input"
@using BlazorBlueprint.Components.NumericInput
@using System.ComponentModel.DataAnnotations

<PageTitle>NumericInput Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">NumericInput Component</h1>
            <p class="text-xl text-muted-foreground">
                A generic numeric input supporting int, double, decimal, float, long, and short with min/max/step constraints.
            </p>
        </div>
    </div>

    <!-- Basic Integer Example -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Basic Integer</h2>
            <p class="text-sm text-muted-foreground">
                A simple integer input with default settings.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="int" @bind-Value="_intValue" Placeholder="Enter a number" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_intValue</p>
    </div>

    <!-- Double with Decimal Places -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Double with Decimal Places</h2>
            <p class="text-sm text-muted-foreground">
                A double input with 2 decimal places.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="double" @bind-Value="_doubleValue" DecimalPlaces="2" Placeholder="0.00" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_doubleValue.ToString("F2")</p>
    </div>

    <!-- With Min/Max Constraints -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Min/Max Constraints</h2>
            <p class="text-sm text-muted-foreground">
                Value is constrained between 0 and 100.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="int" @bind-Value="_constrainedValue" Min="0" Max="100" Placeholder="0-100" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_constrainedValue (min: 0, max: 100)</p>
    </div>

    <!-- With Step -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Step</h2>
            <p class="text-sm text-muted-foreground">
                Use arrow keys to increment/decrement by step value (5).
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="int" @bind-Value="_steppedValue" Step="5" Min="0" Max="100" Placeholder="Step: 5" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_steppedValue (step: 5, use arrow keys)</p>
    </div>

    <!-- With Buttons -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">With Increment/Decrement Buttons</h2>
            <p class="text-sm text-muted-foreground">
                Shows +/- buttons for easy value adjustment.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="int" @bind-Value="_buttonValue" ShowButtons="true" Min="0" Max="99" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_buttonValue</p>
    </div>

    <!-- Decimal Type -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Decimal Type (Currency)</h2>
            <p class="text-sm text-muted-foreground">
                Using decimal type with 2 decimal places for currency values.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="decimal" @bind-Value="_decimalValue" DecimalPlaces="2" Step="0.01m" Min="0m" />
        </div>
        <p class="text-sm text-muted-foreground">Value: $@_decimalValue.ToString("F2")</p>
    </div>

    <!-- Positive Only -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Positive Numbers Only</h2>
            <p class="text-sm text-muted-foreground">
                Negative values are not allowed.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="int" @bind-Value="_positiveValue" AllowNegative="false" Placeholder="Positive only" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_positiveValue</p>
    </div>

    <!-- Disabled -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Disabled</h2>
            <p class="text-sm text-muted-foreground">
                A disabled numeric input.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="int" Value="42" Disabled="true" />
        </div>
    </div>

    <!-- Float Type -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Float Type</h2>
            <p class="text-sm text-muted-foreground">
                Using float type with custom format.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="float" @bind-Value="_floatValue" Format="F3" Step="0.1f" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_floatValue.ToString("F3")</p>
    </div>

    <!-- Long Type -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Long Type</h2>
            <p class="text-sm text-muted-foreground">
                Using long type for large numbers.
            </p>
        </div>
        <div class="w-64">
            <NumericInput TValue="long" @bind-Value="_longValue" Step="1000" Placeholder="Large number" />
        </div>
        <p class="text-sm text-muted-foreground">Value: @_longValue.ToString("N0")</p>
    </div>

    <!-- Debounce -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Debounce</h2>
            <p class="text-sm text-muted-foreground">
                By default, <code class="text-xs bg-muted px-1 py-0.5 rounded">ValueChanged</code> is debounced during typing to reduce re-renders.
                Arrow keys, buttons, and blur always fire immediately. Set
                <code class="text-xs bg-muted px-1 py-0.5 rounded">DisableDebounce="true"</code> to fire on every keystroke.
            </p>
        </div>
        <div class="grid gap-6 md:grid-cols-2 max-w-2xl">
            <div class="space-y-2">
                <label class="text-sm font-medium">Debounced (default)</label>
                <div class="w-64">
                    <NumericInput TValue="int"
                                  Value="@_debouncedInt"
                                  ValueChanged="@((v) => _debouncedInt = v)"
                                  Placeholder="Type to see delay" />
                </div>
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@_debouncedInt</p>
                </div>
            </div>
            <div class="space-y-2">
                <label class="text-sm font-medium">Immediate (DisableDebounce)</label>
                <div class="w-64">
                    <NumericInput TValue="int"
                                  DisableDebounce="true"
                                  Value="@_immediateInt"
                                  ValueChanged="@((v) => _immediateInt = v)"
                                  Placeholder="Updates instantly" />
                </div>
                <div class="rounded-lg border p-3 bg-muted/50">
                    <p class="text-xs text-muted-foreground mb-1">Value:</p>
                    <p class="text-sm font-mono">@_immediateInt</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Validation with EditForm -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Form Validation</h2>
            <p class="text-sm text-muted-foreground">
                NumericInput integrates with Blazor's EditForm and EditContext for model validation.
                Use <code class="text-xs bg-muted px-1 py-0.5 rounded">@@bind-Value</code> within an EditForm and
                validation errors will automatically apply error styling via <code class="text-xs bg-muted px-1 py-0.5 rounded">aria-invalid</code>.
            </p>
        </div>
        <EditForm Model="numericFormModel" OnValidSubmit="HandleNumericFormSubmit" class="max-w-md space-y-4">
            <DataAnnotationsValidator />

            <div class="space-y-2">
                <label class="text-sm font-medium">Age</label>
                <NumericInput TValue="int" @bind-Value="numericFormModel.Age" Placeholder="Enter your age" />
                <ValidationMessage For="@(() => numericFormModel.Age)" class="text-sm text-destructive" />
            </div>

            <div class="space-y-2">
                <label class="text-sm font-medium">Quantity</label>
                <NumericInput TValue="int" @bind-Value="numericFormModel.Quantity" Min="0" Max="999" ShowButtons="true" />
                <ValidationMessage For="@(() => numericFormModel.Quantity)" class="text-sm text-destructive" />
            </div>

            <div class="flex gap-4">
                <Button Type="ButtonType.Submit" Variant="ButtonVariant.Default">Submit</Button>
                <Button Type="ButtonType.Button" Variant="ButtonVariant.Outline" OnClick="ResetNumericForm">Reset</Button>
            </div>

            @if (!string.IsNullOrEmpty(numericFormMessage))
            {
                <div class="p-4 bg-card rounded-lg border">
                    <p class="text-sm">@numericFormMessage</p>
                </div>
            }
        </EditForm>
    </div>

    <!-- API Reference -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
        </div>
        <div class="border rounded-lg p-6 space-y-4">
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">NumericInput&lt;TValue&gt; Parameters</h3>
                <div class="space-y-2 text-sm">
                    <p><strong>TValue:</strong> <code class="bg-muted px-1 py-0.5 rounded">struct, INumber&lt;TValue&gt;</code> - The numeric type (int, double, decimal, float, long, short)</p>
                    <p><strong>Value:</strong> <code class="bg-muted px-1 py-0.5 rounded">TValue</code> - Current value</p>
                    <p><strong>Min:</strong> <code class="bg-muted px-1 py-0.5 rounded">TValue?</code> - Minimum allowed value</p>
                    <p><strong>Max:</strong> <code class="bg-muted px-1 py-0.5 rounded">TValue?</code> - Maximum allowed value</p>
                    <p><strong>Step:</strong> <code class="bg-muted px-1 py-0.5 rounded">TValue?</code> - Step increment for arrow keys/buttons. Default: 1</p>
                    <p><strong>DecimalPlaces:</strong> <code class="bg-muted px-1 py-0.5 rounded">int?</code> - Number of decimal places to display</p>
                    <p><strong>AllowNegative:</strong> <code class="bg-muted px-1 py-0.5 rounded">bool</code> - Whether negative values are allowed. Default: true</p>
                    <p><strong>ShowButtons:</strong> <code class="bg-muted px-1 py-0.5 rounded">bool</code> - Show increment/decrement buttons. Default: false</p>
                    <p><strong>Format:</strong> <code class="bg-muted px-1 py-0.5 rounded">string?</code> - Custom format string (e.g., "F2", "N0")</p>
                    <p><strong>DisableDebounce:</strong> <code class="bg-muted px-1 py-0.5 rounded">bool</code> - Disable debounce to fire ValueChanged on every keystroke. Default: false</p>
                    <p><strong>DebounceInterval:</strong> <code class="bg-muted px-1 py-0.5 rounded">int</code> - Debounce delay in milliseconds. Default: 500</p>
                    <p><strong>Disabled:</strong> <code class="bg-muted px-1 py-0.5 rounded">bool</code> - Disables the input</p>
                </div>
            </div>
            <div>
                <h3 class="font-mono text-sm font-semibold mb-2">Keyboard Navigation</h3>
                <div class="space-y-2 text-sm">
                    <p><strong>Arrow Up/Down:</strong> Increment/decrement by step</p>
                    <p><strong>Page Up/Down:</strong> Increment/decrement by 10x step</p>
                    <p><strong>Home:</strong> Go to minimum value</p>
                    <p><strong>End:</strong> Go to maximum value</p>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private int _intValue = 0;
    private double _doubleValue = 0.0;
    private int _constrainedValue = 50;
    private int _steppedValue = 0;
    private int _buttonValue = 1;
    private decimal _decimalValue = 99.99m;
    private int _positiveValue = 0;
    private float _floatValue = 3.14f;
    private long _longValue = 0;
    private int _debouncedInt = 0;
    private int _immediateInt = 0;
    private NumericFormModel numericFormModel = new();
    private string? numericFormMessage;

    private void HandleNumericFormSubmit()
    {
        numericFormMessage = $"Form submitted! Age: {numericFormModel.Age}, Quantity: {numericFormModel.Quantity}";
    }

    private void ResetNumericForm()
    {
        numericFormModel = new();
        numericFormMessage = null;
    }

    private class NumericFormModel
    {
        [Range(1, 120, ErrorMessage = "Age must be between 1 and 120.")]
        public int Age { get; set; }

        [Range(1, 999, ErrorMessage = "Quantity must be between 1 and 999.")]
        public int Quantity { get; set; }
    }
}
